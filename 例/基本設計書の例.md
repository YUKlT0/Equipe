# シンプル雑貨オンライン 基本設計書

| ドキュメントバージョン | 1.0                                    |
| :------------------- | :------------------------------------- |
| 作成日               | 2025年4月20日                           |
| 作成チーム           | チーム〇〇                               |
| 承認者               | 〇〇 〇〇様                              |
| 更新履歴             | 2025/04/20: Ver.1.0 初版作成 (チーム〇〇) |

---

## 1. はじめに

### 1.1. 本書の目的

本書は、「シンプル雑貨オンライン」新規構築プロジェクトにおける基本設計の内容を定義するものである。要件定義書で定められた要件に基づき、システムの全体構成、主要な機能、画面、データ、非機能要件への対応方針などを明確にし、後続の詳細設計、実装、テスト工程のインプットとすることを目的とする。

### 1.2. プロジェクト概要

株式会社〇〇が運営するシンプルで質の高いデザイン雑貨を取り扱うオンラインストア「シンプル雑貨オンライン」を新規に構築する。実店舗販売に加え、新たな販売チャネルとしてECサイトを確立し、認知度向上と売上拡大を目指す。

### 1.3. 前提知識

本書を読むにあたり、以下の知識を有していることを前提とする。

- 本プロジェクトの要件定義書の内容
- Webアプリケーション開発の基本的な知識 (HTTP, HTML, CSS, JavaScript)
- REST API の基本的な概念
- Java および Spring Boot フレームワークの基本的な知識
- リレーショナルデータベースの基本的な知識

---

## 2. システム概要

### 2.1. システムの目的

クライアントが取り扱うデザイン雑貨をオンラインで販売するための基本的なEC機能（商品閲覧、カート、注文）を提供する。顧客がスムーズに商品情報を得て購入できる、シンプルで使いやすいECサイトを実現する。

### 2.2. 対象ユーザー

- **一般顧客:** シンプルで質の良い雑貨に関心のある20代後半～40代の男女。PCまたはスマートフォンを利用。
- **システム管理者（開発担当者）:** 商品情報の初期登録やデータメンテナンスを行う（管理画面は開発対象外）。

### 2.3. システム構成図

本システムは、フロントエンド（ブラウザ）とバックエンド（REST APIサーバー）を分離した構成とする。バックエンドはJava/Spring Bootで開発し、データベースと連携する。フロントエンドはHTML/CSS/JavaScriptで実装し、バックエンドAPIを呼び出して動的な表示を行う。

開発・テストはローカル環境で行い、AWSへのデプロイは任意とする。本構成図は、基本的な構成要素と連携を示す。

<div class="mermaid">
graph LR
    subgraph ユーザー環境
        A[クライアント<br>（PC/スマホ ブラウザ）<br>HTML/CSS/JavaScript]
    end

    subgraph "バックエンド (ローカル or AWS)"
        subgraph "APIサーバー (Spring Boot)"
            direction LR
            B[Controller<br>] --> C(Service<br>);
            C --> D(Repository<br>);
        end
        subgraph DBサーバー
            E[データベース<br>（H2 / PostgreSQLなど）]
        end
        D --> E;
    end

    A -- ① APIリクエスト<br>(HTTP GET, POST...) --> B;
    B -- ② 処理依頼 --> C;
    C -- ③ データアクセス --> D;
    D -- ④ SQL実行 --> E;
    E -- ⑤ データ --> D;
    D -- ⑥ データ --> C;
    C -- ⑦ 処理結果 --> B;
    B -- ⑧ APIレスポンス<br>(JSONデータ) --> A;

    style A fill:#lightyellow,stroke:#333,stroke-width:1px
    style B fill:#lightblue,stroke:#333,stroke-width:1px
    style C fill:#lightgreen,stroke:#333,stroke-width:1px
    style D fill:#lightcoral,stroke:#333,stroke-width:1px
    style E fill:#lightgrey,stroke:#333,stroke-width:1px
</div>

**構成要素:**

- **クライアント:** ユーザーが操作するWebブラウザ。HTML, CSS, JavaScriptで構成されるフロントエンドアプリケーションが動作し、バックエンドAPIと通信する。
- **APIサーバー:** Spring Bootで構築されたREST APIサーバー。ビジネスロジックの実行、データベースアクセスを担当する。
    * **Controller:** HTTPリクエストを受け付け、レスポンス（主にJSON）を返すエンドポイント。
    * **Service:** ビジネスロジックを実装する層。
    * **Repository:** データベースアクセスを担当する層 (JPA/MyBatis等を利用想定)。
- **DBサーバー:** 商品情報、会員情報、注文情報などを永続化するデータベース。演習では組み込みDB (H2) またはDocker等で用意したDB (PostgreSQL等) を想定。

### 2.4. 外部インターフェース

本プロジェクトのスコープでは、外部システム（決済システム、在庫管理システム等）との連携は**対象外**とする。

---

## 3. 機能設計

### 3.1. 機能一覧

要件定義書に基づき、本システムが提供する機能を以下に示す。MoSCoW分類も併記する。

| 機能ID | 機能名             | 概要                                                                         | MoSCoW | 備考                                                                                                                                |
| :----- | :----------------- | :--------------------------------------------------------------------------- | :----- | :---------------------------------------------------------------------------------------------------------------------------------- |
| F01    | トップページ表示   | サイトの入口として、簡単な紹介とおすすめ商品数点を表示する。                 | Must   |                                                                                                                                     |
| F02    | 商品一覧表示       | 登録されている全商品、またはカテゴリ別の商品リストを画像付きで表示する。     | Must   | カテゴリ機能はER図には含めるが、一覧画面での絞り込み実装は優先度:低。                                                              |
| F03    | 商品詳細表示       | 商品一覧から選択された商品の詳細情報を表示する。                             | Must   |                                                                                                                                     |
| F04    | カート追加         | 商品詳細ページから、指定した商品をカートに入れる。                           | Must   | カート情報はフロントエンドのLocalStorageまたはセッションストレージ、あるいはバックエンドのセッションやDBで管理するかは詳細設計で決定。 |
| F05    | カート表示・編集   | 現在カートに入っている商品の一覧、数量、小計、合計金額を表示し、数量変更や削除を可能にする。 | Must   |                                                                                                                                     |
| F06    | 注文情報入力       | カートの内容を確認後、注文に必要な情報（氏名、送付先住所、連絡先など）を入力する画面を表示する。 | Must   | 会員ログイン時は登録情報表示。非会員は直接入力。                                                                                    |
| F07    | 注文確認表示       | 入力された注文情報（商品、金額、送付先など）の最終確認画面を表示する。       | Must   |                                                                                                                                     |
| F08    | 注文確定処理       | ユーザーが注文を確定した際に、注文情報をデータベースに保存する。（実際の決済処理は行わない） | Must   |                                                                                                                                     |
| F09    | 注文完了表示       | 注文が正常に完了したことを示すメッセージと注文番号を表示する。               | Must   |                                                                                                                                     |
| F10    | ログイン機能       | 登録済みのユーザーがメールアドレスとパスワードでログインできるようにする。   | Must   | 認証成功後、フロントエンドは認証情報(トークン等)を保持し、以降のAPIリクエストに付与する方式を想定。(詳細は詳細設計)                 |
| F11    | 会員登録機能       | 新規ユーザーがサイト利用のために会員登録できるようにする。                   | Should | 利便性向上のため、優先度は高い。                                                                                                    |
| F12    | 注文履歴表示       | ログインユーザーが過去の自身の注文履歴を簡易的に確認できる。                 | Could  | Must, Should完了後、工数に余裕があれば対応。表示項目は注文日、注文番号、合計金額程度。                                                |
| -      | 管理機能           | 商品登録・編集・削除、注文管理、顧客管理など                                 | Won't  | 開発対象外。DB直接操作または別途ツールで対応想定。                                                                                  |
| -      | 決済機能           | クレジットカード決済など                                                     | Won't  | 開発対象外。                                                                                                                        |
| -      | 在庫管理機能（複雑） | リアルタイム在庫反映、在庫切れ制御                                         | Won't  | 開発対象外。商品テーブルの在庫数は持つが、厳密な制御は行わない。                                                                    |
| -      | 商品レビュー機能   |                                                                              | Won't  | 開発対象外。                                                                                                                        |
| -      | レコメンデーション |                                                                              | Won't  | 開発対象外。                                                                                                                        |
| -      | 高度な検索機能     | 価格帯絞り込み、複数キーワード検索など                                       | Won't  | 開発対象外。商品名での部分一致検索程度は可能なら実装(Could)。                                                                      |
| -      | 問い合わせフォーム |                                                                              | Won't  | 開発対象外。                                                                                                                        |
| -      | ポイント・クーポン |                                                                              | Won't  | 開発対象外。                                                                                                                        |

### 3.2. 機能構成図 (バックエンドAPI)

バックエンドAPIの主要な機能（リソース）とそれらを提供するコントローラーの関連を示す。

<div class="mermaid">
graph TD
    subgraph "商品関連API (/api/products)"
        ProdController[ProductController]
        ProdController -- GET /api/products --> ListProducts[商品一覧取得]
        ProdController -- GET /api/products/{productId} --> GetProduct[商品詳細取得]
    end

    subgraph "カート関連API (/api/cart)"
        CartController[CartController]
        CartController -- POST /api/cart --> AddToCart[カート追加]
        CartController -- GET /api/cart --> GetCart[カート情報取得]
        CartController -- PUT /api/cart/{itemId} --> UpdateCartItem[カート数量変更]
        CartController -- DELETE /api/cart/{itemId} --> RemoveCartItem[カート商品削除]
        %% Note: カートの実現方式(Session/DB等)によりAPI仕様は変動しうる
    end

    subgraph "注文関連API (/api/orders)"
        OrderController[OrderController]
        OrderController -- POST /api/orders --> PlaceOrder[注文確定]
        OrderController -- GET /api/orders --> GetOrderHistory[注文履歴取得 （Could）]
        OrderController -- GET /api/orders/{orderId} --> GetOrderDetails[注文詳細取得（履歴用/Could）]
    end

    subgraph "会員関連API (/api/users, /api/auth)"
        UserController[UserController]
        AuthController[AuthController]
        AuthController -- POST /api/auth/login --> Login[ログイン処理]
        AuthController -- POST /api/auth/logout --> Logout[ログアウト処理（任意）]
        UserController -- POST /api/users/register --> RegisterUser[会員登録 （Should）]
        UserController -- GET /api/users/me --> GetMyProfile[ログインユーザー情報取得（注文時等）]
    end

    %% Service/Repository層は図を簡潔にするため省略
    %% (アーキテクチャ図で表現済み)

    style ListProducts fill:#ccf,stroke:#333,stroke-width:1px
    style GetProduct fill:#ccf,stroke:#333,stroke-width:1px
    style AddToCart fill:#fcc,stroke:#333,stroke-width:1px
    style GetCart fill:#fcc,stroke:#333,stroke-width:1px
    style UpdateCartItem fill:#fcc,stroke:#333,stroke-width:1px
    style RemoveCartItem fill:#fcc,stroke:#333,stroke-width:1px
    style PlaceOrder fill:#cfc,stroke:#333,stroke-width:1px
    style GetOrderHistory fill:#cfc,stroke:#333,stroke-width:1px
    style GetOrderDetails fill:#cfc,stroke:#333,stroke-width:1px
    style Login fill:#ffc,stroke:#333,stroke-width:1px
    style Logout fill:#ffc,stroke:#333,stroke-width:1px
    style RegisterUser fill:#ffc,stroke:#333,stroke-width:1px
    style GetMyProfile fill:#ffc,stroke:#333,stroke-width:1px
</div>

### 3.3. 主要機能フロー (注文処理)

ユーザーが商品をカートに追加し、注文を完了するまでの主要な処理フロー（正常系）を以下に示す。フロントエンドとバックエンドAPI間のやり取りを中心に記述する。

<div class="mermaid">
sequenceDiagram
    participant User as ユーザー (ブラウザ)
    participant FE as フロントエンド (JS)
    participant API as バックエンドAPI (Spring Boot)
    participant DB as データベース

    Note over User, DB: 商品閲覧・カート追加フェーズ
    User->>FE: 商品詳細画面で「カートに入れる」クリック (商品ID, 数量)
    FE->>API: POST /api/cart (商品ID, 数量)
    API->>DB: (カート情報更新 - Session/DB等)
    DB-->>API: 更新結果
    API-->>FE: カート追加成功レスポンス (or カート情報)
    FE-->>User: カート追加完了メッセージ表示 (or カートアイコン更新)

    Note over User, DB: カート確認・注文情報入力フェーズ
    User->>FE: ヘッダーのカートアイコン等からカート画面へ遷移指示
    FE->>API: GET /api/cart
    API->>DB: (カート情報取得)
    DB-->>API: カート情報
    API-->>FE: カート情報(JSON)
    FE-->>User: カート画面表示 (商品リスト, 合計金額)
    User->>FE: カート画面で「購入手続きへ」クリック
    FE-->>User: 注文情報入力画面表示

    User->>FE: 注文情報入力（氏名、住所、連絡先等）
    User->>FE: 「確認画面へ」クリック
    FE-->>User: 注文確認画面表示 (入力内容、カート内容再表示)

    Note over User, DB: 注文確定フェーズ
    User->>FE: 注文確認画面で「注文を確定する」クリック
    FE->>API: POST /api/orders (カート情報, 注文者情報)
    API->>API: 入力チェック (バリデーション)
    API->>DB: 商品在庫確認・更新 (対象商品の在庫数を減らす)
    alt 在庫あり
        API->>DB: 注文情報をORDERSテーブルに登録
        API->>DB: 注文明細をORDER_DETAILSテーブルに登録
        DB-->>API: 登録完了 (注文ID払い出し)
        API->>FE: 注文完了レスポンス (注文ID含む)
        FE->>API: (カート情報クリア要求 - 実装による)
        FE-->>User: 注文完了画面表示 (注文番号表示)
    else 在庫なし or エラー
        API->>FE: 注文失敗レスポンス (エラー情報)
        FE-->>User: エラーメッセージ表示
    end
</div>

**補足:**

- 上記は正常系の基本的な流れであり、エラーハンドリング、ログイン状態のチェック、在庫切れ時の詳細な制御、カート情報の具体的な管理方法（セッション、DB等）については詳細設計で具体化する。
- 決済処理は本プロジェクトのスコープ外。

---

## 4. 画面設計

### 4.1. 画面一覧

本システムで提供する主要な画面を以下に示す。

| 画面ID   | 画面名                 | 概要                                                                 | 機能ID(関連)        | 備考                     |
| :------- | :--------------------- | :------------------------------------------------------------------- | :------------------ | :----------------------- |
| SC0001   | トップページ           | サイト紹介、おすすめ商品表示                                         | F01                 |                          |
| SC0101   | 商品一覧画面           | 商品リストを表示（画像、商品名、価格）                               | F02                 | カテゴリ選択は任意       |
| SC0102   | 商品詳細画面           | 商品詳細情報（画像、説明、価格）、カート追加ボタンを表示           | F03, F04            |                          |
| SC0301   | カート画面             | カート内商品リスト、数量変更/削除、合計金額、購入手続きボタンを表示    | F05                 |                          |
| SC0401   | 注文情報入力画面       | 注文者情報、送付先情報入力フォーム、カート内容確認                   | F06                 | 非ログイン/ログイン時考慮 |
| SC0402   | 注文確認画面           | 入力情報、注文内容の最終確認、注文確定ボタンを表示                   | F07                 |                          |
| SC0403   | 注文完了画面           | 注文完了メッセージ、注文番号を表示                                   | F09                 |                          |
| SC0201   | ログイン画面           | メールアドレス、パスワード入力フォーム、ログインボタン、新規登録リンク | F10                 |                          |
| SC0202   | 会員登録画面 (Should)  | 会員情報（氏名、メアド、パスワード等）入力フォーム、登録ボタン       | F11                 | Should要件             |
| SC0203   | 会員登録完了画面 (Should)| 登録完了メッセージ、ログイン画面へのリンク                         | F11                 | Should要件             |
| SC0501   | マイページ (Could)     | ログインユーザー向けメニュー（注文履歴へのリンク等）                   | F12                 | Could要件              |
| SC0502   | 注文履歴一覧画面 (Could)| 過去の注文リスト（注文日、注文番号、合計金額）を表示               | F12                 | Could要件              |

### 4.2. 画面遷移図

ユーザーの操作による主要な画面遷移を以下に示す。

<div class="mermaid">
graph TD
    A[SC0001 トップページ] --> B(SC0101 商品一覧画面);
    A -- ログイン --> C(SC0201 ログイン画面);
    A -- カート --> E(SC0301 カート画面);
    A -- マイページ(ログイン時) --> K(SC0501 マイページ);

    B -- 商品選択 --> D(SC0102 商品詳細画面);
    B -- ログイン --> C;
    B -- カート --> E;
    B -- マイページ(ログイン時) --> K;

    D -- カートに入れる --> E;
    D -- ログイン --> C;
    D -- カート --> E;
    D -- マイページ(ログイン時) --> K;

    E -- 購入手続きへ --> F(SC0401 注文情報入力画面);
    E -- 商品一覧へ戻る --> B;
    E -- ログイン --> C;
    E -- マイページ(ログイン時) --> K;

    F -- 内容確認へ --> H(SC0402 注文確認画面);
    F -- カートへ戻る --> E;

    H -- 注文を確定する --> I(SC0403 注文完了画面);
    H -- 入力画面へ戻る --> F;

    I -- トップページへ --> A;

    C -- ログイン成功 --> Prev{遷移元画面へ};
    C -- 新規登録はこちら --> G(SC0202 会員登録画面);

    G -- 登録ボタン --> J(SC0203 会員登録完了画面);
    G -- ログイン画面へ --> C;

    J -- ログイン画面へ --> C;

    K -- 注文履歴 --> L(SC0502 注文履歴一覧画面);
    K -- トップページへ --> A;
    K -- ログアウト --> A; 

    L -- マイページへ戻る --> K;

    subgraph 商品閲覧フロー
        direction LR
        A; B; D;
    end
    subgraph 購入フロー
        direction TB
        E; F; H; I;
    end
    subgraph ユーザー認証フロー
        direction LR
        C; G; J;
    end
    subgraph "マイページフロー（Could）"
        direction TB
        K; L;
    end

    style A fill:#f9f,stroke:#333,stroke-width:1px
    style I fill:#f9f,stroke:#333,stroke-width:1px
    style Prev fill:#eee,stroke:#333,stroke-width:1px,stroke-dasharray: 5 5
</div>

**補足:**

- `Prev{遷移元画面へ}` は、ログイン後に直前の画面に戻ることを示す概念的な表現。実際の挙動はフロントエンドの実装による。
- エラー発生時の遷移は省略。
- Should/Could要件の画面(G, J, K, L)は、開発状況により実装されない可能性がある。

### 4.3. UI/UX基本方針

- **シンプル＆クリーン:** 「シンプル雑貨オンライン」のコンセプトに合わせ、過度な装飾を避け、余白を活かした清潔感のあるデザインを目指す。
- **直感的な操作:** ユーザーがマニュアルなしで目的の操作（商品検索、購入）を達成できるよう、一般的なECサイトの慣習に従い、わかりやすいナビゲーションとボタン配置とする。
- **レスポンシブデザイン:** PC、スマートフォン、タブレット等、異なる画面サイズで最適に表示・操作できるよう、レスポンシブWebデザインを採用する。モバイル利用を考慮し、スマートフォンでの使いやすさを重視する（モバイルファーストも視野に入れる）。
- **明確なフィードバック:** ユーザーのアクション（カート追加、注文確定など）に対して、処理中であることや処理結果（成功/失敗）を適切にフィードバックする。
- **ワイヤーフレーム/デザインカンプ:** 個々の画面の具体的なレイアウト、要素配置を示すワイヤーフレームやデザインカンプは、**詳細設計工程**で作成する。基本設計では本方針の合意に留める。
- **アクセシビリティ:** 詳細設計・実装段階で、基本的なアクセシビリティ（文字サイズ、コントラスト、キーボード操作、代替テキスト等）に配慮する方針とする。

---

## 5. データ設計

### 5.1. DB概念設計 (ER図)

本システムで扱う主要なデータエンティティとその関連を以下に示す。これはデータベースの概念モデルであり、実際のテーブル定義は詳細設計で具体化する。

<div class="mermaid">
erDiagram
    CUSTOMER ||--o{ ORDER : places
    ORDER ||--|{ ORDER_DETAIL : contains
    PRODUCT ||--o{ ORDER_DETAIL : "included in"
    CATEGORY ||--o{ PRODUCT : categorizes

    CUSTOMER {
        int customer_id PK "会員ID (システムで一意)"
        string name "氏名"
        string email "メールアドレス (ログインID)"
        string password "パスワード (ハッシュ化)"
        string address "住所"
        string phone_number "電話番号"
        datetime created_at "登録日時"
        datetime updated_at "更新日時"
    }
    ORDER {
        int order_id PK "注文ID (システムで一意)"
        int customer_id FK "(FK) 会員ID (非会員の場合はNULL or 特定の値)"
        datetime order_date "注文日時"
        int total_amount "合計金額"
        string customer_name "注文者氏名 (非会員用/冗長)"
        string shipping_address "配送先住所"
        string shipping_phone_number "配送先電話番号"
        string status "注文ステータス (例: 受付、完了)"
        datetime created_at "作成日時"
        datetime updated_at "更新日時"
    }
    ORDER_DETAIL {
        int order_detail_id PK "注文明細ID (システムで一意)"
        int order_id FK "(FK) 注文ID"
        int product_id FK "(FK) 商品ID"
        string product_name "商品名 (注文時点/冗長)"
        int price "単価 (注文時点)"
        int quantity "数量"
        datetime created_at "作成日時"
        datetime updated_at "更新日時"
    }
    PRODUCT {
        int product_id PK "商品ID (システムで一意)"
        string name "商品名"
        string description "商品説明"
        int price "価格"
        int stock "在庫数"
        string image_url "商品画像パス or URL"
        int category_id FK "(FK) カテゴリID"
        boolean is_recommended "おすすめフラグ (トップページ用)"
        datetime created_at "登録日時"
        datetime updated_at "更新日時"
    }
    CATEGORY {
        int category_id PK "カテゴリID (システムで一意)"
        string name "カテゴリ名"
        datetime created_at "登録日時"
        datetime updated_at "更新日時"
    }
</div>

**エンティティの説明:**

- **CUSTOMER:** 会員情報 (ログインユーザー)。F10, F11 に関連。
- **PRODUCT:** 商品情報。F01, F02, F03 に関連。
- **CATEGORY:** 商品カテゴリ情報。F02 に関連。
- **ORDER:** 注文ヘッダー情報。F08, F12 に関連。非会員の注文も考慮し、customer_id はNULLを許容するか、あるいは非会員用のレコードを用意する（詳細は詳細設計）。注文者情報も冗長に持つことを検討。
- **ORDER_DETAIL:** 注文明細情報。どの注文でどの商品がいくつ購入されたか。価格や商品名は注文時点のものを保持（冗長）。F08 に関連。

**関連の説明:**

- 会員(CUSTOMER) は 複数(0以上)の 注文(ORDER) を行う (1対多)。
- 注文(ORDER) は 複数(1以上)の 注文明細(ORDER_DETAIL) を含む (1対多)。
- 商品(PRODUCT) は 複数(0以上)の 注文明細(ORDER_DETAIL) に含まれる (1対多)。
- カテゴリ(CATEGORY) は 複数(0以上)の 商品(PRODUCT) を持つ (1対多)。

**正規化とパフォーマンス:**

- 基本的な正規化（第3正規形程度）を意識するが、注文明細に商品名や価格を冗長に持たせるなど、利便性・性能面で非正規化も一部考慮する。
- 主要な検索条件（例: `PRODUCT.name`, `ORDER.customer_id`, `ORDER.order_date`）にはインデックス作成を検討する（詳細は詳細設計）。

**カート情報:**

- カート情報は、揮発性やパフォーマンスの観点から、基本設計段階ではデータベースのテーブルとしては定義せず、フロントエンドのストレージ (LocalStorage/SessionStorage) またはバックエンドのセッション管理での実現を第一候補とする。DBで管理する場合は、詳細設計で `CART`, `CART_ITEM` テーブルを別途検討する。

### 5.2. 主要テーブル概要

ER図で定義した主要エンティティに対応するテーブルの概要を示す。データ型、桁数、制約等の詳細は詳細設計で定義する。

| テーブル論理名 | テーブル物理名 (例) | 主要カラム (論理名)                                                                                                      | 説明                                                       |
| :------------- | :-------------------- | :--------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------- |
| 会員           | customers             | 会員ID, 氏名, メールアドレス, パスワード, 住所, 電話番号, 登録日時, 更新日時                                                 | 会員情報を格納する。メールアドレスはログインIDとして使用。 |
| 商品           | products              | 商品ID, 商品名, 商品説明, 価格, 在庫数, 商品画像パス, カテゴリID, おすすめフラグ, 登録日時, 更新日時                        | 販売する商品情報を格納する。在庫数は簡易的な管理用。       |
| カテゴリ       | categories            | カテゴリID, カテゴリ名, 登録日時, 更新日時                                                                               | 商品の分類情報を格納する。                               |
| 注文           | orders                | 注文ID, 会員ID, 注文日時, 合計金額, 注文者氏名, 配送先住所, 配送先電話番号, 注文ステータス, 作成日時, 更新日時            | 注文のヘッダー情報を格納する。                             |
| 注文明細       | order\_details        | 注文明細ID, 注文ID, 商品ID, 商品名, 単価, 数量, 作成日時, 更新日時                                                      | 注文の明細情報（どの商品をいくつ買ったか）を格納する。     |

### 5.3. データフロー概要

主要機能である「注文確定処理 (F08)」におけるデータの流れの概要を示す。

1.  **フロントエンド**から、カート内の商品情報（商品IDリスト、各数量）とユーザーが入力した注文者情報（氏名、配送先住所、連絡先）、およびログイン済みであれば会員ID（または認証トークン）が**バックエンドAPI (POST /api/orders)** へ送信される。
2.  **バックエンド (Service層)** は受け取った情報に基づき、以下の処理を行う。
    * 関連する**商品テーブル (products)** から、注文対象商品の価格、在庫数を参照する。
    * 在庫数を確認し、注文数分の在庫引き当てが可能かチェックする。
    * 在庫引き当てが可能な場合、**商品テーブル (products)** の在庫数を注文数分だけ減算更新する。
    * ログインユーザーの場合、**会員テーブル (customers)** を参照することがある（例: デフォルト配送先取得など）。
    * 注文情報を**注文テーブル (orders)** に新規登録する。この際、合計金額を計算する。会員ID、注文日時、注文者情報、配送先情報、初期ステータス（例: '受付'）などを設定する。
    * カート内の各商品について、注文明細情報を**注文明細テーブル (order\_details)** に新規登録する。この際、注文ID、商品ID、注文時点の商品名、注文時点の単価、数量を記録する。
3.  すべてのDB操作が正常に完了したら、生成された注文IDを含む成功レスポンスをフロントエンドに返す。途中でエラー（在庫不足など）が発生した場合は、DB操作をロールバックし、エラーレスポンスを返す。
4.  **フロントエンド**は、成功レスポンスを受け取ったら、ユーザーに注文完了画面を表示する。カート情報（フロントエンド管理の場合）をクリアする。

---

## 6. 非機能要件 対応方針

要件定義書で定義された非機能要件に対し、本システムにおける対応方針を以下に示す。詳細な設計や実装は、後続の工程で行う。

### 6.1. 性能・拡張性

- **応答性能:** 通常利用時において、ユーザー操作に対する画面応答時間は**概ね3秒以内**を目標とする。ただし、これは体感的な目標であり、厳密な性能測定や負荷テストは本演習のスコープ外とする。
- **拡張性:** 将来的な商品点数やアクセス数の増加に対し、大幅なシステム改修なしに対応できる基本的な設計とする。具体的には、以下の点を考慮する。
    * バックエンドはLayered Architecture（Controller, Service, Repository）を採用し、関心事を分離する。
    * データベースのインデックスを適切に設計する（詳細は詳細設計）。
    * 極端に効率の悪いSQL発行や処理ロジックは避ける。
- **同時アクセス数:** 具体的な目標値は定めないが、一般的なWebアプリケーションとして、数名〜十数名程度の同時アクセスで著しい性能劣化が発生しないことを想定する。

### 6.2. 可用性

- **稼働時間:** システムは、計画メンテナンス時間を除き、原則として24時間365日稼働を目指すが、これはホスティング環境（ローカル開発環境、または任意で利用するAWSの標準的なサービスレベル）に準拠する。年間稼働率の保証は行わない。
- **障害時対応:** 致命的な障害発生時は、可能な範囲で迅速な復旧を目指す。ただし、SLA（サービスレベルアグリーメント）は定義しない。
- **計画メンテナンス:** 実施する場合は、事前に告知の上、アクセスが少ない時間帯に行うことを原則とする（本演習では具体的な計画は不要）。
- **冗長化:** サーバーやデータベースの冗長構成は、本演習の基本設計スコープ外とする。

### 6.3. 運用・保守性

- **ログ出力:** アプリケーションのエラー発生時には、原因調査に必要なログを出力する。
    * Spring Boot標準のロギングフレームワーク（SLF4j + Logback等）を利用する。
    * エラー発生時のスタックトレース、日時、関連情報（リクエスト情報など可能な範囲）をログに出力する。
    * ログ監視・通知の仕組み構築はスコープ外。
- **コード品質:** 保守性を考慮し、チーム内で合意した基本的なコーディング規約（別途定める）に準拠する。可読性の高いコード記述を心がける。Layered Architectureの採用により、各層の責務を明確にし、変更時の影響範囲を局所化する。
- **設定管理:** データベース接続情報などの環境依存の設定は、設定ファイル（`application.properties` or `application.yml`）で行い、外部から変更可能にする。

### 6.4. 移行性

- 本システムは新規構築であるため、既存システムからのデータ移行は**発生しない**。
- 商品データ等の初期データは、別途用意されたデータを基に、開発担当者が投入することを想定する（投入方法は別途検討）。

### 6.5. セキュリティ

- **通信の暗号化:** 個人情報（氏名、住所、連絡先、パスワード）を含むすべての通信は、**HTTPS**で行うことを必須とする（インフラ側での設定が必要）。
- **パスワードの保存:** 会員パスワードは、復元不可能な**ハッシュ化**（例: Spring SecurityのBcrypt）を行ってデータベースに保存する。
- **脆弱性対策:**
    * SQLインジェクション: ORM（JPA等）の利用やプレースホルダの使用により対策する。
    * クロスサイトスクリプティング (XSS): フレームワーク（Spring Security, Thymeleaf/フロントエンドライブラリ）が提供するエスケープ処理機能を適切に利用する。
    * CSRF (Cross-Site Request Forgery): 必要に応じてフレームワーク（Spring Security）が提供するCSRF対策機能を利用する（詳細は詳細設計）。
- **認証・認可:**
    * ログイン認証はメールアドレスとパスワードで行う。
    * ログイン状態の管理（セッション管理、トークン管理等）は詳細設計で具体化する。
    * 認可（アクセス制御）は、ログインユーザーのみアクセス可能なAPI（注文履歴等）に対して適切に設定する。Spring Securityの機能利用を想定。
- **個人情報の取り扱い:**
    * 必要最小限の個人情報のみを取得・保持する。
    * クレジットカード情報は**システム内では一切保持しない**。
- **セキュリティ診断:** 本演習のスコープ外とする。

### 6.6. 操作性・ユーザビリティ・アクセシビリティ

- **操作性（ユーザビリティ）:** 4.3. UI/UX基本方針 に記載の通り、シンプルで直感的な操作性を目指す。
- **アクセシビリティ:** 詳細設計・実装段階で、基本的なWebアクセシビリティ（WCAG 2.0 レベルA程度を目安）に配慮する方針とする。具体的には、キーボード操作、適切なコントラスト、画像代替テキスト、フォームのラベルなどを意識する。アクセシビリティの専門的な評価はスコープ外。

### 6.7. システム環境

- **利用環境（クライアント）:** 要件定義書「2. システム概要 - 利用環境」に準拠する。
    * OS: Windows 10/11, macOS 最新版
    * Webブラウザ: Google Chrome 最新版, Microsoft Edge 最新版, Safari 最新版（PC/スマートフォン）
- **開発環境:** 演習概要で指定された環境を利用する（VS Code, Java, Spring Boot, Git, JUnit）。
- **実行環境（バックエンド）:** Java実行環境、Spring Bootアプリケーション、データベース（H2/PostgreSQL等）。
- **実行環境（フロントエンド）:** モダンブラウザ（HTML5, CSS3, ES6以降対応）。

---

## 7. 運用・保守設計の概要

システムリリース後の安定稼働と、将来的な機能追加・修正の容易性を見据えた運用・保守に関する設計方針を以下に示す。

### 7.1. ログ設計方針

- **目的:** システム稼働状況の把握、障害発生時の原因調査、不正アクセスの追跡（限定的）に利用する。
- **出力内容:**
    * **エラーログ:** アプリケーションで捕捉されなかった例外、予期せぬエラー発生時に、スタックトレース、発生日時、関連情報（可能な範囲）を記録する。
    * **アプリケーションログ:** 主要な処理の開始・終了、重要な分岐点など、デバッグや動作確認に有用な情報を必要に応じて記録する（デバッグレベル等で制御）。
    * **アクセスログ:** （任意）どのエンドポイントにいつアクセスがあったかの基本的な情報を記録する（Webサーバー側 or Spring Bootの機能で対応）。本演習では必須としない。
- **出力方式:** Spring Boot標準のロギングフレームワーク（SLF4j + Logback等）を利用し、ファイルに出力することを基本とする。ログフォーマットは別途定義する。
- **ログローテーション:** ログファイルが肥大化しないよう、日次などでローテーションする設定を行う（Logbackの設定）。
- **保管期間:** 本演習では特に定めない。実システムでは要件に応じて決定する。

### 7.2. 監視設計方針

- システムの稼働状況（死活監視）、リソース使用状況（CPU, メモリ, ディスク）、アプリケーションの性能（応答時間、エラーレート）等の監視は、安定運用のために重要である。
- しかし、本演習では監視システムの構築・設定は**スコープ外**とする。ローカル環境での動作確認を主とする。
- （任意でAWSにデプロイする場合は、CloudWatch等の基本的な監視機能の利用を検討する）

### 7.3. バックアップ・リカバリ方針

- データベースのデータ消失に備え、定期的なバックアップと、障害発生時のリカバリ手順を確立することが重要である。
- 本演習では、データベースのバックアップ取得・リストア手順の**計画書・手順書の作成のみ**を対象とし、実際のバックアップシステムの構築や自動実行はスコープ外とする。
- （任意でAWSのRDS等を利用する場合は、そのサービスのバックアップ機能を利用することを想定する）

---

## 8. 制約事項・前提条件

### 8.1. 使用技術スタック

本システムの開発にあたり、以下の技術を使用することを前提とする。

- **言語:** Java (演習指定のJDKバージョン)
- **フレームワーク:** Spring Boot (演習指定のバージョン)
- **データベース:** H2 Database (ローカル開発用), PostgreSQL (任意でのAWS利用時等を想定)
- **フロントエンド:** HTML, CSS, JavaScript (特定のフレームワークは必須としないが、チーム内で合意の上、Vue.js, React等の利用も可)
- **開発ツール:** Visual Studio Code (VS Code)
- **バージョン管理:** Git (リポジトリはGitHub等を想定)
- **テストフレームワーク:** JUnit (演習指定のバージョン)

### 8.2. インフラ環境

- **開発環境:** 各受講者のローカルPC上に構築する。
- **実行環境（本番相当）:** 原則としてローカル環境での動作確認とする。AWSへのデプロイ環境構築は**任意課題**とする。

### 8.3. 開発・運用ルール

- **コーディング規約:** チーム内で基本的な規約（命名規則、インデント等）を定め、遵守する。
- **バージョン管理:** Gitを用いたバージョン管理を行う。ブランチ戦略（例: Git-flowベース）やコミットメッセージの規約等はチーム内で決定する。
- **CI/CD:** 演習では講義で扱うのみとし、受講者によるCI/CDパイプラインの構築は行わない。

### 8.4. スコープ外事項

本基本設計および開発のスコープには、以下を含まない（要件定義書より再掲）。

- 実際の決済機能（クレジットカード、銀行振込など）の実装
- 複雑な在庫管理機能（リアルタイムな在庫数反映、在庫切れ時の厳密な制御）
- 商品レビュー機能
- レコメンデーション機能
- 管理者向け機能（商品登録・編集・削除、注文管理、顧客管理などのための管理画面）
- 高度な検索機能（価格帯絞り込み、複数キーワード検索など）
- 問い合わせフォーム機能
- ポイント機能、クーポン機能

---

## 9. (付録) 用語集・略語リスト

本ドキュメントおよび本プロジェクトで使用される主要な用語とその説明を以下に示す（要件定義書より抜粋・必要なら追加）。

| 用語         | 説明                                                                                                |
| :----------- | :-------------------------------------------------------------------------------------------------- |
| ECサイト     | Electronic Commerceサイトの略。インターネット上で商品を販売するウェブサイト。                           |
| ユーザー     | 本システムを利用する顧客（一般消費者）。                                                            |
| 商品         | 本サイトで販売する雑貨（文房具、キッチン用品、小物など）。                                           |
| カート       | 購入希望の商品を一時的に保持しておくための機能、またはそのリスト。買い物かご。                           |
| 注文         | 顧客が商品の購入を確定する手続き。                                                                  |
| 会員登録     | ユーザーが氏名、連絡先、ログイン情報などをシステムに登録すること。                                    |
| ログイン     | 登録済みユーザーが、メールアドレスとパスワード等を用いてシステムに本人であることを認証させる手続き。   |
| DB           | データベース (Database)。商品情報、顧客情報、注文情報などを格納する場所。                               |
| SSL/TLS      | Secure Sockets Layer / Transport Layer Security。インターネット上でデータを暗号化して送受信する仕組み。 |
| レスポンシブデザイン | PC、スマートフォン、タブレットなど、異なる画面サイズのデバイスで表示が最適化されるデザイン手法。 |
| API          | Application Programming Interface。ソフトウェアコンポーネントが互いにやりとりする際に使用するインターフェース。 |
| REST API     | Web APIの設計思想の一つ。HTTPメソッド(GET, POST等)とURIでリソースを操作する。                          |
| SPA          | Single Page Application。単一のHTMLページで、データ変更に応じて画面の一部をJavaScriptで動的に書き換えるWebアプリ。 |
| JSON         | JavaScript Object Notation。データ交換形式の一つ。軽量で人間にも読みやすい。                          |
| MVC          | Model-View-Controller。ソフトウェアの設計パターンの一つ。                                           |
| Layered Architecture | アプリケーションを機能的な「層」に分割する設計アプローチ（例: プレゼンテーション層、ビジネスロジック層、データアクセス層）。 |
| PK           | 主キー (Primary Key)。テーブル内で各行を一意に識別する項目。                                        |
| FK           | 外部キー (Foreign Key)。他のテーブルの主キーを参照し、テーブル間の関連付けを行なう項目。               |
| UI           | ユーザーインターフェース (User Interface)。ユーザーがシステムと対話する接点（画面など）。             |
| UX           | ユーザーエクスペリエンス (User Experience)。ユーザーがシステム利用を通じて得る体験。                |
| ER図         | Entity-Relationship Diagram。データベースの概念設計でエンティティとリレーションシップを図示したもの。   |

## 10. 承認

本基本設計書の内容を、以下の関係者が承認する。後続フェーズでの設計変更が発生した場合、変更管理のプロセスに従い本書を改訂し、バージョン管理を行う。

| 承認者        | 所属・役職          | 日付         | 印 |
| :------------ | :------------------ | :----------- | :- |
| ○○ ○○ (甲)   | 〇〇社 システム企画部  | 202X/XX/XX   |    |
| △△ △△ (甲)   | 〇〇社 総務部 部長     | 202X/XX/XX   |    |
| □□ □□ (乙)   | 株式会社ベンダー    | 202X/XX/XX   |    |
