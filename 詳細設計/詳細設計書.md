# "Welcome to TEINEI "  詳細設計書

| ドキュメントバージョン | 1.0                                          |
| :--------------------- | :------------------------------------------- |
| 作成日                 | 2025年7月7日                                 |
| 作成チーム             | Equipe                                       |
| 更新履歴               | 2025/07/07: Ver.1.0 初版作成 (チーム Equipe) |

## 1. はじめに

### 1.1. 本書の目的

本書は、「" Welcome to TEINEI "」新規構築プロジェクトにおける詳細設計の内容を定義するものです。基本設計書 Ver.1.0 で定義された内容に基づき、実装担当者がプログラミング作業を迷いなく進められるように、システムの内部構造、処理フロー、インターフェース、データベース構造、画面項目などを具体的に記述します。

### 1.2. 前提となる基本設計書

本書は、以下の基本設計書の内容を前提としています。

- "Welcome to TEINEI " 基本設計書 Ver.1.0

### 1.3. 対象読者

本書は、以下の担当者を対象としています。

- 本システムのバックエンド開発担当者
- 本システムのフロントエンド開発担当者
- 本システムのテスト担当者
- プロジェクト管理者

### 1.4. 参考文献

- " Welcome to TEINEI "   基本設計書 Ver.1.0
- (チーム内で使用するコーディング規約などがあれば記載)

## 2. システム概要

システムの目的、対象ユーザー、全体構成、外部インターフェースについては、基本設計書 Ver.1.0 の「2. システム概要」に記載の通りです。

**システム構成（再掲）**

<div class="mermaid">
graph LR
  subgraph クライアント環境
    PC[PCブラウザ<br>（Chrome / Edge）]
    SP[スマートフォン<br>（Safari / Chrome）]

  end

INTERNET[インターネット]

  subgraph AWS環境[（クラウド）]
    LB[ALB （ロードバランサ）]
    WEB[Web/APサーバ　`<br>`（Java）]
    DB[DBサーバ `<br>`（MySQL 8.0）]
    FS[ファイルストレージ `<br>`（S3等）]
    WAF[WAF `<br>`（AWS WAF / Cloudflare）]
  end

  PC -->|HTTPS| INTERNET -->|TLS通信| WAF --> LB --> WEB
  SP -->|HTTPS| INTERNET

  WEB -->|API / DB接続| DB
  WEB -->|画像取得・保存| FS

  style PC fill:#ffffcc,stroke:#333,stroke-width:1px
  style SP fill:#ffffcc,stroke:#333,stroke-width:1px
  style INTERNET fill:#eee,stroke:#999,stroke-width:1px,stroke-dasharray: 5 5
  style WAF fill:#ffcc99,stroke:#333,stroke-width:1px
  style LB fill:#cce5ff,stroke:#333,stroke-width:2px
  style WEB fill:#cce5ff,stroke:#333,stroke-width:2px
  style DB fill:#ccffcc,stroke:#333,stroke-width:1px
  style FS fill:#eeeeee,stroke:#333,stroke-width:1px

</div>

## 3. 機能設計

### 3.1. 機能一覧

| 機能ID | 機能名                         | 概要                                                                      | MoSCoW | 備考                                                                    |
| ------ | ------------------------------ | ------------------------------------------------------------------------- | ------ | ----------------------------------------------------------------------- |
| F01    | ログイン/ログアウト機能        | 登録済みのユーザーが認証してログイン/ログアウトできる機能。               | Must   | JWTなどの認証方式を想定。ログイン状態はセッションまたはトークンで管理。 |
| F02    | ユーザー情報登録機能           | 新規ユーザーが会員登録し、ユーザー情報をDBに登録する。                    | Must   | メールアドレス、パスワード、氏名等を登録。                              |
| F03    | マイページ表示・編集機能       | ログインユーザーが登録済み情報を表示・変更できる機能。                    | Should | 登録情報の編集・パスワード変更等。                                      |
| F04    | 商品一覧表示機能               | 商品をカテゴリ別に分類し、無限スクロールで一覧表示。                      | Must   | 商品件数が多くてもUXを損なわないよう無限スクロールを実装。              |
| F05    | 商品詳細ページ表示             | 商品IDに紐づいた詳細情報（写真、価格、素材、納期予定など）を表示。        | Must   | 商品IDによる動的ルーティング。画像複数対応も想定。                      |
| F06    | カテゴリ絞込                   | カテゴリ別に商品を絞り込んで表示する。                                    | Should | 簡易検索機能もCouldで対応可能。                                         |
| F07    | カート追加機能                 | 商品一覧または詳細から商品をカートに追加できる機能。                      | Must   | 商品ID、数量、価格などをカート情報に追加。                              |
| F08    | カート表示・数量編集機能       | カート内商品の一覧表示・数量の増減・削除ができる。                        | Must   | 小計、合計金額も表示。                                                  |
| F09    | カート状態保持機能             | セッション/ローカルストレージにより、未ログイン状態でもカート情報を保持。 | Should | ログイン後にサーバ側カートとマージする想定。                            |
| F10    | 注文情報入力                   | 氏名・住所・連絡先などを入力するフォーム画面を表示。                      | Must   | 会員は自動入力。非会員は手入力。                                        |
| F11    | 注文情報確認                   | 入力内容・カート内容を最終確認する画面を表示。                            | Must   | 注文内容、配送先情報などの確認。                                        |
| F12    | 注文確定                       | 確定ボタン押下時に注文情報をDBに登録。                                    | Must   | 実際の決済処理は行わない。                                              |
| F13    | 注文完了表示                   | 正常に注文が完了したことを伝える完了画面を表示。                          | Must   | 注文番号などを表示。                                                    |
| F14    | スマホUI最適化機能             | 各画面でレスポンシブデザインによりスマホでも最適表示されるよう対応。      | Must   | スマホ特有のナビゲーションUIを適用（ハンバーガーメニュー等）。          |
| F15    | 管理者ログイン、ログアウト機能 | 管理者が管理画面にログイン、ログアウトする機能。                          | Must   |                                                                         |
| F16    | 商品情報管理機能               | 管理者が商品情報、カテゴリの追加・削除・編集を行う機能。                  | Must   | 管理者認証後のみアクセス可能。                                          |
| F17    | 注文情報確認機能（管理者）     | 管理者が注文情報を確認できる機能。                                        | must   | 商品発送管理などの発展機能のベースとして。                              |

---

### 3.2. 機能詳細

主要機能における、ユーザー操作から始まるフロントエンドとバックエンドAPI間の連携、およびバックエンド内部のクラス間連携の概要をシーケンス図で示します。

（APIの詳細な仕様は「５.インターフェース仕様（API）」を参照してください。

#### 3.2.1.  ログイン/ログアウト機能

ユーザーがECサイトにログインし、セッションにより認証状態を維持する機能です。またログアウト操作により認証状態を解除します。

【ログイン】

<div class=mermaid>

sequenceDiagram
participant ユーザー
participant フロントエンド
participant AuthController as バックエンド(AuthController)
participant AuthService as バックエンド(AuthService)
participant UserRepository as DB(UserRepository)
participant JwtTokenProvider as バックエンド(JwtTokenProvider)
participant PasswordEncoder as バックエンド(PasswordEncoder)

ユーザー ->> フロントエンド: メール・パスワード入力してログインフォーム送信
フロントエンド ->> AuthController: POST /api/auth/login リクエスト(email, password)
AuthController ->> AuthService: authenticate(email, password) 呼び出し
AuthService ->> UserRepository: findByEmail(email)
UserRepository -->> AuthService: UserEntity（hashedPassword含む）返却
AuthService ->> PasswordEncoder: matches(入力PW, hashedPassword)
alt パスワード一致
    AuthService ->> JwtTokenProvider: generateAccessToken(UserEntity)
    JwtTokenProvider -->> AuthService: アクセストークン文字列返却
    AuthService ->> JwtTokenProvider: generateRefreshToken(UserEntity)
    JwtTokenProvider -->> AuthService: リフレッシュトークン文字列返却
    AuthService -->> AuthController: トークンペアを返す
    AuthController -->> フロントエンド: 200 OK + JSON{accessToken, refreshToken}
    フロントエンド -->> ユーザー: ログイン成功、画面遷移
else 認証失敗（パスワード不一致 or ユーザー無し）
    AuthService -->> AuthController: 認証失敗例外スロー
    AuthController -->> フロントエンド: 401 Unauthorized + エラーメッセージ
    フロントエンド -->> ユーザー: エラーメッセージ表示
end

</div>

【ログアウト】

<div class=mermaid>

sequenceDiagram
participant ユーザー
participant フロントエンド
participant AuthController as バックエンド(AuthController)
participant RefreshTokenRepository as DB(RefreshTokenRepository)

ユーザー ->> フロントエンド: 「ログアウト」ボタン押下
フロントエンド ->> フロントエンド: ローカルに保存したアクセストークン・リフレッシュトークンを削除
フロントエンド ->> AuthController: POST /api/auth/logout リクエスト（リフレッシュトークン送信）
alt サーバー側でリフレッシュトークン管理有り
    AuthController ->> RefreshTokenRepository: deleteByToken(リフレッシュトークン)
    RefreshTokenRepository -->> AuthController: 削除完了
    AuthController -->> フロントエンド: 200 OK レスポンス
else トークン管理なし（省略可能）
    AuthController -->> フロントエンド: 200 OK レスポンス
end
フロントエンド -->> ユーザー: ログアウト完了、ログイン画面へ遷移

</div>

#### 3.2.2 ユーザー情報登録機能

新規ユーザーが会員情報（ユーザーID・パスワード・氏名・住所・メールアドレス）を入力し、DBに登録するフローです。

<div class=mermaid>
sequenceDiagram
participant ユーザー
participant フロントエンド
participant UserController as バックエンド(UserController)
participant UserService as バックエンド(UserService)
participant UserRepository as DB(UserRepository)
participant PasswordEncoder as バックエンド(PasswordEncoder)

ユーザー ->> フロントエンド: ユーザー情報入力（名前、メール、パスワード等）して送信
フロントエンド ->> UserController: POST /api/users リクエスト(ユーザー情報)
UserController ->> UserService: registerUser(ユーザー情報)
UserService ->> UserRepository: findByEmail(email)
alt メール重複なし
    UserRepository -->> UserService: null（該当なし）
    UserService ->> PasswordEncoder: encode(パスワード)
    PasswordEncoder -->> UserService: ハッシュ済みパスワード
    UserService ->> UserRepository: save(UserEntity)
    UserRepository -->> UserService: 保存済みUserEntity返却
    UserService -->> UserController: 登録成功レスポンス
    UserController -->> フロントエンド: 201 Created + 登録成功メッセージ
    フロントエンド -->> ユーザー: 登録成功の画面遷移・メッセージ表示
else メール重複あり
    UserRepository -->> UserService: 既存ユーザー返却
    UserService -->> UserController: 409 Conflict 例外スロー
    UserController -->> フロントエンド: 409 Conflict + エラーメッセージ
    フロントエンド -->> ユーザー: エラーメッセージ表示
end

</div>

#### 3.2.3 商品一覧表示機能

ユーザーが商品一覧ページにアクセスした際の処理フローです。

<div class=mermaid>
sequenceDiagram
participant ユーザー
participant フロントエンド
participant ProductController as バックエンド(ProductController)
participant ProductService as バックエンド(ProductService)
participant ProductRepository as DB(ProductRepository)

ユーザー ->> フロントエンド: 商品一覧ページ表示要求
フロントエンド ->> ProductController: GET /api/products リクエスト
ProductController ->> ProductService: getAllProducts()
ProductService ->> ProductRepository: findAll()
ProductRepository -->> ProductService: 商品一覧データ（リスト）返却
ProductService -->> ProductController: 商品一覧データ返却
ProductController -->> フロントエンド: 200 OK + 商品一覧JSONデータ
フロントエンド -->> ユーザー: 商品一覧画面表示

</div>

#### 3.2.4 商品詳細表示機能

ユーザーが商品一覧から特定の商品を選択し、詳細情報（商品画像・価格・素材・納期）を表示する際の処理フローです。

<div class=mermaid>
sequenceDiagram
participant ユーザー
participant フロントエンド
participant ProductController as バックエンド(ProductController)
participant ProductService as バックエンド(ProductService)
participant ProductRepository as DB(ProductRepository)

ユーザー ->> フロントエンド: 商品詳細ページ表示要求（商品ID指定）
フロントエンド ->> ProductController: GET /api/products/{productId}
ProductController ->> ProductService: getProductById(productId)
ProductService ->> ProductRepository: findById(productId)
alt 商品あり
    ProductRepository -->> ProductService: 商品Entity返却
    ProductService -->> ProductController: 商品データ返却
    ProductController -->> フロントエンド: 200 OK + 商品詳細JSONデータ
    フロントエンド -->> ユーザー: 商品詳細画面表示
else 商品なし
    ProductRepository -->> ProductService: null
    ProductService -->> ProductController: 404 Not Found例外スロー
    ProductController -->> フロントエンド: 404 Not Found + エラーメッセージ
    フロントエンド -->> ユーザー: エラーメッセージ表示
end

</div>

#### 3.2.5 カート追加機能

ユーザーが商品詳細ページで「カートに入れる」ボタンを押した際の処理フローです。カート情報はHTTPセッションで管理します。

 APIサーバーのカート情報DBと連携して商品を管理。ログイン時はローカルのカートとサーバー側カートをマージ。

<div class="mermaid">

sequenceDiagram
participant ユーザー
participant フロントエンド
participant CartController as バックエンド(CartController)
participant CartService as バックエンド(CartService)
participant CartRepository as DB(CartRepository)
participant ProductRepository as DB(ProductRepository)

ユーザー ->> フロントエンド: 商品選択、数量入力して「カートに追加」クリック
フロントエンド ->> CartController: POST /api/cart/add リクエスト(商品ID、数量、ユーザーID)
CartController ->> CartService: addToCart(ユーザーID, 商品ID, 数量)
CartService ->> ProductRepository: findById(商品ID)
alt 商品あり
    ProductRepository -->> CartService: 商品Entity返却
    CartService ->> CartRepository: findByUserIdAndProductId(ユーザーID, 商品ID)
    alt カート内に同商品あり
        CartRepository -->> CartService: カート商品Entity返却
        CartService ->> CartRepository: 数量更新(save)
    else カート内に同商品なし
        CartRepository -->> CartService: null
        CartService ->> CartRepository: 新規カート商品Entity保存(save)
    end
    CartRepository -->> CartService: 保存済みカート商品Entity返却
    CartService -->> CartController: 追加成功レスポンス
    CartController -->> フロントエンド: 200 OK + メッセージ
    フロントエンド -->> ユーザー: 「カートに追加されました」表示
else 商品なし
    ProductRepository -->> CartService: null
    CartService -->> CartController: 404 Not Found例外スロー
    CartController -->> フロントエンド: 404 Not Found + エラーメッセージ
    フロントエンド -->> ユーザー: エラーメッセージ表示
end

</div>

**補足:**

- カートオブジェクト (`Cart`) やカート内アイテム (`CartItem`) のクラス設計は「4. クラス設計」で定義します。
- Spring Boot標準のHttpSession利用を基本とします。

#### 3.2.6 カート表示・編集機能

ユーザーがカートの中身を確認、数量変更、削除する際の処理フローです。

 サーバーのカート情報をAPI経由で取得し表示。数量変更や削除はDBへ反映。

**カート情報取得 (GET /api/cart)**

<div class="mermaid">

sequenceDiagram
participant ユーザー
participant フロントエンド
participant CartController as バックエンド(CartController)
participant CartService as バックエンド(CartService)
participant CartRepository as DB(CartRepository)
participant ProductRepository as DB(ProductRepository)

ユーザー ->> フロントエンド: カートページ表示要求
フロントエンド ->> CartController: GET /api/cart?userId=xxx
CartController ->> CartService: getCartByUserId(userId)
CartService ->> CartRepository: findByUserId(userId)
CartRepository -->> CartService: カート商品一覧返却
loop カート内商品分繰返し
    CartService ->> ProductRepository: findById(商品ID)
    ProductRepository -->> CartService: 商品Entity返却
end
CartService -->> CartController: カート詳細データ返却
CartController -->> フロントエンド: 200 OK + カート詳細JSONデータ
フロントエンド -->> ユーザー: カート画面表示

ユーザー ->> フロントエンド: 数量変更、商品削除操作
フロントエンド ->> CartController: PUT /api/cart/update or DELETE /api/cart/remove
CartController ->> CartService: updateCartItem or removeCartItem
CartService ->> CartRepository: 対象カート商品Entity取得・更新または削除
CartRepository -->> CartService: 更新・削除結果返却
CartService -->> CartController: 更新成功レスポンス
CartController -->> フロントエンド: 200 OK + メッセージ
フロントエンド -->> ユーザー: 変更反映・メッセージ表示

</div>

**カート数量変更 (PUT /api/cart/items/{itemId})**

**カート商品削除 (DELETE /api/cart/items/{itemId})** (上記PUTと同様の流れ)

<div class="mermaid">

sequenceDiagram
participant ユーザー
participant フロントエンド
participant CartController
participant CartService
participant CartItemRepository
participant DB

ユーザー ->> フロントエンド: 数量変更操作（+ / − ボタン）

alt 新しい数量 > 0（数量変更）
    フロントエンド ->> CartController: PUT /api/cart/items/{itemId}（数量: n）
    CartController ->> CartService: updateCartItemQuantity(itemId, n)
    CartService ->> CartItemRepository: findById(itemId)
    CartItemRepository -->> CartService: カート商品Entity取得
    CartService ->> CartItemRepository: updateQuantity(itemId, n)
    CartItemRepository ->> DB: UPDATE クエリ実行
    DB -->> CartItemRepository: 更新完了
    CartItemRepository -->> CartService: 更新済みカート商品Entity
    CartService -->> CartController: 更新成功
    CartController -->> フロントエンド: 200 OK + 更新後カート商品情報
    フロントエンド -->> ユーザー: UIに新しい数量を反映

else 新しい数量 = 0（削除）
    フロントエンド ->> CartController: DELETE /api/cart/items/{itemId}
    CartController ->> CartService: deleteCartItem(itemId)
    CartService ->> CartItemRepository: findById(itemId)
    CartItemRepository -->> CartService: カート商品Entity取得
    CartService ->> CartItemRepository: delete(itemId)
    CartItemRepository ->> DB: DELETE クエリ実行
    DB -->> CartItemRepository: 削除完了
    CartItemRepository -->> CartService: 削除完了
    CartService -->> CartController: 削除成功
    CartController -->> フロントエンド: 200 OK
    フロントエンド -->> ユーザー: UIから該当商品を削除
end

</div>

#### 3.2.7 注文情報入力機能

注文に必要な氏名・住所・連絡先等の入力フォームを表示。
会員は登録情報を自動補完。

非会員は手入力で情報を登録。

<div class="mermaid">

sequenceDiagram
participant ユーザー
participant フロントエンド
participant OrderController as バックエンド(OrderController)
participant OrderService as バックエンド(OrderService)
participant UserRepository as DB(UserRepository)
participant CartRepository as DB(CartRepository)

ユーザー ->> フロントエンド: 注文情報入力フォーム表示要求
フロントエンド ->> OrderController: GET /api/order/input?userId=xxx
OrderController ->> UserRepository: findById(userId)
UserRepository -->> OrderController: ユーザー情報返却
OrderController ->> CartRepository: findByUserId(userId)
CartRepository -->> OrderController: カート商品一覧返却
OrderController -->> フロントエンド: 200 OK + 注文入力画面用データ（ユーザー情報・カート情報）
フロントエンド -->> ユーザー: 注文入力画面表示

ユーザー ->> フロントエンド: 配送先・支払い方法など注文情報入力し送信
フロントエンド ->> OrderController: POST /api/order/input リクエスト(注文情報)
OrderController -->> ユーザー: 入力内容確認画面表示（省略）

</div>

#### 3.2.8 注文確定処理

ユーザーが注文確認画面で「注文を確定する」ボタンを押した際の処理フローです。

<div class="mermaid">

sequenceDiagram
participant ユーザー
participant フロントエンド
participant OrderController as バックエンド(OrderController)
participant OrderService as バックエンド(OrderService)
participant OrderRepository as DB(OrderRepository)
participant CartRepository as DB(CartRepository)
participant ProductRepository as DB(ProductRepository)

ユーザー ->> フロントエンド: 注文確定ボタン押下
フロントエンド ->> OrderController: POST /api/order/confirm リクエスト(注文確定データ)
OrderController ->> OrderService: confirmOrder(注文データ)
OrderService ->> CartRepository: findByUserId(ユーザーID)
CartRepository -->> OrderService: カート商品一覧返却
loop
    OrderService ->> ProductRepository: findById(商品ID)
    ProductRepository -->> OrderService: 商品Entity返却

end
OrderService ->> OrderRepository: 新規注文情報保存
OrderRepository -->> OrderService: 保存済み注文Entity返却
OrderService ->> CartRepository: カート内商品削除（クリア）
OrderService -->> OrderController: 注文確定成功レスポンス
OrderController -->> フロントエンド: 201 Created + 注文完了画面データ
フロントエンド -->> ユーザー: 注文完了画面表示

</div>

**補足:**

- `@Transactional` アノテーションを `OrderService#placeOrder` メソッドに付与し、DB操作の原子性を保証します。

#### 3.2.9 商品情報管理機能（管理者）

管理者認証後、商品情報、カテゴリの追加・編集・削除を行う機能です。

【商品情報編集】

<div class="mermaid">

sequenceDiagram
participant 管理者
participant フロントエンド
participant AdminProductController as バックエンド(AdminProductController)
participant ProductService as バックエンド(ProductService)
participant ProductRepository as DB(ProductRepository)
participant CategoryRepository as DB(CategoryRepository)

管理者 ->> フロントエンド: 商品一覧画面表示要求
フロントエンド ->> AdminProductController: GET /api/admin/products
AdminProductController ->> ProductService: getAllProducts()
ProductService ->> ProductRepository: findAll()
ProductRepository -->> ProductService: 商品一覧返却
ProductService -->> AdminProductController: 商品一覧返却
AdminProductController -->> フロントエンド: 200 OK + 商品一覧データ
フロントエンド -->> 管理者: 商品一覧表示

管理者 ->> フロントエンド: 商品編集画面表示要求（商品ID指定）
フロントエンド ->> AdminProductController: GET /api/admin/products/{productId}
AdminProductController ->> ProductService: getProductById(productId)
ProductService ->> ProductRepository: findById(productId)
ProductRepository -->> ProductService: 商品Entity返却
AdminProductController ->> CategoryRepository: findAll()
CategoryRepository -->> AdminProductController: カテゴリ一覧返却
AdminProductController -->> フロントエンド: 200 OK + 商品詳細＋カテゴリ一覧データ
フロントエンド -->> 管理者: 商品編集画面表示

管理者 ->> フロントエンド: 編集内容入力し更新要求
フロントエンド ->> AdminProductController: PUT /api/admin/products/{productId} リクエスト(編集データ)
AdminProductController ->> ProductService: updateProduct(productId, 編集データ)
ProductService ->> ProductRepository: save(更新商品Entity)
ProductRepository -->> ProductService: 保存済み商品Entity返却
ProductService -->> AdminProductController: 更新成功レスポンス
AdminProductController -->> フロントエンド: 200 OK + メッセージ
フロントエンド -->> 管理者: 更新成功メッセージ表示

</div>

【カテゴリ編集】

<div class="mermaid">

sequenceDiagram
participant 管理者
participant フロントエンド
participant AdminCategoryController as バックエンド(AdminCategoryController)
participant CategoryService as バックエンド(CategoryService)
participant CategoryRepository as DB(CategoryRepository)

管理者 ->> フロントエンド: カテゴリ一覧表示要求
フロントエンド ->> AdminCategoryController: GET /api/admin/categories
AdminCategoryController ->> CategoryService: getAllCategories()
CategoryService ->> CategoryRepository: findAll()
CategoryRepository -->> CategoryService: カテゴリ一覧返却
CategoryService -->> AdminCategoryController: カテゴリ一覧返却
AdminCategoryController -->> フロントエンド: 200 OK + カテゴリ一覧データ
フロントエンド -->> 管理者: カテゴリ一覧表示

管理者 ->> フロントエンド: カテゴリ新規作成入力画面表示
フロントエンド ->> AdminCategoryController: GET /api/admin/categories/new
AdminCategoryController -->> フロントエンド: 新規作成フォーム表示

管理者 ->> フロントエンド: 新規カテゴリ情報入力し送信
フロントエンド ->> AdminCategoryController: POST /api/admin/categories リクエスト(新規カテゴリデータ)
AdminCategoryController ->> CategoryService: createCategory(カテゴリデータ)
CategoryService ->> CategoryRepository: save(新規カテゴリEntity)
CategoryRepository -->> CategoryService: 保存済みカテゴリEntity返却
CategoryService -->> AdminCategoryController: 作成成功レスポンス
AdminCategoryController -->> フロントエンド: 201 Created + メッセージ
フロントエンド -->> 管理者: 作成成功メッセージ表示

管理者 ->> フロントエンド: カテゴリ編集画面表示要求（カテゴリID指定）
フロントエンド ->> AdminCategoryController: GET /api/admin/categories/{categoryId}
AdminCategoryController ->> CategoryService: getCategoryById(categoryId)
CategoryService ->> CategoryRepository: findById(categoryId)
CategoryRepository -->> CategoryService: カテゴリEntity返却
AdminCategoryController -->> フロントエンド: 200 OK + カテゴリ詳細データ
フロントエンド -->> 管理者: 編集画面表示

管理者 ->> フロントエンド: 編集内容入力し更新要求
フロントエンド ->> AdminCategoryController: PUT /api/admin/categories/{categoryId} リクエスト(編集データ)
AdminCategoryController ->> CategoryService: updateCategory(categoryId, 編集データ)
CategoryService ->> CategoryRepository: save(更新カテゴリEntity)
CategoryRepository -->> CategoryService: 保存済みカテゴリEntity返却
CategoryService -->> AdminCategoryController: 更新成功レスポンス
AdminCategoryController -->> フロントエンド: 200 OK + メッセージ
フロントエンド -->> 管理者: 更新成功メッセージ表示

管理者 ->> フロントエンド: カテゴリ削除要求（カテゴリID指定）
フロントエンド ->> AdminCategoryController: DELETE /api/admin/categories/{categoryId}
AdminCategoryController ->> CategoryService: deleteCategory(categoryId)
CategoryService ->> CategoryRepository: deleteById(categoryId)
CategoryRepository -->> CategoryService: 削除完了
CategoryService -->> AdminCategoryController: 削除成功レスポンス
AdminCategoryController -->> フロントエンド: 200 OK + メッセージ
フロントエンド -->> 管理者: 削除成功メッセージ表示

</div>

#### 3.2.10 注文情報確認機能（管理者）

管理者が注文情報一覧・詳細で閲覧可能。発送管理などの拡張の基盤となります。

<div class="mermaid">

sequenceDiagram
participant 管理者
participant フロントエンド
participant AdminOrderController as バックエンド(AdminOrderController)
participant OrderService as バックエンド(OrderService)
participant OrderRepository as DB(OrderRepository)

管理者 ->> フロントエンド: 注文一覧画面表示要求
フロントエンド ->> AdminOrderController: GET /api/admin/orders
AdminOrderController ->> OrderService: getAllOrders()
OrderService ->> OrderRepository: findAll()
OrderRepository -->> OrderService: 注文一覧返却
OrderService -->> AdminOrderController: 注文一覧返却
AdminOrderController -->> フロントエンド: 200 OK + 注文一覧データ
フロントエンド -->> 管理者: 注文一覧表示

管理者 ->> フロントエンド: 注文詳細画面表示要求（注文ID指定）
フロントエンド ->> AdminOrderController: GET /api/admin/orders/{orderId}
AdminOrderController ->> OrderService: getOrderById(orderId)
OrderService ->> OrderRepository: findById(orderId)
OrderRepository -->> OrderService: 注文Entity返却
AdminOrderController -->> フロントエンド: 200 OK + 注文詳細データ
フロントエンド -->> 管理者: 注文詳細画面表示

</div>

## 4. クラス設計

### 4.1　主要パッケージ構成

ソースコードの整理と見通しを良くするため、以下のようなパッケージ構成を基本とします。ルートパッケージは `com.simplezakka`とします。

com.simplezakka
├── SimpleZakkaOnlineApplication.java  // Spring Boot起動クラス
│
├── controller  # 各種エンドポイントを提供するWeb層
│   ├── admin
│   │   ├── auth
│   │   │   └── AdminAuthController   // 管理者ログインAPI
│   │   ├── order
│   │   │   └── AdminOrderController  // 管理者による注文管理API
│   │   └── product
│   │       ├── AdminProductController   // 商品の登録・編集・削除API
│   │       └── AdminCategoryController  // カテゴリの登録・編集API
│   ├── auth
│   │   └── AuthController  // ユーザー認証（ログイン/ログアウト）API
│   ├── cart
│   │   └── CartController  // カート操作API
│   ├── order
│   │   └── OrderController  // ログインユーザーの注文API
│   ├── guestorder
│   │   └── GuestOrderController  // 未ログイン注文API
│   └── product
│       └── ProductController   // 商品一覧・詳細取得API

├── service  # ビジネスロジックを担うサービス層
│   ├── admin
│   │   ├── auth
│   │   │   └── AdminAuthService  // 管理者の認証処理
│   │   ├── order
│   │   │   └── AdminOrderService  // 管理者向け注文管理ロジック
│   │   └── product
│   │       ├── ProductService  // 商品の登録/編集/削除ロジック
│   │       └── CategoryService  // カテゴリの登録/編集ロジック
│   ├── auth
│   │   └── AuthService  // ユーザー認証処理
│   ├── cart
│   │   └── CartService  // カート操作ロジック（セッション or DB）
│   ├── order
│   │   └── OrderService // ログイン注文処理ロジック
│   ├── guestorder
│   │   └── GuestOrderService  // 未ログイン注文処理ロジック
│   └── product
│       └── ProductService  // 商品表示用ロジック（エンドユーザー向け）

├── repository    # DBアクセス層（Spring Data JPAなど）
│   ├── admin
│   │   ├── auth
│   │   │   └── AdminRepository    // 管理者情報の取得
│   │   ├── order
│   │   │   └── OrderDetailRepository  // 管理者向け注文詳細取得
│   │   └── product
│   │       ├── ProductRepository  // 商品情報の登録・取得
│   │       └── CategoryRepository  // カテゴリ情報の登録・取得
│   ├── auth
│   │   └── UserRepository // ユーザー情報の取得
│   ├── cart
│   │   ├── DbCartRepository  // DBに保存されたカートの取得・保存
│   │   └── ProductRepository  // 商品価格取得用（カート内商品参照用）
│   ├── order
│   │   ├── OrderRepository  // 注文の保存・取得
│   │   ├── OrderItemRepository   // 注文商品の保存
│   │   ├── ProductRepository   // 商品参照
│   │   └── UserRepository   // ユーザー参照
│   └── guestorder
│       ├── OrderRepository  // ゲスト注文の保存
│       ├── OrderItemRepository  // ゲスト注文商品の保存
│       └── ProductRepository   // ゲスト注文用商品の参照

├── entity  # 永続化対象のドメインエンティティ
│   ├── admin
│   │   ├── auth
│   │   │   └── Admin  // 管理者アカウント情報
│   │   ├── order
│   │   │   ├── Order   // 管理注文
│   │   │   └── OrderDetail  // 注文明細
│   │   └── product
│   │       ├── Product  // 商品
│   │       ├── Category  // カテゴリ
│   │       └── ProductImage  // 商品画像
│   ├── auth
│   │   └── User  // 一般ユーザー
│   ├── cart
│   │   ├── CartEntity   // カート本体（DB用）
│   │   ├── CartItemEntity  // カートアイテム（DB用）
│   │   └── Product   // 商品（簡略）
│   ├── order
│   │   ├── Order  // ログインユーザーの注文
│   │   ├── OrderItem  // 注文アイテム
│   │   ├── Product  // 商品
│   │   └── User   // ユーザー
│   └── guestorder
│       ├── Order  // 未ログイン注文
│       ├── OrderItem   // 未ログイン注文アイテム
│       └── Product   // 商品

├── dto  # クライアントとのデータ交換用クラス群（DTO/Form）
│   ├── admin
│   │   ├── auth
│   │   │   ├── AdminLoginRequest   // 管理者ログインリクエスト
│   │   │   ├── AdminLoginResponse  // 管理者ログインレスポンス
│   │   │   └── AdminSession // 管理者セッション情報
│   │   ├── order
│   │   │   ├── OrderSummaryDto  // 注文一覧表示用
│   │   │   ├── OrderDetailDto  // 注文詳細表示用
│   │   │   ├── OrderItemDto  // 商品明細
│   │   │   └── OrderStatusUpdateRequest  // ステータス更新リクエスト
│   │   └── product
│   │       ├── ProductForm  // 商品作成・更新用
│   │       ├── ProductAdminView  // 管理画面用商品表示
│   │       ├── CategoryForm   // カテゴリ作成用
│   │       └── CategoryView   // カテゴリ表示用
│   ├── auth
│   │   ├── LoginRequest   // ログインリクエスト
│   │   ├── LoginResponse  // ログインレスポンス
│   │   └── UserSession  // 認証後のセッション情報
│   ├── cart
│   │   ├── Cart  // カート情報
│   │   ├── CartItem  // カート内商品
│   │   └── CartItemInfo  // 追加・更新リクエスト
│   ├── order
│   │   ├── UserOrderInfo　// 注文前確認情報
│   │   ├── OrderRequest  // 注文リクエスト
│   │   ├── OrderResponse  // 注文完了レスポンス
│   │   ├── OrderItemDto  // 注文内商品のDTO
│   │   ├── OrderTotals  // 合計金額など
│   │   ├── Cart  // カート
│   │   └── CartItem  // カート商品
│   ├── guestorder
│   │   ├── OrderRequest  // ゲスト注文リクエスト
│   │   ├── OrderResponse  // ゲスト注文レスポンス
│   │   ├── CustomerInfo  // ゲストの名前・住所など
│   │   ├── Cart  // カート
│   │   ├── CartItem  // カート商品
│   │   ├── OrderItemDto 　// 商品明細
│   │   └── OrderTotals  // 合計金額
│   └── product
│       ├── ProductListItem  // 商品一覧表示用
│       ├── ProductDetail  // 商品詳細表示用
│       └── ProductImageDto  // 画像情報

├── validator   # 入力検証などのロジック
│   ├── product
│   │   └── ProductValidator  // 商品ID等の検証
│   ├── cart
│   │   └── CartValidator // 数量・商品IDのバリデーション
│   ├── order
│   │   └── OrderValidator // 注文リクエストの検証
│   └── guestorder
│       ├── OrderValidator // ゲスト注文のバリデーション
│       └── CartValidator // ゲスト用カートバリデーション

├── strategy  # ストラテジーパターンを用いた保存方法の切り替え
│   ├── cart
│   │   ├── CartStorageStrategy  // インターフェース
│   │   ├── SessionCartStorage // セッションベースの保存
│   │   └── DatabaseCartStorage // DBベースの保存
│   └── order
│       ├── CartStorageStrategy
│       └── DatabaseCartStorage

├── storage # セッションストレージ（主にゲスト用）
│   └── guestorder
│       └── SessionCartStorage // セッション内カート操作

├── exception # 各種例外およびエラーコード
│   ├── auth
│   │   ├── AuthenticationException  // 認証失敗時例外
│   │   └── ErrorCode  // 認証系エラーコード
│   ├── cart
│   │   ├── CartException  // カート例外
│   │   ├── ProductNotFoundException // 商品が存在しない場合
│   │   ├── InvalidQuantityException  // 数量が不正な場合
│   │   └── CartErrorCode // カート用エラーコード
│   ├── product
│   │   ├── ProductNotFoundException　// 商品が見つからない
│   │   ├── ProductServiceException  // サービス側の例外
│   │   └── ErrorCode   // 商品系エラーコード
│   ├── order
│   │   ├── OrderException // 注文処理中の一般的な例外
│   │   ├── UserNotFoundException // ユーザーが見つからない
│   │   ├── EmptyCartException // カートが空の場合
│   │   └── OrderErrorCode   // 注文用エラーコード
│   └── guestorder
│       ├── OrderException
│       ├── EmptyCartException
│       ├── InvalidCustomerInfoException
│       └── OrderErrorCode

├── enum    # 列挙型
│   ├── order
│   │   └── OrderStatus   // 注文の状態（PENDINGなど）
│   └── guestorder
│       └── OrderStatus  // ゲスト注文の状態（共通で使える）

└── security   # 認証関連（管理者など）
　   └── admin
　       └── auth
　          └── PasswordEncoder  // パスワードのハッシュ化/照合

### 4.2 クラス設計（4.2.4まで完成）

主要な機能ドメイン（ログイン、商品、カート、注文、管理）に関するクラスとその関連を示します。

#### 4.2.1 ログイン機能ドメイン認証

<div class=mermaid>
classDiagram
    class AuthController {
        +login(LoginRequest): ResponseEntity~LoginResponse~
        +logout(): void
    }

    class AuthService {
        +authenticate(user_email, user_password): UserSession
        +generationToken(user):String
        +validatePassword(rawPassword, hashedPassword):boolean
    }

    class UserRepository {
        <`<interface>`>
        +findByEmail(user_email,user_password): Optional~User~
    }

    class User {
        <`<Entity>`>
        +Integer user_id
        +String user_email
        +String user_password_hash
        +String user_name
        +String user_address
    }

    class LoginRequest {
        <`<DTO>`>
        +String user_email
        +String user_password
    }

    class LoginResponse {
        <`<DTO>`>
        +String token
        +String user_id
        +boolean memberhsip
    }

    class UserSession {
        <`<DTO>`>
        +String role
        +String user_email
        +String user_name
    }

    class AuthenticationException {
        <`<Exception>`>
        +String message
        +ErrorCode error_code
    }

    class ErrorCode {
        <`<Enum>`>
        INVALID_CREDENTIALS
        USER_NOT_FOUND
        ACCOUNT_LOCKED
    }

    AuthController --> AuthService
    AuthService --> UserRepository
    UserRepository --> User
    AuthController ..> LoginRequest : receives
    AuthController ..> LoginResponse : returns
    AuthService ..> UserSession : returns
    AuthService ..> AuthenticationException:throws
    AuthenticationException --> ErrorCode

</div>

#### 4.2.2 商品ドメイン

<div class=mermaid>
classDiagram
    %% === Controller層 ===
    class ProductController {
        +getAllProducts(): ResponseEntity~List~ProductListItem~~
        +getProductById(product_id): ResponseEntity~ProductDetail~
    }

    %% === Service層 ===
    class ProductService {
        +getAllProducts(): List~ProductListItem~
        +getProductDetail(product_id): ProductDetail
    }

    %% === Repository層 ===
    class ProductRepository {
        <`<interface>`>
        +findAll(): List~Product~
        +findById(product_id): Optional~Product~
        +findByIdWithCategoryAndImages(product_id): Optional~Product~
    }

    %% === Entity層 ===
    class Product {
        <`<Entity>`>
        +String product_id
        +String product_name
        +String description
        +BigDecimal product_price
        +Integer stock_quantity
        +LocalDateTime created_at
        +LocalDateTime updated_at
        +String category_id
        +Category category
        +List~ProductImage~ images
    }

    class Category {
        <`<Entity>`>
        +String category_id
        +String category_name
        +String category_description
        +Integer display_order
    }

    class ProductImage {
        <`<Entity>`>
        +String image_id
        +String product_id
        +String image_url
        +String alt_text
        +Integer sort_order
        +Boolean is_primary
    }

    %% === DTO層 ===
    class ProductListItem {
        <`<DTO>`>
        +String product_id
        +String product_name
        +BigDecimal product_price
        +String category_name
        +String primary_image_url
        +String primary_image_alt
    }

    class ProductDetail {
        <`<DTO>`>
        +String product_id
        +String product_name
        +String description
        +BigDecimal product_price
        +String category_name
        +List~ProductImageDto~ images
        +LocalDateTime created_at
        +LocalDateTime updated_at
    }

    class ProductImage {
        <`<DTO>`>
        +String image_url
        +String alt_text
        +Integer sort_order
        +Boolean is_primary
    }

    %% === Exception層 ===
    class ProductNotFoundException {
        <`<Exception>`>
        +String product_id
        +String message
    }

    class ProductServiceException {
        <`<Exception>`>
        +String message
        +ErrorCode error_code
    }

    class ErrorCode {
        <`<Enum>`>
        PRODUCT_NOT_FOUND
        INVALID_PRODUCT_ID
        PRODUCT_UNAVAILABLE
        INTERNAL_SERVER_ERROR
    }

    %% === Validation層 ===
    class ProductValidator {
        <`<Component>`>
        +validateProductId(product_id): void
    }

    %% === 関係 ===
    ProductController --> ProductService
    ProductController --> ProductValidator
    ProductService --> ProductRepository
    ProductRepository --> Product

    Product --> Category : belongs to
    Product "1" --> "*" ProductImage : has

    ProductController ..> ProductListItem : returns
    ProductController ..> ProductDetail : returns
    ProductDetail --> ProductImage : contains
    ProductService --> ProductImage
    ProductService ..> ProductNotFoundException : throws
    ProductService ..> ProductServiceException : throws
    ProductServiceException --> ErrorCode
    ProductValidator ..> ProductServiceException : throws

</div>

#### 4.2.3 カートドメイン（セッション）

<div class=mermaid>
classDiagram
    %% === Controller層 ===
    class CartController {
        +getCart(HttpSession): ResponseEntity~Cart~
        +addItem(CartItemInfo, HttpSession): ResponseEntity~Cart~
        +updateItem(CartItemInfo, HttpSession): ResponseEntity~Cart~
        +removeItem(product_id, HttpSession): ResponseEntity~Cart~
        +clearCart(HttpSession): ResponseEntity~Void~
    }

    %% === Service層 ===
    class CartService {
        -CartStorageStrategy storage
        -ProductRepository productRepository
        -CartValidator validator
        +addItemToCart(product_id, quantity): Cart
        +updateItemQuantity(product_id, quantity): Cart
        +removeItemFromCart(product_id): Cart
        +getCart(): Cart
        +clearCart(): void
        +calculateTotals(cart): Cart
    }

    %% === Repository層 ===
    class ProductRepository {
        <`<interface>`>
        +findById(product_id): Optional~Product~
    }

    class DbCartRepository {
        <`<interface>`>
        +findByUserId(user_id): Optional~CartEntity~
        +save(CartEntity): CartEntity
        +deleteByUserId(user_id): void
    }

    %% === Entity層 ===
    class Product {
        <`<Entity>`>
        +String product_id
        +String product_name
        +BigDecimal product_price
    }

    class CartEntity {
        <`<Entity>`>
        +String cart_id
        +String user_id
        +LocalDateTime created_at
        +LocalDateTime updated_at
        +List~CartItemEntity~ cart_items
        +Integer total_quantity
        +BigDecimal total_price
    }

    class CartItemEntity {
        <`<Entity>`>
        +String cart_item_id
        +String cart_id
        +String product_id
        +String product_name
        +BigDecimal product_price
        +Integer cart_quantity
        +BigDecimal subtotal
    }

    %% === DTO層 ===
    class Cart {
        <`<DTO>`>
        +String cart_id
        +Map~String, CartItem~ cart_items
        +Integer total_quantity
        +BigDecimal total_price
    }

    class CartItem {
        <`<DTO>`>
        +String product_id
        +String product_name
        +BigDecimal product_price
        +Integer cart_quantity
        +BigDecimal subtotal
    }

    class CartItemInfo {
        <`<DTO>`>
        +String product_id
        +Integer quantity
    }

    %% === Strategy層 ===
    class CartStorageStrategy {
        <`<interface>`>
        +getCart(user_id): Cart
        +saveCart(cart, user_id): void
        +clearCart(user_id): void
    }

    class SessionCartStorage {
        -HttpSession session
        +getCart(user_id): Cart
        +saveCart(cart, user_id): void
        +clearCart(user_id): void
    }

    class DatabaseCartStorage {
        -DbCartRepository repository
        +getCart(user_id): Cart
        +saveCart(cart, user_id): void
        +clearCart(user_id): void
        -toEntity(cart, user_id): CartEntity
        -toDto(cartEntity): Cart
    }

    %% === Validation層 ===
    class CartValidator {
        <`<Component>`>
        +validateProductId(product_id): void
        +validateQuantity(quantity): void
        +validateCartItem(product_id, quantity): void
    }

    %% === Exception層 ===
    class CartException {
        <`<Exception>`>
        +String message
        +CartErrorCode error_code
    }

    class ProductNotFoundException {
        <`<Exception>`>
        +String product_id
        +String message
    }

    class InvalidQuantityException {
        <`<Exception>`>
        +Integer quantity
        +String message
    }

    class CartErrorCode {
        <`<Enum>`>
        PRODUCT_NOT_FOUND
        INVALID_QUANTITY
        CART_ITEM_NOT_FOUND
        CART_OPERATION_FAILED
    }

    %% === 関係 ===
    CartController --> CartService
    CartService --> ProductRepository
    CartService --> CartValidator
    CartService --> CartStorageStrategy

    ProductRepository --> Product

    CartStorageStrategy <|.. SessionCartStorage
    CartStorageStrategy <|.. DatabaseCartStorage

    DatabaseCartStorage --> DbCartRepository
    DbCartRepository --> CartEntity
    CartEntity "1" --> "*" CartItemEntity

    CartController ..> CartItemInfo : receives
    CartController ..> Cart : returns
    CartService ..> Cart : returns
    Cart "1"*-- "*" CartItem

    CartService ..> CartException : throws
    CartService ..> ProductNotFoundException : throws
    CartValidator ..> InvalidQuantityException : throws
    CartException --> CartErrorCode
    SessionCartStorage ..> Cart : stores/retrieves
    SessionCartStorage ..> CartItem : handles

</div>

#### 4.2.4 注文ドメイン (ログインユーザー)

<div class="mermaid">
classDiagram
    %% === Controller層 ===
    class OrderController {
        +getUserOrderInfo(user_id): ResponseEntity~UserOrderInfo~
        +placeOrder(user_id, OrderRequest): ResponseEntity~OrderResponse~
    }

    %% === Service層 ===
    class OrderService {
        -UserRepository userRepository
        -CartService cartService
        -OrderRepository orderRepository
        -OrderValidator validator
        +getUserOrderInfo(user_id): UserOrderInfo
        +placeOrder(user_id, OrderRequest): OrderResponse
        +calculateOrderTotals(cart): OrderTotals
        -createOrder(user_id, OrderRequest, cart): Order
        -createOrderItems(order_id, cartItems): List~OrderItem~
    }

    class CartService {
        -CartStorageStrategy storage
        -ProductRepository productRepository
        -CartValidator validator
        +getCartByUserId(user_id): Cart
        +clearCart(user_id): void
        +calculateTotals(cart): Cart
    }

    %% === Repository層 ===
    class ProductRepository {
        <`<interface>`>
        +findById(product_id): Optional~Product~
    }

    class UserRepository {
        <`<interface>`>
        +findById(user_id): Optional~User~
    }

    class OrderRepository {
        <`<interface>`>
        +save(order): Order
        +findById(order_id): Optional~Order~
    }

    class OrderItemRepository {
        <`<interface>`>
        +saveAll(orderItems): List~OrderItem~
    }

    %% === Entity層 ===
    class Product {
        <`<Entity>`>
        +String product_id
        +String product_name
        +BigDecimal product_price
    }

    class User {
        <`<Entity>`>
        +String user_id
        +String user_name
        +String user_email
        +String user_address
    }

    class Order {
        <`<Entity>`>
        +String order_id
        +String user_id
        +String shipping_name
        +String shipping_address
        +BigDecimal subtotal
        +BigDecimal shipping_fee
        +BigDecimal total_price
        +OrderStatus status
        +LocalDateTime created_at
        +LocalDateTime updated_at
        +List~OrderItem~ order_items
    }

    class OrderItem {
        <`<Entity>`>
        +String order_item_id
        +String order_id
        +String product_id
        +String product_name
        +Integer quantity
        +BigDecimal unit_price
        +BigDecimal subtotal
    }

    %% === DTO層 ===
    class UserOrderInfo {
        <`<DTO>`>
        +String user_id
        +String user_name
        +String user_email
        +String user_address
        +String user_phone
        +Cart current_cart
        +OrderTotals totals
    }

    class OrderRequest {
        <`<DTO>`>
        +String shipping_name
        +String shipping_address
        +Boolean use_user_info
    }

    class OrderResponse {
        <`<DTO>`>
        +String order_id
        +LocalDateTime order_date
        +BigDecimal total_price
        +OrderStatus status
        +List~OrderItemDto~ order_items
    }

    class OrderItemDto {
        <`<DTO>`>
        +String product_id
        +String product_name
        +Integer quantity
        +BigDecimal unit_price
        +BigDecimal subtotal
    }

    class Cart {
        <`<DTO>`>
        +String cart_id
        +Map~String, CartItem~ cart_items
        +Integer total_quantity
        +BigDecimal total_price
    }

    class CartItem {
        <`<DTO>`>
        +String product_id
        +String product_name
        +BigDecimal product_price
        +Integer cart_quantity
        +BigDecimal subtotal
    }

    class OrderTotals {
        <`<DTO>`>
        +BigDecimal subtotal
        +BigDecimal shipping_fee
        +BigDecimal total_price
    }

    %% === Enum層 ===
    class OrderStatus {
        <`<Enum>`>
        PENDING
        CONFIRMED
        SHIPPED
        DELIVERED
        CANCELLED
    }

    %% === Strategy層 ===
    class CartStorageStrategy {
        <`<interface>`>
        +getCart(user_id): Cart
        +saveCart(cart, user_id): void
        +clearCart(user_id): void
    }

    class DatabaseCartStorage {
        -DbCartRepository repository
        +getCart(user_id): Cart
        +saveCart(cart, user_id): void
        +clearCart(user_id): void
        -toEntity(cart, user_id): CartEntity
        -toDto(cartEntity): Cart
    }

    class DbCartRepository {
        <`<interface>`>
        +findByUserId(user_id): Optional~CartEntity~
        +save(CartEntity): CartEntity
        +deleteByUserId(user_id): void
    }

    class CartEntity {
        <`<Entity>`>
        +String cart_id
        +String user_id
        +LocalDateTime created_at
        +LocalDateTime updated_at
        +List~CartItemEntity~ cart_items
        +Integer total_quantity
        +BigDecimal total_price
    }

    class CartItemEntity {
        <`<Entity>`>
        +String cart_item_id
        +String cart_id
        +String product_id
        +String product_name
        +BigDecimal product_price
        +Integer cart_quantity
        +BigDecimal subtotal
    }

    %% === Validation層 ===
    class OrderValidator {
        <`<Component>`>
        +validateUserId(user_id): void
        +validateOrderRequest(orderRequest): void
        +validateCart(cart): void
        +validateShippingInfo(shippingInfo): void
    }

    %% === Exception層 ===
    class OrderException {
        <`<Exception>`>
        +String message
        +OrderErrorCode error_code
    }

    class UserNotFoundException {
        <`<Exception>`>
        +String user_id
        +String message
    }

    class EmptyCartException {
        <`<Exception>`>
        +String user_id
        +String message
    }

    class OrderErrorCode {
        <`<Enum>`>
        USER_NOT_FOUND
        EMPTY_CART
        INVALID_SHIPPING_INFO
        ORDER_CREATION_FAILED
        INSUFFICIENT_STOCK
    }

    %% === 関係 ===
    OrderController --> OrderService
    OrderService --> UserRepository
    OrderService --> UserRepository
    OrderService --> CartService
    OrderService --> OrderRepository
    OrderService --> OrderItemRepository
    OrderService --> OrderValidator

    CartService --> ProductRepository
    CartService --> CartStorageStrategy
    CartStorageStrategy <|.. DatabaseCartStorage
    DatabaseCartStorage --> DbCartRepository

    UserRepository --> User
    ProductRepository --> Product
    DbCartRepository --> CartEntity
    CartEntity "1" --> "*" CartItemEntity
    OrderRepository --> Order
    OrderItemRepository --> OrderItem
    Order "1" --> "*" OrderItem
    Cart "1" *-- "*" CartItem
    Order --> OrderStatus

    OrderController ..> UserOrderInfo : returns
    OrderController ..> OrderRequest : receives
    OrderController ..> OrderResponse : returns
    OrderService ..> UserOrderInfo : returns
    OrderService ..> OrderResponse : returns
    OrderResponse --> OrderItemDto
    UserOrderInfo --> Cart
    UserOrderInfo --> OrderTotals
    Cart "1"*-- "*" CartItem

    OrderService ..> OrderException : throws
    OrderService ..> UserNotFoundException : throws
    OrderService ..> EmptyCartException : throws
    OrderValidator ..> OrderException : throws
    OrderException --> OrderErrorCode

</div>

#### 4.2.5 注文ドメイン（未ログインユーザー）

<div class=mermaid>
classDiagram
    %% === Controller層 ===
    class GuestOrderController {
        +placeOrder(OrderRequest): ResponseEntity~OrderResponse~
    }

    %% === Service層 ===
    class GuestOrderService {
        -CartService cartService
        -OrderRepository orderRepository
        -OrderItemRepository orderItemRepository
        -OrderValidator validator
        +placeOrderAsGuest(OrderRequest): OrderResponse
        +calculateOrderTotals(cart): OrderTotals
        -createGuestOrder(OrderRequest, cart): Order
        -createOrderItems(order_id, cartItems): List~OrderItem~
    }

    class CartService {
        -SessionCartStorage storage
        -ProductRepository productRepository
        -CartValidator validator
        +getCartFromSession(HttpSession): Cart
        +clearCartFromSession(HttpSession): void
        +calculateTotals(cart): Cart
    }

    %% === Repository層 ===
    class ProductRepository {
        <`<interface>`>
        +findById(product_id): Optional~Product~
    }

    class OrderRepository {
        <`<interface>`>
        +save(order): Order
        +findById(order_id): Optional~Order~
    }

    class OrderItemRepository {
        <`<interface>`>
        +saveAll(orderItems): List~OrderItem~
    }

    %% === Entity層 ===
    class Product {
        <`<Entity>`>
        +String product_id
        +String product_name
        +BigDecimal product_price
    }

    class Order {
        <`<Entity>`>
        +String order_id
        +String user_id
        +String customer_name
        +String customer_email
        +String customer_address
        +String shipping_name
        +String shipping_address
        +BigDecimal subtotal
        +BigDecimal shipping_fee
        +BigDecimal total_price
        +OrderStatus status
        +LocalDateTime created_at
        +LocalDateTime updated_at
        +List~OrderItem~ order_items
    }

    class OrderItem {
        <`<Entity>`>
        +String order_item_id
        +String order_id
        +String product_id
        +String product_name
        +Integer quantity
        +BigDecimal unit_price
        +BigDecimal subtotal
    }

    %% === DTO層 ===
    class OrderRequest {
        <`<DTO>`>
        +CustomerInfo customer_info
        +Cart cart
    }

    class CustomerInfo {
        <`<DTO>`>
        +String customer_name
        +String customer_email
        +String customer_address
        +String shipping_name
        +String shipping_address
    }

    class OrderResponse {
        <`<DTO>`>
        +String order_id
        +LocalDateTime order_date
        +BigDecimal total_price
        +OrderStatus status
        +List~OrderItemDto~ order_items
    }

    class OrderItemDto {
        <`<DTO>`>
        +String product_id
        +String product_name
        +Integer quantity
        +BigDecimal unit_price
        +BigDecimal subtotal
    }

    class Cart {
        <`<DTO>`>
        +String cart_id
        +List~CartItem~ cart_items
        +Integer total_quantity
        +BigDecimal total_price
    }

    class CartItem {
        <`<DTO>`>
        +String product_id
        +String product_name
        +Integer quantity
        +BigDecimal unit_price
        +BigDecimal subtotal
    }

    class OrderTotals {
        <`<DTO>`>
        +BigDecimal subtotal
        +BigDecimal shipping_fee
        +BigDecimal total_price
    }

    %% === Storage層 ===
    class SessionCartStorage {
        -HttpSession session
        +getCart(): Cart
        +saveCart(cart): void
        +clearCart(): void
    }

    %% === Enum層 ===
    class OrderStatus {
        <`<Enum>`>
        PENDING
        CONFIRMED
        SHIPPED
        DELIVERED
        CANCELLED
    }

    %% === Validation層 ===
    class OrderValidator {
        <`<Component>`>
        +validateOrderRequest(orderRequest): void
        +validateCustomerInfo(customerInfo): void
        +validateCart(cart): void
        +validateShippingInfo(shippingInfo): void
    }

    class CartValidator {
        <`<Component>`>
        +validateCart(cart): void
        +validateCartItems(cartItems): void
    }

    %% === Exception層 ===
    class OrderException {
        <`<Exception>`>
        +String message
        +OrderErrorCode error_code
    }

    class EmptyCartException {
        <`<Exception>`>
        +String message
    }

    class InvalidCustomerInfoException {
        <`<Exception>`>
        +String message
    }

    class OrderErrorCode {
        <`<Enum>`>
        EMPTY_CART
        INVALID_CUSTOMER_INFO
        INVALID_SHIPPING_INFO
        ORDER_CREATION_FAILED
        INSUFFICIENT_STOCK
    }

    %% === 関係 ===
    GuestOrderController --> GuestOrderService
    GuestOrderService --> CartService
    GuestOrderService --> OrderRepository
    GuestOrderService --> OrderItemRepository
    GuestOrderService --> OrderValidator

    CartService --> SessionCartStorage
    CartService --> ProductRepository
    CartService --> CartValidator

    SessionCartStorage --> Cart
    ProductRepository --> Product
    OrderRepository --> Order
    OrderItemRepository --> OrderItem
    Order "1" --> "*" OrderItem
    Order --> OrderStatus

    GuestOrderController ..> OrderRequest : receives
    GuestOrderController ..> OrderResponse : returns
    GuestOrderService ..> OrderResponse : returns
    OrderRequest --> CustomerInfo
    OrderRequest --> Cart
    OrderResponse --> OrderItemDto
    Cart "1"*-- "*" CartItem
    GuestOrderService ..> OrderTotals : uses

    GuestOrderService ..> OrderException : throws
    GuestOrderService ..> EmptyCartException : throws
    GuestOrderService ..> InvalidCustomerInfoException : throws
    OrderValidator ..> OrderException : throws
    OrderException --> OrderErrorCode

</div>

#### 4.2.6 管理者ログインドメイン

<div class="mermaid">
classDiagram
    %% === Controller ===
    class AdminAuthController {
        +login(AdminLoginRequest): ResponseEntity~AdminLoginResponse~
        +logout():void
    }

    %% === Service ===
    class AdminAuthService {
        +authenticate(admin_email, admin_password): AdminSession
        +encodePassword(rawPassword): String
        +matches(rawPassword, encodedPassword): boolean
    }

    class PasswordEncoder {
        <`<interface>`>
        +encode(rawPassword): String
        +matches(rawPassword, encodedPassword): boolean
    }

    %% === Repository ===
    class AdminRepository {
        <`<interface>`>
        +findByAdminEmail(email): Optional~Admin~
    }

    %% === Entity ===
    class Admin {
        <`<Entity>`>
        +String admin_id
        +String admin_name
        +String admin_email
        +String admin_passwordHash
        +LocalDateTime adminDate
        +boolean isValidPassword(rawPassword, passwordEncoder): boolean
    }

    %% === DTO ===
    class AdminLoginRequest {
        +String admin_email
        +String admin_password
    }

    class AdminLoginResponse {
        +String admin_name
        +String role
    }

    class AdminSession {
        +String admin_id
        +String admin_name
        +String admin_email
        +String role
    }

    %% === 関係 ===
    AdminAuthController --> AdminAuthService
    AdminAuthController --> AdminLoginRequest : from request
    AdminAuthController --> AdminLoginResponse : returns
    AdminAuthService --> AdminRepository
    AdminAuthService --> PasswordEncoder : uses
    AdminRepository --> Admin
    AdminAuthService --> AdminSession : returns

</div>

#### 4.2.7 商品・カテゴリ管理ドメイン

<div class="mermaid">
classDiagram
    %% === Controller ===
    class AdminProductController {
        +createProduct(ProductForm): ResponseEntity
        +updateProduct(productId, ProductForm): ResponseEntity
        +deleteProduct(productId): ResponseEntity
        +getProductList(): ResponseEntity~List~ProductAdminView~~
    }

    class AdminCategoryController {
        +createCategory(CategoryForm): ResponseEntity
        +updateCategory(categoryId, CategoryForm): ResponseEntity
        +getCategoryList(): ResponseEntity~List~CategoryView~~
    }

    %% === Service ===
    class ProductService {
        +create(ProductForm): Product
        +update(productId, ProductForm): Product
        +delete(productId): void
        +getAllForAdmin(): List~ProductAdminView~
    }

    class CategoryService {
        +create(CategoryForm): Category
        +update(categoryId, CategoryForm): Category
        +getAll(): List~CategoryView~
    }

    %% === Repository ===
    class ProductRepository {
        <`<interface>`>
        +save(Product): Product
        +deleteById(productId): void
        +findAll(): List~Product~
        +findById(productId): Optional~Product~
    }

    class CategoryRepository {
        <`<interface>`>
        +save(Category): Category
        +findAll(): List~Category~
        +findById(categoryId): Optional~Category~
    }

    %% === Entity ===
    class Product {
        <`<Entity>`>
        +String productId
        +String productName
        +String description
        +BigDecimal productPrice
        +Category category
        +List~ProductImage~ images
    }

    class ProductImage {
        <`<Entity>`>
        +String imageId
        +String imageUrl
        +int sort
        +Product product
    }

    class Category {
        <`<Entity>`>
        +String categoryId
        +String categoryName
        +List~Product~ products
    }

    %% === DTO/Form ===
    class ProductForm {
        <`<DTO>`>
        +String productName
        +String description
        +BigDecimal productPrice
        +String categoryId
        +List~String~ imageUrls
    }

    class ProductAdminView {
        <`<DTO>`>
        +String productId
        +String productName
        +BigDecimal productPrice
        +String categoryName
        +int imageCount
    }

    class CategoryForm {
        <`<DTO>`>
        +String categoryName
    }

    class CategoryView {
        <`<DTO>`>
        +String categoryId
        +String categoryName
    }

    %% === 関係 ===
    AdminProductController --> ProductService
    AdminProductController --> ProductForm
    AdminProductController --> ProductAdminView
    ProductService --> ProductRepository
    ProductService --> CategoryRepository
    ProductService --> Product
    ProductService --> ProductAdminView

    AdminCategoryController --> CategoryService
    AdminCategoryController --> CategoryForm
    CategoryService --> CategoryRepository
    CategoryService --> Category
    CategoryService --> CategoryView

    Product --> Category
    Product --> ProductImage
    Category --> Product

</div>

#### 4.2.8 注文管理ドメイン

<div class=mermaid>
classDiagram
    %% === Controller ===
    class AdminOrderController {
        +getOrderList(): ResponseEntity~List~OrderSummaryDto~~
        +getOrderDetail(orderId): ResponseEntity~OrderDetailDto~
        +updateOrderStatus(orderId, OrderStatusUpdateRequest): ResponseEntity
    }

    %% === Service ===
    class AdminOrderService {
        +getAllOrders(): List~OrderSummaryDto~
        +getOrderDetail(orderId): OrderDetailDto
        +updateOrderStatus(orderId, newStatus): void
    }

    %% === Repository ===
    class OrderRepository {
        <`<interface>`>
        +findAll(): List~Order~
        +findById(orderId): Optional~Order~
        +save(order): Order
    }

    class OrderDetailRepository {
        <`<interface>`>
        +findByOrderId(orderId): List~OrderDetail~
    }

    %% === Entity ===
    class Order {
        <`<Entity>`>
        +String orderId
        +Integer userId
        +String buyerName
        +String buyerEmail
        +String buyerAddress
        +String shipName
        +String shipAddress
        +BigDecimal totalPrice
        +BigDecimal shippingFee
        +String payMethod
        +String orderStatus
        +LocalDateTime orderDate
    }

    class OrderDetail {
        <`<Entity>`>
        +String detailId
        +String orderId
        +Integer productId
        +int quantity
        +BigDecimal unitPrice
    }

    %% === DTO ===
    class OrderSummaryDto {
        +String orderId
        +String buyerName
        +String orderDate
        +BigDecimal totalPrice
        +String orderStatus
    }

    class OrderDetailDto {
        +String orderId
        +String buyerName
        +String shippingAddress
        +List~OrderItemDto~ items
        +BigDecimal totalPrice
        +String orderStatus
    }

    class OrderItemDto {
        +String productName
        +int quantity
        +BigDecimal unitPrice
        +BigDecimal subtotal
    }

    class OrderStatusUpdateRequest {
        +String newStatus
    }

    %% === 関係 ===
    AdminOrderController --> AdminOrderService
    AdminOrderController --> OrderSummaryDto
    AdminOrderController --> OrderDetailDto
    AdminOrderController --> OrderStatusUpdateRequest

    AdminOrderService --> OrderRepository
    AdminOrderService --> OrderDetailRepository
    AdminOrderService --> OrderSummaryDto
    AdminOrderService --> OrderDetailDto
    AdminOrderService --> Order

    Order --> OrderDetail
    OrderDetailDto --> OrderItemDto

</div>

## 6. インターフェース仕様書

- **SC0001: ユーザーログイン画面**

| イベント               | API名      | メソッド | エンドポイント      | 概要                                 |
| ---------------------- | ---------- | -------- | ------------------- | ------------------------------------ |
| ログインボタン押下     | ログイン   | POST     | `/api/auth/login` | メールアドレス＋パスワードでログイン |
| 新規会員登録リンク押下 | -          | -        | -                   | SC0010（新規会員登録画面）へ遷移     |
| ゲストログイン押下     | （未定義） | -        | -                   | SC0110（商品一覧画面）へ遷移         |

- **SC0010: 新規会員登録画面**

| イベント       | API名    | メソッド | エンドポイント              | 概要                                       |
| -------------- | -------- | -------- | --------------------------- | ------------------------------------------ |
| 登録ボタン押下 | 会員登録 | POST     | `/api/customers/register` | ユーザーID、パスワード、氏名、住所等を登録 |

- **SC0110: 商品一覧画面**

| イベント   | API名        | メソッド | エンドポイント    | 概要                                       |
| ---------- | ------------ | -------- | ----------------- | ------------------------------------------ |
| 画面表示時 | 商品一覧取得 | GET      | `/api/products` | 商品の一覧を取得（カテゴリなどの条件付き） |

- **SC0115: カテゴリ別商品一覧画面**

| イベント                   | API名                        | メソッド | エンドポイント                    | 概要                         |
| -------------------------- | ---------------------------- | -------- | --------------------------------- | ---------------------------- |
| カテゴリ選択時／画面表示時 | 商品一覧取得（カテゴリ指定） | GET      | `/api/products?categoryId={id}` | 指定カテゴリの商品一覧を取得 |

- **SC0120: 商品詳細画面**

| イベント             | API名        | メソッド | エンドポイント                | 概要                 |
| -------------------- | ------------ | -------- | ----------------------------- | -------------------- |
| 商品選択・画面表示時 | 商品詳細取得 | GET      | `/api/products/{productId}` | 商品の詳細情報を取得 |

- **SC0125: マイページ画面**

| イベント         | API名        | メソッド | エンドポイント        | 概要                             |
| ---------------- | ------------ | -------- | --------------------- | -------------------------------- |
| 画面表示時       | 会員情報取得 | GET      | `/api/customers/me` | ログイン中のユーザー情報を取得   |
| ログアウト押下   | ログアウト   | POST     | `/api/auth/logout`  | セッションまたはトークンを無効化 |
| 会員情報編集押下 | 会員情報更新 | PUT      | `/api/customers/me` | SC0128（会員情報編集画面）へ遷移 |

- **SC0128: 会員情報編集画面**

| イベント         | API名        | メソッド | エンドポイント        | 概要                           |
| ---------------- | ------------ | -------- | --------------------- | ------------------------------ |
| 編集内容保存押下 | 会員情報更新 | PUT      | `/api/customers/me` | ユーザーの氏名・住所などを更新 |

- **SC0130: カート画面**

| イベント             | API名          | メソッド | エンドポイント               | 概要                             |
| -------------------- | -------------- | -------- | ---------------------------- | -------------------------------- |
| 画面表示時           | カート内容取得 | GET      | `/api/cart`                | サーバー上のカート内容を取得     |
| 商品削除             | カート商品削除 | DELETE   | `/api/cart/items/{itemId}` | カート内の商品を削除             |
| 数量変更             | カート商品更新 | PUT      | `/api/cart/items/{itemId}` | カート内商品の数量などを更新     |
| 注文へ進むボタン押下 | -              | -        | -                            | SC0140（注文情報入力画面）へ遷移 |

- **SC0140: 注文情報入力画面**

| イベント           | API名        | メソッド | エンドポイント | 概要                                        |
| ------------------ | ------------ | -------- | -------------- | ------------------------------------------- |
| 画面表示時         | 会員情報取得 | GET      | `/api/cart`  | 会員情報を自動入力                          |
| 「注文確認へ」押下 | -            | -        | -              | SC0150（注文確認画面）へ遷移（API呼出なし） |

- **SC0150: 注文情報確認画面**

| イベント         | API名    | メソッド | エンドポイント  | 概要                               |
| ---------------- | -------- | -------- | --------------- | ---------------------------------- |
| 「注文確定」押下 | 注文登録 | POST     | `/api/orders` | 入力済み注文情報を送信し、確定処理 |

- **SC0160: 注文完了画面**

| イベント               | API名 | メソッド | エンドポイント | 概要                                        |
| ---------------------- | ----- | -------- | -------------- | ------------------------------------------- |
| 画面表示時             | -     | -        | -              | 完了メッセージ表示のみ（API呼出なし）       |
| ホームへ戻るボタン押下 | -     | -        | -              | SC0110（商品一覧画面）へ遷移（API呼出なし） |

- **SC9001: 管理者ログイン画面**

| イベント           | API名          | メソッド | エンドポイント            | 概要                           |
| ------------------ | -------------- | -------- | ------------------------- | ------------------------------ |
| ログインボタン押下 | 管理者ログイン | POST     | `/api/admin/auth/login` | 管理者ID＋パスワードでログイン |

- **SC9101: 管理者ダッシュボード画面**

| イベント                     | API名            | メソッド | エンドポイント             | 概要                                   |
| ---------------------------- | ---------------- | -------- | -------------------------- | -------------------------------------- |
| ログアウト押下               | 管理者ログアウト | POST     | `/api/admin/auth/logout` | 管理者セッションを無効化               |
| 商品情報追加・編集リンク押下 | -                | -        | -                          | SC9201（商品情報追加・編集画面）へ遷移 |
| 注文情報確認リンク押下       | -                | -        | -                          | SC9301（注文情報確認画面）へ遷移       |
| 管理者編集リンク押下         | -                | -        | -                          | SC9401（管理者編集画面）へ遷移         |

- **SC9201: 商品情報追加・編集画面** (管理者向け)

| イベント                     | API名        | メソッド | エンドポイント                             | 概要                             |
| ---------------------------- | ------------ | -------- | ------------------------------------------ | -------------------------------- |
| 新規商品情報登録ボタン押下   | 商品登録     | POST     | `/api/admin/products`                    | 新規商品情報を登録               |
| 商品情報編集→保存ボタン押下 | 商品編集     | PUT      | `/api/admin/products/{productId}`        | 既存商品情報を更新               |
| 商品情報削除→確定ボタン     |              |          |                                            |                                  |
| 商品画像アップロード         | 商品画像追加 | POST     | `/api/admin/products/{productId}/images` | 商品に対する画像を追加（複数可） |

- **SC9301: 注文情報確認画面** (管理者向け)

| イベント   | API名        | メソッド | エンドポイント        | 概要                         |
| ---------- | ------------ | -------- | --------------------- | ---------------------------- |
| 画面表示時 | 注文一覧取得 | GET      | `/api/admin/orders` | すべての注文情報を一覧で取得 |

- **SC9401: 管理者編集画面**

| イベント               | API名          | メソッド | エンドポイント                 | 概要                                 |
| ---------------------- | -------------- | -------- | ------------------------------ | ------------------------------------ |
| 画面表示時（一覧取得） | 管理者一覧取得 | GET      | `/api/admin/users`           | 登録済みの管理者アカウント一覧を取得 |
| 管理者新規登録押下     | 管理者登録     | POST     | `/api/admin/users`           | 新規管理者アカウントを登録           |
| 管理者編集→保存押下   | 管理者情報更新 | PUT      | `/api/admin/users/{adminId}` | 既存管理者の情報を更新               |
| 管理者削除押下         | 管理者削除     | DELETE   | `/api/admin/users/{adminId}` | 管理者アカウントを削除               |

## 7. 画面項目定義

- **SC0001: ユーザーログイン画面**
  - メールアドレスとパスワードを入力し、システムにログインする画面。新規会員登録やゲストログインも配置。

| 項目ID         | 項目名               | ラベル名       | UI部品        | 型     | 入力 | 初期値 | サイズ | 文字種       | バリデーションルール                        | エラーメッセージ                         | 備考                                         |
| -------------- | -------------------- | -------------- | ------------- | ------ | ---- | ------ | ------ | ------------ | ------------------------------------------- | ---------------------------------------- | -------------------------------------------- |
| user_id        | メールアドレス       | メールアドレス | TextInput     | string | 必須 | ―     | 20     | 半角英数     | 必須、メール形式                            | メールアドレスを正しく入力してください。 | 新規会員登録が未完了のメールアドレスはエラー |
| user_password  | パスワード           | パスワード     | PasswordInput | string | 必須 | ―     | 20     | 半角英数記号 | 必須、8〜20文字、英大・小・数字・記号を含む | パスワードが正しくありません。           | ログイン失敗時にメッセージ表示               |
| login_btn      | ログインボタン       | ログイン       | Button        | string | ―   | ―     | ―     | ―           | 入力が有効な場合にのみ押下可能              | ―                                       | ログイン処理実行                             |
| register_link  | 新規会員登録リンク   | 新規会員登録   | Link          | string | ―   | ―     | ―     | ―           | ―                                          | ―                                       | SC0010 新規会員登録画面へ遷移                |
| guestlogin_btn | ゲストログインボタン | ゲストログイン | Button        | string | ―   | ―     | ―     | ―           | ―                                          | ―                                       | ゲスト用アカウントでログイン処理             |

- **SC0010: 新規会員登録画面**
  - 氏名、住所、メールアドレス、パスワードを新規登録する画面。

| 項目ID             | 項目名           | ラベル名           | UI部品        | 型     | 入力 | 初期値 | サイズ | 文字種       | バリデーションルール                         | エラーメッセージ                       | 備考                                 |
| ------------------ | ---------------- | ------------------ | ------------- | ------ | ---- | ------ | ------ | ------------ | -------------------------------------------- | -------------------------------------- | ------------------------------------ |
| user_name          | 氏名             | 氏名（全角）       | TextInput     | string | 必須 | ―     | 50     | 全角文字     | 必須、50文字以内                             | 氏名を入力してください                 | 姓・名をまとめて入力                 |
| user_address       | 住所             | 住所               | TextArea      | string | 必須 | ―     | 200    | 全角文字     | 必須、200文字以内                            | 住所を入力してください                 | 郵便番号・都道府県・市区町村など含む |
| user_email         | メールアドレス   | メールアドレス     | TextInput     | string | 必須 | ―     | 100    | 半角英数記号 | 必須、メール形式、重複不可                   | メールアドレスの形式が正しくありません | 確認メール送信に使用                 |
| user_password      | パスワード       | パスワード         | PasswordInput | string | 必須 | (※1)  | 20     | 半角英数記号 | 必須、半角英数、8~20文字、英大・小・数字含む | パスワードの形式が正しくありません。   | 表示・非表示切替ボタンあり           |
| conf_user_password | パスワード確認   | パスワード（確認） | PasswordInput | string | 必須 | (※1)  | 20     | 半角英数記号 | 必須、パスワードと一致                       | パスワードが一致しません。             |                                      |
| register_btn       | 登録ボタン       | 登録               | Button        | string | ―   | ―     | ―     | ―           | 入力が有効な場合にのみ押下可能               | ―                                     | 押下で登録処理実行                   |
| cancel_btn         | キャンセルボタン | キャンセル         | Button        | string | ―   | ―     | ―     | ―           | ―                                           | ―                                     | ログイン画面へ遷移                   |

- **SC0110: 商品一覧画面**
  - システムに登録されている商品を一覧表示する画面。カテゴリー絞り込み、納期情報の表示などを配置。ホーム画面の役割を果たす。

| 項目ID          | 項目名           | ラベル名     | UI部品    | 型       | 入力     | 初期値 | サイズ | 文字種     | バリデーションルール | エラーメッセージ | 備考                             |
| --------------- | ---------------- | ------------ | --------- | -------- | -------- | ------ | ------ | ---------- | -------------------- | ---------------- | -------------------------------- |
| category_select | カテゴリ絞り込み | カテゴリ選択 | Select    | string   | 任意     | ―     | 50     | 全角・半角 | 任意                 | ―               | カテゴリー一覧から選択可能       |
| product_list    | 商品一覧         | 商品一覧     | DataGrid  | string[] | 表示のみ | ―     | ―     | ―         | ―                   | ―               | 商品名、価格、納期など一覧表示   |
| product_name    | 商品名           | 商品名       | TextInput | string   | 表示のみ | ―     | 100    | 全角・半角 | ―                   | ―               | DataGrid内のカラム               |
| product_price   | 価格             | 価格         | TextInput | string   | 表示のみ | ―     | 10     | 半角数字   | ―                   | ―               | DataGrid内のカラム               |
| detail_link     | 詳細リンク       | 商品詳細へ   | Link      | ―       | ―       | ―     | ―     | ―         | ―                   | ―               | 選択商品詳細画面（SC0120）へ遷移 |

- **SC0115: カテゴリ別商品一覧画面**
  - ユーザーが選択したカテゴリで絞り込み、商品一覧画面(SC0110)と同様にシステムに登録されている商品を一覧表示する画面。

| 項目ID            | 項目名       | ラベル名   | UI部品    | 型       | 入力     | 初期値 | サイズ | 文字種     | バリデーションルール | エラーメッセージ           | 備考                             |
| ----------------- | ------------ | ---------- | --------- | -------- | -------- | ------ | ------ | ---------- | -------------------- | -------------------------- | -------------------------------- |
| selected_category | 選択カテゴリ | カテゴリ   | Select    | string   | 必須     | ―     | 50     | 全角・半角 | 必須                 | カテゴリを選択してください | SC0110の商品一覧画面に連動       |
| product_list      | 商品一覧     | 商品一覧   | DataGrid  | string[] | 表示のみ | ―     | ―     | ―         | ―                   | ―                         | 商品名、価格、納期など一覧表示   |
| product_name      | 商品名       | 商品名     | TextInput | string   | 表示のみ | ―     | 100    | 全角・半角 | ―                   | ―                         | DataGrid内のカラム               |
| product_price     | 価格         | 価格       | TextInput | string   | 表示のみ | ―     | 10     | 半角数字   | ―                   | ―                         | DataGrid内のカラム               |
| detail_link       | 詳細リンク   | 商品詳細へ | Link      | ―       | ―       | ―     | ―     | ―         | ―                   | ―                         | 選択商品詳細画面（SC0120）へ遷移 |

- **SC0120: 商品詳細画面**
  - 選択した商品の詳細情報（大きめの商品画像、説明、価格、素材情報など）を表示する画面。

| 項目ID          | 項目名       | ラベル名     | UI部品    | 型     | 入力     | 初期値 | サイズ | 文字種     | バリデーションルール | エラーメッセージ | 備考                             |
| --------------- | ------------ | ------------ | --------- | ------ | -------- | ------ | ------ | ---------- | -------------------- | ---------------- | -------------------------------- |
| product_image   | 商品画像     | 商品画像     | Image     | string | 表示のみ | ―     | ―     | ―         | ―                   | ―               | 大きめの商品画像表示             |
| product_name    | 商品名       | 商品名       | TextInput | string | 表示のみ | ―     | 100    | 全角・半角 | ―                   | ―               | 商品名表示                       |
| description     | 商品説明     | 説明         | TextArea  | string | 表示のみ | ―     | 500    | 全角・半角 | ―                   | ―               | 商品詳細説明                     |
| product_price   | 価格         | 価格         | TextInput | string | 表示のみ | ―     | 10     | 半角数字   | ―                   | ―               | 税込価格表示                     |
| material_info   | 素材情報     | 素材情報     | TextArea  | string | 表示のみ | ―     | 200    | 全角・半角 | ―                   | ―               | 素材の詳細情報                   |
| add_to_cart_btn | カートに追加 | カートに追加 | Button    | ―     | ―       | ―     | ―     | ―         | ―                   | ―               | 押下でカート画面（SC0130）へ遷移 |

- **SC0125: マイページ画面**
  - 会員登録をしたユーザー専用画面。

| 項目ID           | 項目名       | ラベル名     | UI部品 | 型 | 入力 | 初期値 | サイズ | 文字種 | バリデーションルール | エラーメッセージ | 備考                             |
| ---------------- | ------------ | ------------ | ------ | -- | ---- | ------ | ------ | ------ | -------------------- | ---------------- | -------------------------------- |
| account_edit_btn | 会員情報編集 | 会員情報編集 | Button | ― | ―   | ―     | ―     | ―     | ―                   | ―               | 会員情報編集画面（SC0128）へ遷移 |
| logout_btn       | ログアウト   | ログアウト   | Button | ― | ―   | ―     | ―     | ―     | ―                   | ―               | ログアウト処理実行               |

- **SC0128: 会員情報編集画面**
  - 会員登録済みのユーザーが登録内容を編集する画面。

| 項目ID             | 項目名         | ラベル名       | UI部品        | 型     | 入力 | 初期値 | サイズ | 文字種       | バリデーションルール                       | エラーメッセージ                       | 備考                         |
| ------------------ | -------------- | -------------- | ------------- | ------ | ---- | ------ | ------ | ------------ | ------------------------------------------ | -------------------------------------- | ---------------------------- |
| edit_user_name     | 氏名           | 氏名           | TextInput     | string | 必須 | (※1)  | 50     | 全角・半角   | 必須、全角ひらがな・カタカナ・漢字・英数可 | 氏名を正しく入力してください           | (※1)登録情報を表示          |
| edit_user_address  | 住所           | 住所           | TextArea      | string | 必須 | (※1)  | 200    | 全角・半角   | 必須                                       | 住所を入力してください                 |                              |
| edit_user_email    | メールアドレス | メールアドレス | TextInput     | string | 必須 | (※1)  | 100    | 半角英数記号 | 必須、メール形式                           | 正しいメールアドレスを入力してください |                              |
| edit_user_password | パスワード     | パスワード     | PasswordInput | string | 必須 | ―     | 20     | 半角英数記号 | 8〜20文字、英大小数字記号                  | パスワードの形式が正しくありません     | 未入力ならパスワード変更なし |
| save_btn           | 保存ボタン     | 保存           | Button        | ―     | ―   | ―     | ―     | ―           | 入力チェック通過時のみ有効                 | ―                                     | 押下で変更内容を保存         |
| cancel_btn         | キャンセル     | キャンセル     | Button        | ―     | ―   | ―     | ―     | ―           | ―                                         | ―                                     | 押下でマイページに戻る       |

- **SC0130: カート画面**
  - カートに追加されている商品を表示・追加・削除する画面。

| 項目ID         | 項目名           | ラベル名       | UI部品    | 型       | 入力     | 初期値 | サイズ | 文字種     | バリデーションルール           | エラーメッセージ              | 備考                             |
| -------------- | ---------------- | -------------- | --------- | -------- | -------- | ------ | ------ | ---------- | ------------------------------ | ----------------------------- | -------------------------------- |
| cart_item_list | カート商品一覧   | カート商品一覧 | DataGrid  | string[] | 表示のみ | ―     | ―     | ―         | ―                             | ―                            | 商品名、数量、価格を一覧表示     |
| product_name   | 商品名           | 商品名         | TextInput | string   | 表示のみ | ―     | 100    | 全角・半角 | ―                             | ―                            | DataGrid内のカラム               |
| cart_quantity  | 数量             | 数量           | TextInput | int      | 必須     | 1      | 3      | 半角数字   | 必須、1以上                    | 数量を1以上で入力してください | 数量変更可能                     |
| product_price  | 価格             | 価格           | TextInput | string   | 表示のみ | ―     | 10     | 半角数字   | ―                             | ―                            | DataGrid内のカラム               |
| delete_btn     | 削除ボタン       | 削除           | Button    | ―       | ―       | ―     | ―     | ―         | ―                             | ―                            | 該当商品をカートから削除         |
| update_btn     | 更新ボタン       | 数量更新       | Button    | ―       | ―       | ―     | ―     | ―         | 数量変更時に押下               | ―                            | カート情報を更新                 |
| checkout_btn   | 購入手続きボタン | 購入手続き     | Button    | ―       | ―       | ―     | ―     | ―         | カートに商品がある場合のみ有効 | ―                            | 注文情報入力画面（SC0140）へ遷移 |

- **SC0140: 注文情報入力画面**
  - 購入者氏名、購入者住所、購入者メールアドレス、配送先氏名、配送先住所、決済方法を入力・選択する画面。

| 項目ID        | 項目名               | ラベル名             | UI部品    | 型     | 入力 | 初期値 | サイズ | 文字種       | バリデーションルール | エラーメッセージ                                                             | 備考                                      |
| ------------- | -------------------- | -------------------- | --------- | ------ | ---- | ------ | ------ | ------------ | -------------------- | ---------------------------------------------------------------------------- | ----------------------------------------- |
| buyer_name    | 購入者氏名           | 氏名                 | TextInput | string | 必須 | (※1)  | 50     | 全角・半角   | 必須                 | 氏名は入力必須です。                                                         | (※1)ログインしている場合は登録情報を表示 |
| buyer_address | 購入者住所           | 購入者住所           | TextArea  | string | 必須 | (※1)  | 200    | 全角・半角   | 必須                 | 購入者住所は入力必須です。購入者住所は200字以内で入力してください。          | -----                                     |
| buyer_email   | 購入者メールアドレス | 購入者メールアドレス | TextInput | string | 必須 | (※1)  | 255    | 半角英数記号 | 必須,メール形式      | 購入者メールアドレスは入力必須です。メールアドレスの形式が正しくありません。 | -----                                     |
| ship_name     | 配送先氏名           | 配送先氏名           | TextInput | string | 必須 | (※1)  | 50     | 全角・半角   | 必須                 | 配送先氏名は入力必須です。                                                   |                                           |
| ship_address  | 配送先住所           | 配送先住所           | TextArea  | string | 必須 | (※1)  | 200    | 全角・半角   | 必須                 | 配送先住所は入力必須です。                                                   |                                           |
| pay_method    | 決済方法             | 決済方法             | Select    | string | 必須 | 代引き | 50     | 全角・半角   | 必須                 | 決済方法を選択してください。                                                 | 決済方法は代引きか銀行振込                |

- **SC0150: 注文情報確認画面**
  - 注文情報入力画面(SC0140)で入力された情報を確認し、確定させる画面。

| 項目ID                | 項目名               | ラベル名       | UI部品    | 型     | 入力     | 初期値 | サイズ | 文字種       | バリデーションルール | エラーメッセージ | 備考                       |
| --------------------- | -------------------- | -------------- | --------- | ------ | -------- | ------ | ------ | ------------ | -------------------- | ---------------- | -------------------------- |
| confirm_buyer_name    | 購入者氏名           | 購入者氏名     | TextInput | string | 表示のみ | ―     | 50     | 全角・半角   | ―                   | ―               | SC0140で入力された情報表示 |
| confirm_buyer_email   | 購入者メールアドレス | メールアドレス | TextInput | string | 表示のみ | ―     | 100    | 半角英数記号 | ―                   | ―               |                            |
| confirm_buyer_address | 購入者住所           | 購入者住所     | TextArea  | string | 表示のみ | ―     | 200    | 全角・半角   | ―                   | ―               |                            |
| confirm_ship_name     | 配送先氏名           | 配送先氏名     | TextInput | string | 表示のみ | ―     | 50     | 全角・半角   | ―                   | ―               |                            |
| confirm_ship_address  | 配送先住所           | 配送先住所     | TextArea  | string | 表示のみ | ―     | 200    | 全角・半角   | ―                   | ―               |                            |
| confirm_pay_method    | 決済方法             | 決済方法       | TextInput | string | 表示のみ | ―     | 20     | 全角・半角   | ―                   | ―               | 代引き、振込など表示       |
| confirm_order_btn     | 注文確定ボタン       | 注文確定       | Button    | ―     | ―       | ―     | ―     | ―           | ―                   | ―               | 注文確定処理実行           |
| modify_btn            | 修正ボタン           | 修正           | Button    | ―     | ―       | ―     | ―     | ―           | ―                   | ―               | 入力画面(SC0140)に戻る     |

- **SC0160: 注文完了画面**
  - 注文が正常に完了したことを伝える画面。

| 項目ID          | 項目名         | ラベル名           | UI部品 | 型     | 入力     | 初期値 | サイズ | 文字種     | バリデーションルール | エラーメッセージ | 備考                     |
| --------------- | -------------- | ------------------ | ------ | ------ | -------- | ------ | ------ | ---------- | -------------------- | ---------------- | ------------------------ |
| completion_msg  | 完了メッセージ | 注文完了メッセージ | Label  | string | 表示のみ | ―     | ―     | 全角・半角 | ―                   | ―               | 注文完了の案内文表示     |
| return_home_btn | ホームへ戻る   | ホームへ戻る       | Button | ―     | ―       | ―     | ―     | ―         | ―                   | ―               | ホーム画面(SC0110)へ遷移 |

- **SC9001: 管理者ログイン画面**
  - 管理者用ユーザーIDとパスワードを入力し、システムにログインする画面。

| 項目ID         | 項目名               | ラベル名             | UI部品        | 型     | 入力 | 初期値 | サイズ | 文字種       | バリデーションルール | エラーメッセージ                       | 備考                     |
| -------------- | -------------------- | -------------------- | ------------- | ------ | ---- | ------ | ------ | ------------ | -------------------- | -------------------------------------- | ------------------------ |
| admin_email    | 管理者メールアドレス | 管理者メールアドレス | TextInput     | string | 必須 | ―     | 20     | 半角英数     | 必須、メール形式     | メールアドレスを正しく入力してください | 管理者ログイン用         |
| admin_password | パスワード           | パスワード           | PasswordInput | string | 必須 | ―     | 20     | 半角英数記号 | 必須、8〜20文字      | パスワードを正しく入力してください     |                          |
| login_btn      | ログイン             | ログイン             | Button        | ―     | ―   | ―     | ―     | ―           | ―                   | ―                                     | 押下でログイン処理を実行 |

- **SC9101: 管理者ダッシュボード画面**
  - 管理者向けのホーム画面。

| 項目ID              | 項目名             | ラベル名     | UI部品 | 型     | 入力     | 初期値 | サイズ | 文字種     | バリデーションルール | エラーメッセージ | 備考                       |
| ------------------- | ------------------ | ------------ | ------ | ------ | -------- | ------ | ------ | ---------- | -------------------- | ---------------- | -------------------------- |
| nav_manage_products | 商品情報追加・編集管理リンク     | 商品情報追加・編集     | Link   | ―      | ―        | ―      | ―      | ―          | ―                    | ―                | 商品情報追加・編集画面(SC9201)へのリンク     |
| nav_manage_orders   | 注文情報確認画面リンク     | 注文情報確認     | Link   | ―      | ―        | ―      | ―      | ―          | ―                    | ―                | 注文情報確認画面(SC9301)へのリンク     |
| nav_manage_users    | 管理者編集画面リンク | 管理者編集 | Link   | ―      | ―        | ―      | ―      | ―          | ―                    | ―                | ユーザー管理画面へのリンク |
| logout_btn          | ログアウトボタン   | ログアウト   | Button | ―      | ―        | ―      | ―      | ―          | ―                    | ―                | ログアウト処理を実行       |

- **SC9201: 商品情報追加・編集画面** (管理者向け)
  - 新規商品情報の追加や、商品情報の編集を行う画面。

| 項目ID              | 項目名           | ラベル名     | UI部品     | 型      | 入力     | 初期値   | サイズ | 文字種     | バリデーションルール                  | エラーメッセージ               | 備考                               |
| ------------------- | ---------------- | ------------ | ---------- | ------- | -------- | -------- | ------ | ---------- | ------------------------------------- | ------------------------------ | ---------------------------------- |
| product_id          | 商品ID           | 商品ID       | TextInput  | string  | 表示のみ | 自動生成 | 20     | 半角英数字 | ―                                    | ―                             | 新規追加時は非表示または自動採番   |
| product_name        | 商品名           | 商品名       | TextInput  | string  | 必須     | ―       | 100    | 全角・半角 | 必須                                  | 商品名を入力してください       |                                    |
| category_id         | カテゴリーID     | カテゴリーID | Select     | enum    | 必須     | ―       | ―     | ―         | 必須                                  | カテゴリーを選択してください   | カテゴリは事前登録された値から選択 |
| product_image       | 商品画像         | 商品画像     | FileUpload | image   | 任意     | ―       | ―     | ―         | 画像ファイル形式チェック（jpg,png等） | 画像ファイルを選択してください | 画像のアップロード                 |
| product_description | 商品説明         | 商品説明     | TextArea   | string  | 任意     | ―       | 500    | 全角・半角 | ―                                    | ―                             |                                    |
| product_price       | 価格             | 価格         | TextInput  | decimal | 必須     | 0        | 10     | 半角数字   | 必須、0以上の数値                     | 価格を正しく入力してください   |                                    |
| save_btn            | 保存ボタン       | 保存         | Button     | ―      | ―       | ―       | ―     | ―         | ―                                    | ―                             | 入力内容の保存処理を実行           |
| cancel_btn          | キャンセルボタン | キャンセル   | Button     | ―      | ―       | ―       | ―     | ―         | ―                                    | ―                             | 編集画面を閉じるまたは前画面へ戻る |

- **SC9301: 注文情報確認画面** (管理者向け)
  - 注文状況を確認する画面。

| 項目ID            | 項目名                   | ラベル名       | UI部品 | 型       | 入力     | 初期値 | サイズ | 文字種       | バリデーションルール | エラーメッセージ           | 備考                       |
| ----------------- | ------------------------ | -------------- | ------ | -------- | -------- | ------ | ------ | ------------ | -------------------- | -------------------------- | -------------------------- |
| order_id          | 注文ID                   | 注文ID         | Label  | string   | 表示のみ | ―     | 20     | 半角英数字   | ―                   | ―                         | 注文を識別するID           |
| user_id           | 会員ID                   | 会員ID         | Label  | string   | 表示のみ | ―     | 20     | 半角英数字   | ―                   | ―                         | 会員を識別するID           |
| buyer_name        | 購入者氏名               | 購入者氏名     | Label  | string   | 表示のみ | ―     | 50     | 全角・半角   | ―                   | ―                         |                            |
| buyer_email       | 購入者メールアドレス     | メールアドレス | Label  | string   | 表示のみ | ―     | 100    | 半角英数記号 | ―                   | ―                         |                            |
| buyer_address     | 購入者住所               | 購入者住所     | Label  | string   | 表示のみ | ―     | 200    | 全角・半角   | ―                   | ―                         |                            |
| ship_name         | 配送先氏名               | 配送先氏名     | Label  | string   | 表示のみ | ―     | 50     | 全角・半角   | ―                   | ―                         |                            |
| ship_address      | 配送先住所               | 配送先住所     | Label  | string   | 表示のみ | ―     | 200    | 全角・半角   | ―                   | ―                         |                            |
| ship_fee          | 送料                     | 送料           | Label  | decimal  | 表示のみ | 0      | 10     | 半角数字     | ―                   | ―                         | ORDERテーブルの送料        |
| total_price       | 合計金額                 | 合計金額       | Label  | decimal  | 表示のみ | 0      | 10     | 半角数字     | ―                   | ―                         | ORDERテーブルの合計金額    |
| pay_method        | 決済方法                 | 決済方法       | Label  | string   | 表示のみ | ―     | 20     | 全角・半角   | ―                   | ―                         | 代引きか振込               |
| order_date        | 注文日時                 | 注文日時       | Label  | datetime | 表示のみ | ―     | ―     | ―           | ―                   | ―                         | 注文日時                   |
| order_status      | 注文ステータス           | 注文ステータス | Select | string   | 編集可能 | ―     | ―     | ―           | 必須                 | 注文状況を選択してください | 例：未処理、処理中、完了等 |
| update_status_btn | 注文ステータス更新ボタン | 更新           | Button | ―       | ―       | ―     | ―     | ―           | ―                   | ―                         | 注文状況の変更を反映する   |
| cancel_btn        | キャンセルボタン         | キャンセル     | Button | ―       | ―       | ―     | ―     | ―           | ―                   | ―                         | 前画面へ戻る               |
| detail_id         | 注文詳細ID               | 注文詳細ID     | Label  | string   | 表示のみ | ―     | 20     | 半角英数字   | ―                   | ―                         | 注文詳細識別ID             |
| product_id        | 商品ID                   | 商品ID         | Label  | string   | 表示のみ | ―     | 20     | 半角英数字   | ―                   | ―                         | 注文された商品のID         |
| product_quantity  | 数量                     | 数量           | Label  | int      | 表示のみ | ―     | 20     | 半角数字     | ―                   | ―                         | 注文された商品の数量       |

- **SC9401: 管理者編集画面**
  - 管理者の登録や編集・削除を行う画面。

| 項目ID          | 項目名               | ラベル名       | UI部品        | 型       | 入力     | 初期値   | サイズ | 文字種         | バリデーションルール | エラーメッセージ                       | 備考                             |
| --------------- | -------------------- | -------------- | ------------- | -------- | -------- | -------- | ------ | -------------- | -------------------- | -------------------------------------- | -------------------------------- |
| admin_id        | 管理者ID             | 管理者ID       | TextInput     | string   | 表示のみ | 自動生成 | 20     | 半角英数字     | ―                   | ―                                     | 編集時のみ表示、自動採番         |
| admin_name      | 管理者氏名           | 氏名           | TextInput     | string   | 必須     | ―       | 50     | 全角・半角     | 必須                 | 名前を入力してください                 |                                  |
| admin_email     | 管理者メールアドレス | メールアドレス | TextInput     | string   | 必須     | ―       | 100    | 半角英数字記号 | 必須、メール形式     | 有効なメールアドレスを入力してください |                                  |
| admin_password  | 管理者パスワード     | パスワード     | PasswordInput | string   | 必須     | ―       | 20     | 半角英数字記号 | 必須、8〜20文字      | パスワードを正しく入力してください     |                                  |
| registered_date | 登録日時             | 登録日時       | Label         | datetime | 表示のみ |          | ―     | ―             | ―                   | ―                                     | 編集不可、登録日時の表示用       |
| admin_role      | 権限                 | 権限           | Select        | enum     | 必須     | ―       | ―     | ―             | 必須                 | 権限を選択してください                 | 例：スーパ管理者、一般管理者     |
| save_btn        | 保存                 | 保存           | Button        | ―       | ―       | ―       | ―     | ―             | ―                   | ―                                     | 登録・編集内容の保存を実行       |
| delete_btn      | 削除                 | 削除           | Button        | ―       | ―       | ―       | ―     | ―             | ―                   | ―                                     | 管理者情報の削除を実行           |
| cancel_btn      | キャンセル           | キャンセル     | Button        | ―       | ―       | ―       | ―     | ―             | ―                   | ―                                     | 編集キャンセルまたは前画面へ戻る |

## 8. DB物理設計

### 8.1 物理テーブル定義書

#### `CUSTOMER`テーブル

| 論理名             | 物理名        | 型       | サイズ | NULL | pk | FK | UQ | CHK | Index | デフォルト値      | 備考                              |
| ------------------ | ------------- | -------- | ------ | ---- | -- | -- | -- | --- | ----- | ----------------- | --------------------------------- |
| 会員ID             | user_id       | VARCHAR  | 64     | NO   | ○ |    |    |     | ○    |                   |                                   |
| 氏名               | user_name     | VARCHAR  | 64     | YES  |    |    |    |     |       |                   |                                   |
| メールアドレス     | user_email    | VARCHAR  | 255    | YES  |    |    | ○ |     |       |                   |                                   |
| ハッシュパスワード | user_password | VARCHAR  | 255    | YES  |    |    |    |     |       |                   | ゲストはNULL                      |
| 住所               | user_address  | TEXT     |        | YES  |    |    |    |     |       |                   |                                   |
| 登録日時           | user_date     | DATETIME |        | NO   |    |    |    |     |       | CURRENT_TIMESTAMP |                                   |
| メンバーシップ     | membership    | BOOLEAN  |        | NO   |    |    |    | ●  |       | false             | true（会員）またはfalse（ゲスト） |

---

#### `ADMIN`テーブル

| 論理名                   | 物理名         | 型       | サイズ | NULL | pk | FK | UQ | CHK | Index | デフォルト値      | 備考 |
| ------------------------ | -------------- | -------- | ------ | ---- | -- | -- | -- | --- | ----- | ----------------- | ---- |
| 管理者ID                 | admin_id       | VARCHAR  | 64     | NO   | ○ |    |    |     | ○    |                   |      |
| 管理者氏名               | admin_name     | VARCHAR  | 64     | NO   |    |    |    |     |       |                   |      |
| 管理者メールアドレス     | admin_email    | VARCHAR  | 255    | NO   |    |    | ○ |     |       |                   |      |
| 管理者ハッシュパスワード | admin_password | VARCHAR  | 255    | NO   |    |    |    |     |       |                   |      |
| 登録日時                 | admin_date     | DATETIME |        | NO   |    |    |    |     |       | CURRENT_TIMESTAMP |      |

---

#### `ORDER`テーブル

| 論理名               | 物理名        | 型       | サイズ | NULL | pk | FK | UQ | CHK | Index | デフォルト値      | 備考                                         |
| -------------------- | ------------- | -------- | ------ | ---- | -- | -- | -- | --- | ----- | ----------------- | -------------------------------------------- |
| 注文ID               | order_id      | VARCHAR  | 64     | NO   | ○ |    |    |     | ○    |                   |                                              |
| 会員ID               | user_id       | VARCHAR  | 64     | NO   |    | ○ |    |     |       |                   |                                              |
| 購入者氏名           | buyer_name    | VARCHAR  | 64     | NO   |    |    |    |     |       |                   |                                              |
| 購入者メールアドレス | buyer_email   | VARCHAR  | 255    | NO   |    |    |    |     |       |                   |                                              |
| 購入者住所           | buyer_address | TEXT     |        | NO   |    |    |    |     |       |                   |                                              |
| 注文日時             | order_date    | DATETIME |        | NO   |    |    |    |     | ○    | CURRENT_TIMESTAMP |                                              |
| 配送先氏名           | ship_name     | VARCHAR  | 64     | NO   |    |    |    |     |       |                   |                                              |
| 配送先住所           | ship_address  | TEXT     |        | NO   |    |    |    |     |       |                   |                                              |
| 送料                 | ship_fee      | DECIMAL  | 10,2   | NO   |    |    |    | ●  |       | 700               | ship_fee = 700                               |
| 合計金額             | total_price   | DECIMAL  | 10,2   | NO   |    |    |    | ●  |       | 0.00              | total_price >= 0                             |
| 決済方法             | pay_method    | VARCHAR  | 50     | NO   |    |    |    | ●  |       |                   | 口座振込、代引き                             |
| 注文ステータス       | order_status  | VARCHAR  | 50     | NO   |    |    |    | ●  |       |                   | 受付済、決済済、出荷済、キャンセル、発送完了 |

---

#### `ORDER_DETAIL`テーブル

| 論理名     | 物理名          | 型      | サイズ | NULL | pk | FK | UQ | CHK | Index | デフォルト値 | 備考                                                                      |
| ---------- | --------------- | ------- | ------ | ---- | -- | -- | -- | --- | ----- | ------------ | ------------------------------------------------------------------------- |
| 注文詳細ID | detail_id       | VARCHAR | 64     | NO   | ○ |    |    |     | ○    |              |                                                                           |
| 注文ID     | order_id        | VARCHAR | 64     | NO   |    | ○ |    |     |       |              | 外部キーにON DELETE CASCADEを設定。注文削除時に関連注文詳細も削除される。 |
| 商品ID     | product_id      | VARCHAR | 64     | NO   |    |    |    |     |       |              |                                                                           |
| 商品名     | product_name    | VARCHAR | 255    | NO   |    |    |    |     | ○    |              |                                                                           |
| 数量       | detail_quantity | INT     |        | NO   |    |    |    | ●  |       | 1            | detail_quantity >= 1                                                      |
| 単価       | unit_price      | DECIMAL | 10,2   | NO   |    |    |    | ●  |       | 0.00         | unit_price>=0                                                             |

---

#### `PRODUCT`テーブル

| 論理名     | 物理名        | 型      | サイズ | NULL | pk | FK | UQ | CHK | Index | デフォルト値 | 備考               |
| ---------- | ------------- | ------- | ------ | ---- | -- | -- | -- | --- | ----- | ------------ | ------------------ |
| 商品ID     | product_id    | VARCHAR | 64     | NO   | ○ |    |    |     | ○    |              |                    |
| 商品名     | product_name  | VARCHAR | 255    | NO   |    |    |    |     | ○    |              |                    |
| 商品説明   | description   | TEXT    |        | YES  |    |    |    |     |       |              |                    |
| 価格       | product_price | DECIMAL | 10,2   | NO   |    |    |    | ●  |       | 0.00         | product_price >= 0 |
| カテゴリID | category_id   | VARCHAR | 64     | NO   |    | ○ |    |     |       |              |                    |

---

#### `PRODUCT_IMAGE`テーブル

| 論理名  | 物理名     | 型      | サイズ | NULL | pk | FK | UQ | CHK | Index | デフォルト値 | 備考                                                                  |
| ------- | ---------- | ------- | ------ | ---- | -- | -- | -- | --- | ----- | ------------ | --------------------------------------------------------------------- |
| 画像ID  | image_id   | VARCHAR | 64     | NO   | ○ |    |    |     | ○    |              |                                                                       |
| 商品ID  | product_id | VARCHAR | 64     | NO   |    | ○ |    |     |       |              | 外部キーにON DELETE CASCADEを設定。商品削除時に商品画像も削除される。 |
| 画像URL | image_url  | VARCHAR | 1024   | NO   |    |    |    |     |       |              |                                                                       |
| 表示順  | sort       | INT     |        | NO   |    |    |    | ●  |       | 0            | sort >= 0                                                             |

---

#### `CATEGORY`テーブル

| 論理名     | 物理名        | 型      | サイズ | NULL | pk | FK | UQ | CHK | Index | デフォルト値 | 備考     |
| ---------- | ------------- | ------- | ------ | ---- | -- | -- | -- | --- | ----- | ------------ | -------- |
| カテゴリID | category_id   | VARCHAR | 64     | NO   | ○ |    |    |     | ○    |              |          |
| カテゴリ名 | category_name | VARCHAR | 255    | NO   |    |    | ○ |     | ○    |              | 一意制約 |

---

#### `CART`テーブル

| 論理名   | 物理名  | 型       | サイズ | NULL | pk | FK | UQ | CHK | Index | デフォルト値      | 備考                                                                |
| -------- | ------- | -------- | ------ | ---- | -- | -- | -- | --- | ----- | ----------------- | ------------------------------------------------------------------- |
| カートID | cart_id | VARCHAR  | 64     | NO   | ○ |    |    |     | ○    |                   |                                                                     |
| 会員ID   | user_id | VARCHAR  | 64     | NO   |    | ○ |    |     |       |                   | 外部キーにON DELETE CASCADEを設定。会員削除時にカートも削除される。 |
| 作成日時 | create  | DATETIME |        | NO   |    |    |    |     |       | CURRENT_TIMESTAMP |                                                                     |
| 更新日時 | update  | DATETIME |        | NO   |    |    |    |     |       | CURRENT_TIMESTAMP |                                                                     |

---

#### `CART_ITEM`テーブル

| 論理名   | 物理名        | 型      | サイズ | NULL | pk | FK | UQ | CHK | Index | デフォルト値 | 備考                                                                          |
| -------- | ------------- | ------- | ------ | ---- | -- | -- | -- | --- | ----- | ------------ | ----------------------------------------------------------------------------- |
| カートID | cart_id       | VARCHAR | 64     | NO   | ○ | ○ |    |     |       |              | 外部キーにON DELETE CASCADEを設定。カート削除時に関連カート商品も削除される。 |
| 商品ID   | product_id    | VARCHAR | 64     | NO   | ○ | ○ |    |     |       |              | 外部キーにON DELETE CASCADEを設定。商品削除時に関連カート商品も削除される。   |
| 数量     | cart_quantity | INT     |        | NO   |    |    |    | ●  |       | 1            | cart_quantity >= 1                                                            |

---

### 8.2 CRUD操作SQL一覧

#### `CUSTOMER`テーブル

- **登録**
  INSERT INTO customer (user_name, user_email, membership, user_date)
  VALUES (?, ?, ?, CURRENT_TIMESTAMP);
- **参照**
  SELECT user_id, user_name, email, membership, user_date
  FROM customer
  WHERE user_id = ?;
- **更新**
  UPDATE customer
  SET user_name = ?, user_email = ?, membership = ?
  WHERE user_id = ?;
- **削除**
  DELETE FROM customer
  WHERE user_id = ?;

---

#### `ADMIN`テーブル

- **登録**
  INSERT INTO admin (admin_name, admin_email, admin_password, admin_date)
  VALUES (?, ?, ?, CURRENT_TIMESTAMP);
- **参照**
  SELECT admin_id, admin_name, admin_email, admin_date
  FROM admin
  WHERE admin_id = ?;
- **更新**
  UPDATE admin
  SET admin_name = ?, admin_email = ?, admin_password = ?
  WHERE admin_id = ?;
- **削除**
  DELETE FROM admin
  WHERE admin_id = ?;

---

#### `ORDER`テーブル

- **登録**
  INSERT INTO orders (user_id, buyer_name, buyer_email, buyer_address, order_date, ship_name, ship_address, ship_fee, pay_method, order_status, total_price)
  VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?, ?, ?, ?, ?);
- **参照**
  SELECT user_id, buyer_name, buyer_email, buyer_address, order_date, ship_name, ship_address, ship_fee, pay_method, order_status, total_price
  FROM orders
  WHERE order_id = ?;
- **更新**
  UPDATE orders
  SET status = ?, total_price = ?
  WHERE order_id = ?;
- **削除**
  DELETE FROM orders
  WHERE order_id = ?;

---

#### `ORDER_DETAIL`テーブル

- **登録**
  INSERT INTO order_detail (order_id, product_id, product_name, detail_quantity, unit_price)
  VALUES (?, ?, ?, ?);
- **参照**
  SELECT order_detail_id, order_id, product_id, product_name, detail_quantity, unit_price
  FROM order_detail
  WHERE order_detail_id = ?;
- **更新**
  UPDATE order_detail
  SET detail_quantity = ?, unit_price = ?
  WHERE order_detail_id = ?;
- **削除**
  DELETE FROM order_detail
  WHERE order_detail_id = ?;

---

#### `PRODUCT`テーブル

- **登録**
  INSERT INTO product (product_name, description, product_price, category_id)
  VALUES (?, ?, ?, ?);
- **参照**
  SELECT product_id, name, description, product_price, category_id
  FROM product
  WHERE product_id = ?;
- **更新**
  UPDATE product
  SET product_name = ?, description = ?, product_price = ?, category_id = ?
  WHERE product_id = ?;
- **削除**
  DELETE FROM product
  WHERE product_id = ?;

---

#### `PRODUCT_IMAGE` テーブル

- **登録**
  INSERT INTO product_image (product_id, image_url, sort)
  VALUES (?, ?, ?);
- **参照**
  SELECT product_image_id, product_id, image_url, sort
  FROM product_image
  WHERE product_image_id = ?;
- **更新**
  UPDATE product_image
  SET image_url = ?, sort = ?
  WHERE product_image_id = ?;
- **削除**
  DELETE FROM product_image
  WHERE product_image_id = ?;

---

#### `CATEGORY`テーブル

- **登録**
  INSERT INTO category (category_name)
  VALUES (?);
- **参照**
  SELECT category_id, category_name
  FROM category
  WHERE category_id = ?;
- **更新**
  UPDATE category
  SET category_name = ?
  WHERE category_id = ?;
- **削除**
  DELETE FROM category
  WHERE category_id = ?;

---

#### `CART`テーブル

- **登録**
  INSERT INTO cart (user_id, create)
  VALUES (?, CURRENT_TIMESTAMP);
- **参照**
  SELECT cart_id, user_id, create
  FROM cart
  WHERE cart_id = ?;
- **更新**
  UPDATE cart
  SET user_id = ?
  WHERE cart_id = ?;
- **削除**
  DELETE FROM cart
  WHERE cart_id = ?;

---

#### `CART_ITEM`テーブル

- **登録**
  INSERT INTO cart_item (cart_id, product_id, cart_quantity)
  VALUES (?, ?, ?);
- **参照**
  SELECT cart_id, product_id, cart_quantity
  FROM cart_item
  WHERE cart_id = ? AND product_id = ?;
- **更新**
  UPDATE cart_item
  SET cart_quantity = ?
  WHERE cart_id = ? AND product_id = ?;
- **削除**
  DELETE FROM cart_item
  WHERE cart_id = ? AND product_id = ?;

### 8.3 定期メンテナンスSQL

#### 古いカートの削除（7日以上前）

- **カートアイテムの削除**
  DELETE FROM cart_item
  WHERE cart_id IN (
  SELECT cart_id FROM cart
  WHERE created_at < CURRENT_TIMESTAMP - INTERVAL '7 days'
  );
- **カートの削除**
  DELETE FROM cart
  WHERE created_at < CURRENT_TIMESTAMP - INTERVAL '7 days';

#### 30日以上前に登録された非会員で注文実績がない顧客の削除

- **顧客の削除**
  DELETE FROM customer
  WHERE membership = false
  AND user_date < CURRENT_DATE - INTERVAL '30 days'
  AND (user_name IS NULL OR user_name = '')
  AND user_id NOT IN (
  SELECT DISTINCT user_id FROM orders
  );

### 8.4 トランザクション管理

#### 注文確定処理（会員）

- **対象テーブル**

  - `ORDER` 登録
  - `ORDER_DETAIL` 登録
  - `CART_ITEM` 削除
  - `CART` 削除
- **理由**
  注文情報とカートの整合性を保つため、すべての処理をまとめてトランザクション管理する必要がある。

<div class = "mermaid">
stateDiagram-v2
    処理開始 --> カート確認

    カート確認 --> 注文登録（INSERT） : 注文確定
    注文登録（INSERT） --> Rollback : エラー
    注文登録（INSERT） --> 注文詳細登録（INSERT）:OK

    注文詳細登録（INSERT）--> Rollback :エラー

    注文詳細登録（INSERT）-->カート削除(DELETE):OK

    カート削除(DELETE)-->Rollback:エラー

    カート削除(DELETE)-->Commit:OK

    Rollback-->エラー処理

    Commit-->注文完了

</div>

---

#### 注文確定処理（ゲスト）

- **対象テーブル**

  - `ORDER` 登録
  - `ORDER_DETAIL` 登録
  - `CUSTOMER`登録
  - `CART_ITEM` 削除
  - `CART` 削除
- **理由**
  顧客情報と注文情報とカートの整合性を保つため、すべての処理をまとめてトランザクション管理する必要がある。

<div class = "mermaid">
stateDiagram-v2
    処理開始 --> カート確認

    カート確認 --> 顧客情報登録（INSERT）: 注文確定
    顧客情報登録（INSERT）-->Rollback:エラー
    顧客情報登録（INSERT）-->  注文登録（INSERT）:OK
    注文登録（INSERT） --> Rollback : エラー
    注文登録（INSERT） --> 注文詳細登録（INSERT）:OK

    注文詳細登録（INSERT）--> Rollback :エラー

    注文詳細登録（INSERT）-->カート削除（DELETE）:OK

    カート削除（DELETE）-->Rollback:エラー

    カート削除（DELETE）-->Commit:OK

    Rollback-->エラー処理

    Commit-->注文完了

</div>

---

#### 商品登録（管理者）

- **対象テーブル**

  - `PRODUCT` 登録
  - `PRODUCT_IMAGE` 登録
- **理由**
  商品情報と画像情報の不整合を防止するため、一括で登録処理をトランザクション管理する必要がある。

<div class = "mermaid">
stateDiagram-v2
    処理開始 --> 商品登録画面

    商品登録画面 --> PRODUCT（INSERT）

    PRODUCT（INSERT） --> Rollback:エラー

    PRODUCT（INSERT）-->PRODUCT_IMAGE（INSERT） :OK

    PRODUCT_IMAGE（INSERT）-->Rollback:エラー

    PRODUCT_IMAGE（INSERT）-->Commit:OK

    Rollback-->エラー処理

    Commit-->登録完了

</div>

#### 商品編集（管理者）

- **対象テーブル**

  - `PRODUCT` 更新
  - `PRODUCT_IMAGE` の追加・削除
- **理由**
  商品情報の一貫性を保つため、複数テーブルの更新をトランザクション管理で一括処理する必要がある。

<div class = "mermaid">
stateDiagram-v2
    処理開始 --> 商品編集画面

    商品編集画面-->PRODUCT（UPDATE）
    PRODUCT（UPDATE）-->Rollback:エラー
    PRODUCT（UPDATE） --> PRODUCT_IMAGE（INSERT,DELETE） : OK
    PRODUCT_IMAGE（INSERT,DELETE） --> Rollback : エラー
    PRODUCT_IMAGE（INSERT,DELETE）--> Commit:OK
    Rollback--> エラー処理
    Commit-->編集完了

</div>

## 9 API詳細

| 機能カテゴリ                  | 機能                       | メソッド | エンドポイント                         | 概要                                 |
| ----------------------------- | -------------------------- | -------- | -------------------------------------- | ------------------------------------ |
| 1. 会員関連                   | 会員登録                   | POST     | /api/customers/register                | 新規会員の登録                       |
|                               | ログイン                   | POST     | /api/auth/login                        | メールアドレス＋パスワードでログイン |
|                               | ログアウト                 | POST     | /api/auth/logout                       | セッションまたはトークンの無効化     |
|                               | 会員情報取得（マイページ） | GET      | /api/customers/me                      | ログイン中の会員情報取得             |
|                               | 会員情報更新               | PUT      | /api/customers/me                      | 氏名・住所などの情報を更新           |
| 2. 商品関連                   | 商品一覧取得               | GET      | /api/products                          | 商品の一覧を取得                     |
|                               | 商品詳細取得               | GET      | /api/products/{productId}              | 商品の詳細を取得                     |
|                               | 商品画像追加               | POST     | /api/admin/products/{productId}/images | 商品画像を追加                       |
| 3. カテゴリ関連               | カテゴリ一覧               | GET      | /api/categories                        | カテゴリリストを取得                 |
|                               | カテゴリ新規登録           | POST     | /api/admin/categories                  | 新規カテゴリの登録                   |
|                               | カテゴリ更新               | PUT      | /api/admin/categories/{categoryId}     | カテゴリ情報更新                     |
|                               | カテゴリ削除               | DELETE   | /api/admin/categories/{categoryId}     | カテゴリ削除                         |
| 4. 注文関連（ユーザー側）     | 注文登録                   | POST     | /api/orders                            | 商品購入処理（注文確定）             |
| 5. カート関連（サーバー保持） | カート内容取得             | GET      | /api/cart                              | カートの中身を取得                   |
|                               | カート商品追加             | POST     | /api/cart/products                     | カートに商品を追加                   |
|                               | カート商品更新             | PUT      | /api/cart/products/{productId}         | カート内商品の数量や属性を更新       |
|                               | カート商品削除             | DELETE   | /api/cart/products/{productId}         | カート内の商品を削除                 |
| 6. 管理者関連                 | 管理者ログイン             | POST     | /api/admin/auth/login                  | 管理者用ログイン                     |
|                               | 管理者ログアウト           | POST     | /api/admin/auth/logout                 | 管理者用ログアウト                   |
|                               | 商品登録                   | POST     | /api/admin/products                    | 商品を新規登録                       |
|                               | 商品編集                   | PUT      | /api/admin/products/{productId}        | 商品情報を更新                       |
|                               | 注文一覧取得               | GET      | /api/admin/orders                      | 全注文の一覧を取得                   |
|                               | 注文詳細取得               | GET      | /api/admin/orders/{orderId}            | 注文の詳細を取得                     |

---

### ■ 9.1 商品詳細取得API

#### エンドポイント

`GET /api/products/{productId}`

#### 機能概要

指定された商品IDの商品詳細情報を取得するAPI。

#### パスパラメータ

| パラメータ名 | 型   | 必須 | 説明                     |
| ------------ | ---- | ---- | ------------------------ |
| productId    | 数値 | 必須 | 詳細を取得したい商品のID |

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "id": 101,
  "name": "オリジナルTシャツ",
  "description": "シンプルなデザインのTシャツです。",
  "price": 2500,
  "category": {
    "id": 5,
    "name": "アパレル"
  },
  "images": [
    "https://example.com/images/product101_1.jpg",
    "https://example.com/images/product101_2.jpg"
  ]
  }

  {
  "message": "指定された商品IDが存在しません。"
  }
```

**処理概要**

- productId に対応する商品をデータベースから検索
- 商品が存在しない場合は 404 を返却
- 商品情報（カテゴリ、画像含む）を整形して返却

**備考**

- 非ログイン状態でも使用可能
- 商品が非公開などの条件がある場合、追加の制御が必要

---

### ■ 9.2 ログインAPI

#### エンドポイント

`POST /api/auth/login`

#### 機能概要

ユーザーがメールアドレスとパスワードを使用してログインするAPI。
認証成功時にセッション開始またはトークンを返却する。

#### リクエストパラメータ（JSON形式）

```json
{
  "user_email": "string",      // 必須、登録済みメールアドレス
  "user_password": "string"    // 必須、登録済みユーザーの正しいパスワード
}
 {
  "message": "ログイン成功",
  "token": "xxxxx.yyyyy.zzzzz",   // トークン認証方式の場合（JWTなど）
  "customer": {
    "user_id": "user1234",
    "membership": "true"
  }
}
{
  "message": "メールアドレスまたはパスワードが正しくありません。"
}
```

---

### ■ 9.3 ログアウトAPI

#### エンドポイント

`POST /api/auth/logout`

#### 機能概要

現在のログインセッションまたは認証トークンを無効化し、ログアウト状態にする。

#### リクエストパラメータ

なし
※ただし、認証トークンまたはセッションクッキーをヘッダーで送信する必要がある。

#### ヘッダー例（トークン認証の場合）

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "message": "ログアウトしました。"
}

 {
  "message": "認証されていません。"
}
```

**処理概要**

- JWT方式の場合：クライアント側でトークン破棄（サーバー側に状態を持たない）
- セッション方式の場合：サーバー側でセッションを破棄（invalidate）
- トークンブラックリスト方式を採用する場合は、トークンを無効リストに保存する

**備考**
  -クライアントはログアウト後にトークンやセッションクッキーを削除する必要がある。

- フロントエンド側はこのAPIのレスポンスを受けてログイン状態を解除する。

---

### ■ 9.4 会員情報取得API（マイページ用）

#### エンドポイント

`GET /api/customers/me`

#### 機能概要

ログイン中の会員自身の情報を取得する。マイページ表示などに使用。

#### リクエストパラメータ

なし
※ただし、認証情報（セッションまたはJWT）をヘッダーで送信すること。

#### ヘッダー例（JWTトークンを用いる場合）

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "user_id": "abc12345",
  "user_name": "山田 太郎",
  "user_email": "taro@example.com",
  "user_address": "東京都港区南青山1-1-1",
  "member_since": "2024-06-01"
}

 {
  "message": "認証されていません。"
}
```

**処理概要**
トークンまたはセッションから現在のユーザーを特定

該当するユーザーの情報（会員ID、氏名、メールアドレス、住所、登録日時など）を取得して返却

**備考**
会員情報編集画面やマイページ初期表示時に利用

パスワードなどの機密情報はレスポンスに含めない

---

### ■ 9.4 会員情報更新API

#### エンドポイント

`PUT /api/customers/me`

#### 機能概要

ログイン中の会員が、自身の情報（氏名・住所など）を更新する。

#### リクエストパラメータ（JSON形式のBody）

```json
{
  "user_name": "山田 太郎",
  "user_address": "東京都港区南青山1-1-1"
}

 必須項目
user_name：氏名（文字列、最大100文字）

user_address：住所（文字列、最大255文字）
Authorization: Bearer <token>  
Content-Type: application/json
{
  "errors": {
    "user_name": "氏名は必須です。",
    "user_address": "住所は255文字以内で入力してください。"
  }
}
{
  "message": "認証されていません。"
}
```

**処理概要**

- 認証済みのユーザーを識別
- 入力値のバリデーションを実施
- 会員テーブルの対象レコードを更新
- 成功メッセージを返却

**備考**

- メールアドレスやパスワードの更新は別APIで対応（セキュリティ上の理由）
- 更新不可のフィールド（例：会員ID、登録日時など）は受け付けない

---

### ■ 9.5 商品一覧取得API

#### エンドポイント

`GET /api/products`

#### 機能概要

商品一覧を取得する。無限スクロール対応。
順番指定やページ番号の指定、表示件数の制御は行わない。

#### リクエストパラメータ

なし

#### 成功レスポンス（HTTP 200 OK）

```json
[
  {
    "product_id": 101,
    "product_name": "スマートフォン X",
    "price": 59800,
    "thumbnail_url": "https://example.com/images/101-thumb.jpg",
    "category_id": 5,
  },
  {
    "product_id": 102,
    "product_name": "スマートフォン Y",
    "price": 49800,
    "thumbnail_url": "https://example.com/images/102-thumb.jpg",
    "category_id": 5,
  }
  // 以下略
]
 {
  "message": "商品情報の取得に失敗しました。"
}
```

**処理概要**

- データベースから商品情報を全件取得
- 商品の表示順や件数制御は行わない（フロント側でスクロール表示を制御）

**備考**

- 商品は受注販売形式のため、在庫情報は参考値
- 無限スクロールに対応しているが、サーバ側では特別なページング制御を行わない
- レスポンスは配列形式で返却する

---

### ■ 9.6 商品画像追加API

#### エンドポイント

`POST /api/admin/products/{productId}/images`

#### 機能概要

指定した商品IDに対して、新しい商品画像を追加する。

#### パスパラメータ

| パラメータ名 | 型   | 必須 | 説明                       |
| ------------ | ---- | ---- | -------------------------- |
| productId    | 数値 | 必須 | 画像を追加する対象の商品ID |

#### リクエストボディ（multipart/form-data）

| フィールド名 | 型       | 必須 | 説明                                       |
| ------------ | -------- | ---- | ------------------------------------------ |
| image_file   | ファイル | 必須 | アップロードする画像ファイル（jpg, png等） |

#### 成功レスポンス（HTTP 201 Created）

```json
{
  "message": "画像が正常に追加されました。",
  "image_url": "https://example.com/images/101-new.jpg"
}
 {
  "message": "画像ファイルが不正です。"
}
{
  "message": "指定された商品が存在しません。"
}
```

**処理概要**

- productId の存在チェック
- アップロード画像のファイル形式チェック（jpg, png のみ許可）
- 画像ファイルの保存（ファイル名は自動生成が望ましい）
- 商品の画像リストに新しい画像URLを追加

**備考**

- 本APIは 管理者権限 が必要
- 複数回の画像追加をサポート（画像の追加上限や順序管理は別途検討）

---

### ■ 9.7 カテゴリ一覧取得API

#### エンドポイント

`GET /api/categories`

#### 機能概要

登録されているカテゴリの一覧を取得する。

#### リクエストパラメータ

なし

#### 成功レスポンス（HTTP 200 OK）

```json
[
  {
    "category_id": 1,
    "category_name": "スマートフォン"
  },
  {
    "category_id": 2,
    "category_name": "パソコン"
  },
  {
    "category_id": 3,
    "category_name": "アクセサリー"
  }
]
 {
  "message": "カテゴリ情報の取得に失敗しました。"
}
```

**処理概要**

- カテゴリマスタテーブルから全件を取得
- 取得結果を一覧形式で返却

**備考**

- 一般ユーザーも閲覧可能
- カテゴリ順は登録順、または別途定義された表示順に従う

### ■ 9.8 カテゴリ新規登録API

#### エンドポイント

`POST /api/admin/categories`

#### 機能概要

新しいカテゴリを登録する（管理者専用機能）。

#### リクエストボディ（JSON）

```json
{
  "category_name": "スマートウォッチ"
}

 バリデーション
category_name：必須、50文字以内、同名カテゴリが存在しないこと
{
  "message": "カテゴリが登録されました。",
  "category_id": 123
}
{
  "message": "カテゴリ名は必須です。"
}
{
  "message": "同じカテゴリ名が既に存在します。"
}
```

**処理概要**

- 管理者認証の確認
- 入力値バリデーション（必須・文字数制限・重複確認）
- DBへ新しいカテゴリを登録
- 登録されたカテゴリIDを返却

**備考**

- 管理者権限を持つユーザーのみ利用可能

---

### ■ 9.9 カテゴリ情報更新API

#### エンドポイント

`PUT /api/admin/categories/{categoryId}`

#### 機能概要

指定したカテゴリの情報を更新する（管理者専用）。

#### パスパラメータ

| パラメータ名 | 型   | 必須 | 説明                 |
| ------------ | ---- | ---- | -------------------- |
| categoryId   | 数値 | 必須 | 更新対象のカテゴリID |

#### リクエストボディ（JSON）

```json
{
  "category_name": "スマートデバイス"
}
 バリデーション
category_name：必須、50文字以内、同名カテゴリが存在しないこと
{
  "message": "カテゴリ情報を更新しました。"
}
{
  "message": "カテゴリ名は必須です。"
}
{
  "message": "指定されたカテゴリが存在しません。"
}
```

**処理概要**

- 管理者認証の確認
- categoryId の存在確認
- 入力値のバリデーション
- カテゴリ名の重複チェック
- カテゴリ情報をデータベース上で更新

**備考**

- 管理者権限を持つユーザーのみ利用可能

---

### ■ 9.10 カテゴリ削除API

#### エンドポイント

`DELETE /api/admin/categories/{categoryId}`

#### 機能概要

指定したカテゴリを削除する（管理者専用）。

#### パスパラメータ

| パラメータ名 | 型   | 必須 | 説明                 |
| ------------ | ---- | ---- | -------------------- |
| categoryId   | 数値 | 必須 | 削除対象のカテゴリID |

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "message": "カテゴリを削除しました。"
}

 {
  "message": "指定されたカテゴリが存在しません。"
}
{
  "message": "紐づく商品が存在するため、削除できません。"
}
```

**処理概要**

- 管理者認証を確認
- categoryId の存在を確認
- 関連する商品などの依存関係をチェック（存在する場合は削除不可）
- 問題がなければカテゴリを削除

**備考**

- 本APIは管理者権限を有するユーザーのみ利用可能

---

### ■ 9.11 注文登録API（ユーザー側）

#### エンドポイント

`POST /api/orders`

#### 機能概要

カート内の商品をもとに注文を確定し、注文情報を登録する。
注文確定後、在庫数を更新する。

#### リクエストボディ（JSON形式）

```json
{
  "customer_id": "string",
  "order_items": [
    {
      "product_id": "string",
      "quantity": 1
    }
  ],
  "buyer_name": "string",
  "buyer_address": "string",
  "buyer_email": "string",
  "ship_name": "string or null",
  "ship_address": "string or null",
  "pay_method": "string"
}

 パスパラメータ
なし
{
  "order_id": "string",
  "message": "注文が正常に登録されました。"
}
{
  "message": "入力値が不正です。"
}
{
  "message": "認証されていません。"
}
{
  "message": "注文処理中にエラーが発生しました。"
}
```

**処理概要**

- ログイン認証（会員の場合）
- 入力値のバリデーションチェック
- 注文情報のDB登録（ORDERテーブル、ORDER_DETAILテーブルなど）
- 注文完了通知メールの送信（必要に応じて）

**備考**
非会員の注文も可能（customer_idは空またはnull）

- 注文登録はトランザクション処理として一括管理すること

---

### ■ 9.12 カート内容取得API

#### エンドポイント

`GET /api/cart`

#### 機能概要

ログインユーザーまたはセッションのカートに入っている商品情報を取得する。

#### パスパラメータ

なし

#### クエリパラメータ

なし

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "cart_items": [
    {
      "item_id": "string",
      "product_id": "string",
      "product_name": "string",
      "quantity": 1,
      "price": 1000,
      "image_url": "string"
    }
  ],
  "total_quantity": 3,
  "total_price": 3000
}
 {
  "message": "認証されていません。"
}
{
  "message": "カート情報の取得に失敗しました。"
}
```

**処理概要**

- ユーザー認証またはセッションIDによる識別
- カート情報の取得（DBまたはセッションストア）
- 商品情報の補完と合計数量・金額の集計
- レスポンスを整形して返却

**備考**

- 非会員ユーザーの場合はセッションベースでカートを管理する
- 削除された商品などが含まれる場合は自動で除外するのが望ましい

---

### ■ 9.13 商品詳細取得API

#### エンドポイント

`GET /api/products/{productId}`

#### 機能概要

指定された商品IDの商品詳細情報を取得する。

#### パスパラメータ

| パラメータ名 | 型   | 必須 | 説明                     |
| ------------ | ---- | ---- | ------------------------ |
| productId    | 数値 | 必須 | 詳細を取得したい商品のID |

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "id": 101,
  "name": "オリジナルTシャツ",
  "description": "シンプルなデザインのTシャツです。",
  "price": 2500,
  "stock": 10,
  "category": {
    "id": 5,
    "name": "アパレル"
  },
  "images": [
    "https://example.com/images/product101_1.jpg",
    "https://example.com/images/product101_2.jpg"
  ]
}
```

| ステータスコード   | 内容                             |
| ------------------ | -------------------------------- |
| 404 Not Found      | 指定された商品IDが存在しない場合 |
| **処理概要** |                                  |

- productId に対応する商品をデータベースから検索
- 商品が存在しない場合は 404 を返却
- 商品情報（カテゴリ、画像含む）を整形して返却

**備考**

- 非ログイン状態でも使用可能
- 商品が非公開などの条件がある場合、追加の制御が必要

---

### ■ 9.14 カート商品追加API

#### エンドポイント

`POST /api/cart/products`

#### 機能概要

指定した商品をカートに追加する。

#### リクエストボディ（JSON）

```json
{
  "productId": 101,
  "quantity": 2
}
```

| ステータスコード | 内容                                   |
| ---------------- | -------------------------------------- |
| 400 Bad Request  | productId または quantity が不正な場合 |
| 404 Not Found    | 指定された `productId` が存在しない  |

**処理概要**

- 認証済みユーザーのセッション・トークンを確認
- 既にカートに存在していれば数量を加算、なければ新規追加
- カートの状態を返却

**備考**

- ユーザーはログインしている必要があります
- サーバー側のカート情報を操作します（クッキー等は使用しません）

---

### ■ 9.15 カート商品更新API

#### エンドポイント

`PUT /api/cart/products/{productId}`

#### 機能概要

カート内にある指定商品の数量や属性（オプションがあれば）を更新する。

#### パスパラメータ

| パラメータ名 | 型   | 必須 | 説明                     |
| ------------ | ---- | ---- | ------------------------ |
| productId    | 数値 | 必須 | 更新対象のカート内商品ID |

#### リクエストボディ（JSON）

```json
{
  "quantity": 3
}
| パラメータ名   | 型  | 必須 | 説明          |
| -------- | -- | -- | ----------- |
| quantity | 数値 | 必須 | 更新後の数量（1以上） |
{
  "message": "カートの商品を更新しました。",
  "cartItem": {
    "productId": 301,
    "productId": 101,
    "quantity": 3
  }
}
```

| ステータスコード | 内容                                  |
| ---------------- | ------------------------------------- |
| 400 Bad Request  | リクエスト形式不正、または数量が不正  |
| 404 Not Found    | 指定された `productId` が存在しない |

**処理概要**

- ログイン状態の確認
- 対象 productId の存在確認
- 指定された数量に更新
- 更新後のカート情報を返却

**備考**

- 商品属性（例：サイズ・カラー）変更も対応する場合は設計拡張を検討

---

### ■9.16 カート商品削除API

#### エンドポイント

`DELETE /api/cart/products/{productId}`

#### 機能概要

指定されたカート内の商品を削除する。

#### パスパラメータ

| パラメータ名 | 型   | 必須 | 説明                   |
| ------------ | ---- | ---- | ---------------------- |
| productId    | 数値 | 必須 | 削除対象のカート商品ID |

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "message": "カートの商品を削除しました。"
}
```

| ステータスコード | 内容                                  |
| ---------------- | ------------------------------------- |
| 404 Not Found    | 指定された `productId` が存在しない |

**処理概要**

- 該当 productId がユーザーのカートに存在するか確認
- カートから該当商品を削除
- 成功メッセージを返却

---

### ■ 9.17 管理者ログインAPI

#### エンドポイント

`POST /api/admin/auth/login`

#### 機能概要

管理者アカウントによるログイン認証を行い、セッションまたはトークンを発行する。

#### リクエストボディ

```json
{
  "email": "admin@example.com",
  "password": "password123"
}
| パラメータ名   | 型   | 必須 | 説明          |
| -------- | --- | -- | ----------- |
| email    | 文字列 | 必須 | 管理者のメールアドレス |
| password | 文字列 | 必須 | パスワード       |
{
  "token": "admin-jwt-token",
  "admin": {
    "id": 1,
    "email": "admin@example.com",
    "name": "Admin Name"
  }
}
```

**処理概要**

- 入力値のバリデーション
- メールアドレス・パスワード照合（DB確認）
- 成功時にトークンを生成し、管理者情報と共に返却

**備考**

- トークンは今後の管理者向けAPI呼び出しに必要となる

---

### ■ 9.18 管理者ログアウトAPI

#### エンドポイント

`POST /api/admin/auth/logout`

#### 機能概要

現在ログイン中の管理者のセッションまたはトークンを無効化する。

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                       |
| ------------- | ---- | -------------------------- |
| Authorization | 必須 | Bearerトークン（管理者用） |

#### リクエストボディ

なし

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "message": "ログアウトしました。"
}
```

| ステータスコード | 内容                               |
| ---------------- | ---------------------------------- |
| 401 Unauthorized | 認証されていない or 無効なトークン |
| 403 Forbidden    | 管理者権限がないユーザーが実行     |

**処理概要**

- トークンの有効性と管理者権限を確認
- セッションまたはトークンを無効化
- 正常にログアウトできたことをメッセージで返却

**備考**

- 管理者専用のログアウトエンドポイント
- フロント側ではトークンを破棄する処理も必要

---

### ■9.19 商品登録API（管理者用）

#### エンドポイント

`POST /api/admin/products`

#### 機能概要

管理者が新規商品を登録する。

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                       |
| ------------- | ---- | -------------------------- |
| Authorization | 必須 | Bearerトークン（管理者用） |
| Content-Type  | 必須 | application/json           |

#### リクエストボディ

```json
{
  "name": "商品名",
  "description": "商品の説明",
  "price": 1000,
  "categoryId": 1,
}
| パラメータ名      | 型   | 必須 | 説明        |
| ----------- | --- | -- | --------- |
| name        | 文字列 | 必須 | 商品名       |
| description | 文字列 | 任意 | 商品の詳細説明   |
| price       | 数値  | 必須 | 価格（単位は円）  |
| categoryId  | 数値  | 必須 | 所属カテゴリのID |
{
  "id": 123,
  "name": "商品名",
  "description": "商品の説明",
  "price": 1000,
  "categoryId": 1,
  "createdAt": "2025-07-07T10:00:00Z",
  "updatedAt": "2025-07-07T10:00:00Z"
}
```

| ステータスコード | 内容                             |
| ---------------- | -------------------------------- |
| 400 Bad Request  | 入力値が不正（例：必須項目不足） |
| 401 Unauthorized | 認証されていない                 |
| 403 Forbidden    | 管理者権限がない                 |

**処理概要**

- 管理者認証・権限チェック
- 入力データのバリデーション
- DBに新規商品レコードを登録
- 登録完了した商品情報を返却

**備考**

- 画像登録は別API（`POST /api/admin/products/{productId}/images`）で行う

---

### ■ 9.20 商品編集API（管理者用）

#### エンドポイント

`PUT /api/admin/products/{productId}`

#### 機能概要

管理者が指定した商品IDの商品情報を更新する。

#### パスパラメータ

| パラメータ名 | 型   | 必須 | 説明             |
| ------------ | ---- | ---- | ---------------- |
| productId    | 数値 | 必須 | 更新対象の商品ID |

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                       |
| ------------- | ---- | -------------------------- |
| Authorization | 必須 | Bearerトークン（管理者用） |
| Content-Type  | 必須 | application/json           |

#### リクエストボディ

```json
{
  "name": "更新後の商品名",
  "description": "更新後の説明",
  "price": 1200,
  "categoryId": 2,
}
| パラメータ名      | 型   | 必須 | 説明     |
| ----------- | --- | -- | ------ |
| name        | 文字列 | 任意 | 商品名    |
| description | 文字列 | 任意 | 商品説明   |
| price       | 数値  | 任意 | 価格（円）  |
| categoryId  | 数値  | 任意 | カテゴリID |
{
  "id": 123,
  "name": "更新後の商品名",
  "description": "更新後の説明",
  "price": 1200,
  "categoryId": 2,
  "createdAt": "2025-07-07T10:00:00Z",
  "updatedAt": "2025-07-07T12:00:00Z"
}
```

| ステータスコード | 内容                  |
| ---------------- | --------------------- |
| 400 Bad Request  | 入力値が不正          |
| 401 Unauthorized | 認証されていない      |
| 403 Forbidden    | 管理者権限がない      |
| 404 Not Found    | productIdが存在しない |

**処理概要**

- 管理者認証・権限チェック
- productIdの存在確認
- 入力値バリデーション
- DBの該当商品情報を更新
- 更新後の商品情報を返却

**備考**

- 商品画像の変更は別APIで対応（`POST /api/admin/products/{productId}/images`）

---

### ■ 9.21 注文一覧取得API（管理者用）

#### エンドポイント

`GET /api/admin/orders`

#### 機能概要

管理者が全注文の一覧を取得する。

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                       |
| ------------- | ---- | -------------------------- |
| Authorization | 必須 | Bearerトークン（管理者用） |

#### クエリパラメータ（任意）

| パラメータ名 | 型     | 説明                                         |
| ------------ | ------ | -------------------------------------------- |
| page         | 数値   | ページ番号（デフォルト: 1）                  |
| perPage      | 数値   | 1ページあたりの件数（デフォルト: 20）        |
| status       | 文字列 | 注文状態フィルタ（例: "pending", "shipped"） |

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "orders": [
    {
      "orderId": 101,
      "customerId": 10,
      "orderDate": "2025-07-06T14:30:00Z",
      "status": "pending",
      "totalAmount": 5400
    },
    {
      "orderId": 102,
      "customerId": 12,
      "orderDate": "2025-07-06T15:00:00Z",
      "status": "shipped",
      "totalAmount": 3200
    }
  ],
  "nextCursor": 102,
  "hasMore": true
}

```

| ステータスコード | 内容             |
| ---------------- | ---------------- |
| 401 Unauthorized | 認証されていない |
| 403 Forbidden    | 管理者権限がない |

**処理概要**

- 管理者認証・権限チェック
- クエリパラメータの検証・設定
- DBから注文情報を取得（フィルタ適用含む）
- 注文一覧とページ情報を返却

**備考**

- 詳細な注文情報は別API（注文詳細取得API）で取得する。

---

### ■ 9.22 注文詳細取得API（管理者用）

#### エンドポイント

`GET /api/admin/orders/{orderId}`

#### 機能概要

管理者が指定した注文の詳細情報を取得する。

#### パスパラメータ

| パラメータ名 | 型   | 必須 | 説明             |
| ------------ | ---- | ---- | ---------------- |
| orderId      | 数値 | 必須 | 取得対象の注文ID |

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                       |
| ------------- | ---- | -------------------------- |
| Authorization | 必須 | Bearerトークン（管理者用） |

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "orderId": 101,
  "customerId": 10,
  "orderDate": "2025-07-06T14:30:00Z",
  "status": "pending",
  "totalAmount": 5400,
  "shipaddress": {
    "postalCode": "123-4567",
    "address1": "東京都新宿区",
    "address2": "西新宿1-1-1",
    "recipientName": "山田 太郎"
  },
  "products": [
    {
      "productId": 201,
      "productName": "商品A",
      "quantity": 2,
      "unitPrice": 1500,
      "subtotal": 3000
    },
    {
      "productId": 202,
      "productName": "商品B",
      "quantity": 1,
      "unitPrice": 2400,
      "subtotal": 2400
    }
  ],
  "paymentMethod": "代引き"
}
```

| ステータスコード | 内容                        |
| ---------------- | --------------------------- |
| 401 Unauthorized | 認証されていない            |
| 403 Forbidden    | 管理者権限がない            |
| 404 Not Found    | 指定したorderIdが存在しない |

**処理概要**

- 管理者認証・権限チェック
- orderIdの存在確認
- 注文情報・配送先・注文商品の取得
- 詳細情報をレスポンスとして返却

**備考**

- 注文情報の編集は別APIで実施。

---

### ■ 9.23 カート商品追加API

#### エンドポイント

`POST /api/cart/products`

#### 機能概要

ログイン中のユーザーのカートに商品を追加する。

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                         |
| ------------- | ---- | ---------------------------- |
| Authorization | 必須 | Bearerトークン（ユーザー用） |

#### リクエストボディ（JSON）

```json
{
  "productId": 123,
  "quantity": 2,
  "options": {
    "color": "red",
    "size": "M"
  }
}
| 項目名       | 型      | 必須 | 説明                |
| --------- | ------ | -- | ----------------- |
| productId | 数値     | 必須 | 追加する商品のID         |
| quantity  | 数値     | 必須 | 追加数量（1以上）         |
| options   | オブジェクト | 任意 | 商品の選択肢（例：色、サイズなど） |
{
  "cartItemId": 456,
  "productId": 123,
  "quantity": 2,
  "options": {
    "color": "red",
    "size": "M"
  },
  "message": "カートに商品を追加しました。"
}
```

| ステータスコード | 内容                 |
| ---------------- | -------------------- |
| 401 Unauthorized | 認証されていない場合 |
| 403 Forbidden    | 管理者権限がない場合 |

**処理概要**

- 管理者認証・権限チェック
- クエリパラメータ（cursor, limitなど）の検証と初期値設定
- データベースからカーソルベースで注文情報を取得
- 注文情報と次ページ用のnextCursor、hasMoreフラグを返却

**備考**

- クライアント側は nextCursor を次回リクエスト時のパラメータとして送信することで連続取得が可能
- hasMore が false の場合、それ以上のデータは存在しない
- 注文の詳細情報は「注文詳細取得API」で個別に取得
- nextCursor は通常、ソートキー（例：orderId や orderDate）を用いる

---

### ■ 9.24 カート商品更新API

#### エンドポイント

`PUT /api/cart/products/{productId}`

#### 機能概要

カート内の指定商品（itemId）の数量や選択肢（オプション）を更新する。

#### パスパラメータ

| パラメータ名 | 必須 | 内容                   |
| ------------ | ---- | ---------------------- |
| productId    | 必須 | 更新対象のカート商品ID |

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                         |
| ------------- | ---- | ---------------------------- |
| Authorization | 必須 | Bearerトークン（ユーザー用） |

#### リクエストボディ（JSON）

```json
{
  "quantity": 3,
  "options": {
    "color": "blue",
    "size": "L"
  }
}
| 項目名      | 型      | 必須 | 説明          |
| -------- | ------ | -- | ----------- |
| quantity | 数値     | 必須 | 更新後の数量（1以上） |
| options  | オブジェクト | 任意 | 更新後の商品の選択肢  |
{
  "productId": 456,
  "productId": 123,
  "quantity": 3,
  "options": {
    "color": "blue",
    "size": "L"
  },
  "message": "カート商品を更新しました。"
}
```

| ステータスコード | 内容                           |
| ---------------- | ------------------------------ |
| 400 Bad Request  | quantityが不正、パラメータ不足 |
| 401 Unauthorized | 認証されていない               |
| 404 Not Found    | productIdが存在しない          |

**処理概要**

- ユーザー認証
- パスパラメータ・リクエストボディのバリデーション
- 指定productIdがユーザーのカートに存在するか確認
- 更新処理実行
- 更新結果を返却

**備考**

- 数量を0にするとエラーとなる。削除は別APIを利用。

---

### ■ 9.25 カート商品削除API

#### エンドポイント

`DELETE /api/cart/products/{productId}`

#### 機能概要

カート内の指定商品（productId）を削除する。

#### パスパラメータ

| パラメータ名 | 必須 | 内容                   |
| ------------ | ---- | ---------------------- |
| productId    | 必須 | 削除対象のカート商品ID |

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                         |
| ------------- | ---- | ---------------------------- |
| Authorization | 必須 | Bearerトークン（ユーザー用） |

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "productId": 456,
  "message": "カート商品を削除しました。"
}
```

| ステータスコード | 内容                  |
| ---------------- | --------------------- |
| 401 Unauthorized | 認証されていない      |
| 404 Not Found    | productIdが存在しない |

**処理概要**

- ユーザー認証
- productIdの所有権チェック
- カート商品削除処理
- 削除完了メッセージ返却

**備考**

- 削除後のカート状態は別途取得APIで確認可能。

---

### ■ 9.26 管理者ログインAPI

#### エンドポイント

`POST /api/admin/auth/login`

#### 機能概要

管理者ユーザーがメールアドレスとパスワードでログインし、認証トークンを取得する。

#### リクエストボディ（JSON）

```json
{
  "email": "admin@example.com",
  "password": "password123"
}
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "adminId": 1,
  "message": "管理者ログイン成功"
}
```

| ステータスコード | 内容                               |
| ---------------- | ---------------------------------- |
| 400 Bad Request  | リクエストフォーマット不正         |
| 401 Unauthorized | メールアドレスまたはパスワード不正 |

**処理概要**

- リクエストのバリデーション
- 管理者ユーザーの認証（メール・パスワード照合）
- トークン生成（JWTなど）
- レスポンスにトークンと管理者IDを返却

**備考**

- 以降の管理者用API呼び出し時は、Authorizationヘッダーに取得したトークンを付与すること。

---

### ■ 9.27 管理者ログアウトAPI

#### エンドポイント

`POST /api/admin/auth/logout`

#### 機能概要

管理者の認証トークンを無効化し、ログアウト処理を行う。

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                        |
| ------------- | ---- | --------------------------- |
| Authorization | 必須 | Bearer トークン（管理者用） |

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "message": "管理者ログアウト成功"
}
```

| ステータスコード | 内容                           |
| ---------------- | ------------------------------ |
| 401 Unauthorized | トークンが無効または認証エラー |

**処理概要**

- トークンの検証
- トークンの無効化
- 成功メッセージの返却

**備考**

- ログアウト後は管理者用APIを利用できなくなる。

---

### ■ 9.28 商品登録API（管理者用）

#### エンドポイント

`POST /api/admin/products`

#### 機能概要

管理者が新しい商品を登録する。

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                        |
| ------------- | ---- | --------------------------- |
| Authorization | 必須 | Bearer トークン（管理者用） |

#### リクエストボディ（JSON）

```json
{
  "name": "商品名",
  "description": "商品の説明",
  "price": 1000,
  "categoryId": 3,
  "attributes": {
    "color": "赤",
    "size": "M"
  }
}
{
  "productId": 123,
  "message": "商品を登録しました。"
}
　```
| ステータスコード         | 内容     |
| ---------------- | ------ |
| 400 Bad Request  | 入力値エラー |
| 401 Unauthorized | 認証エラー  |

**処理概要**
- 管理者認証チェック

- リクエストボディのバリデーション

- 商品データのDB登録

- 登録成功レスポンス返却

**備考**
- 商品画像は別APIで追加可能。

---

### ■ 9.29 カート商品更新API

#### エンドポイント  
`PUT /api/admin/products/{productId}`

#### 機能概要  
管理者が既存の商品情報を更新する。

#### パスパラメータ

| パラメータ名 | 必須 | 内容               |
|--------------|------|--------------------|
| productId    | 必須 | 更新対象の商品ID   |

---

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                       |
|---------------|------|----------------------------|
| Authorization | 必須 | Bearer トークン（管理者用） |

#### リクエストボディ（JSON）

```json
{
  "name": "更新後の商品名",
  "description": "更新後の説明",
  "price": 1200,
  "categoryId": 5,
  "attributes": {
    "color": "青",
    "size": "L"
  }
}
{
  "message": "商品情報を更新しました。"
}
```

| ステータスコード | 内容                  |
| ---------------- | --------------------- |
| 400 Bad Request  | 入力値エラー          |
| 401 Unauthorized | 認証エラー            |
| 404 Not Found    | productIdが存在しない |

**処理概要**

- 管理者認証チェック
- productId存在確認
- リクエストボディのバリデーション
- 商品情報のDB更新
- 更新成功レスポンス返却

**備考**

- 商品画像は別APIで管理。

---

### ■ 9.29 注文一覧取得API（管理者用）

#### エンドポイント

`GET /api/admin/orders`

#### 機能概要

管理者が全注文の一覧を取得する。

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                        |
| ------------- | ---- | --------------------------- |
| Authorization | 必須 | Bearer トークン（管理者用） |

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "orders": [
    {
      "orderId": 101,
      "customerName": "山田 太郎",
      "orderDate": "2025-07-07T10:00:00Z",
      "status": "pending",
      "totalAmount": 5000
    },
    {
      "orderId": 102,
      "customerName": "鈴木 花子",
      "orderDate": "2025-07-06T14:30:00Z",
      "status": "shipped",
      "totalAmount": 12000
    }
  ],
  "hasMore": true,
  "nextCursor": 102
}
```

| ステータスコード | 内容       |
| ---------------- | ---------- |
| 401 Unauthorized | 認証エラー |

**処理概要**

- 管理者認証チェック
- 無限スクロールおよびフィルタリング処理
- 注文一覧のDB取得
- 取得結果のレスポンス返却

---

### ■ 9.30 注文詳細取得API（管理者用）

#### エンドポイント

`GET /api/admin/orders/{orderId}`

#### 機能概要

管理者が特定の注文詳細情報を取得する。

#### パスパラメータ

| パラメータ名 | 内容             | 必須 |
| ------------ | ---------------- | ---- |
| orderId      | 取得対象の注文ID | 必須 |

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                        |
| ------------- | ---- | --------------------------- |
| Authorization | 必須 | Bearer トークン（管理者用） |

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "orderId": 101,
  "customerId": 501,
  "customerName": "山田 太郎",
  "orderDate": "2025-07-07T10:00:00Z",
  "status": "pending",
  "totalAmount": 5000,
  "products": [
    {
      "productId": 301,
      "productName": "商品A",
      "quantity": 2,
      "price": 2000
    },
    {
      "productId": 302,
      "productName": "商品B",
      "quantity": 1,
      "price": 1000
    }
  ],
  "shipaddress": "東京都新宿区1-2-3",
  "paymentMethod": "代引き"
}
```

| ステータスコード | 内容                    |
| ---------------- | ----------------------- |
| 401 Unauthorized | 認証エラー              |
| 404 Not Found    | 指定orderIdが存在しない |

**処理概要**

- 管理者認証チェック
- orderIdの存在チェック
- 注文情報と注文商品のDB取得
- 取得結果のレスポンス返却

**備考**

- 管理者のみ利用可能。

---

### ■ 9.31 カート商品追加API

#### エンドポイント

`POST /api/cart/products`

#### 機能概要

ログイン中のユーザーのカートに商品を追加する。

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                          |
| ------------- | ---- | ----------------------------- |
| Authorization | 必須 | Bearer トークン（ユーザー用） |

#### リクエストボディ（JSON）

```json
{
  "productId": 123,
  "quantity": 2,
  "attributes": {
    "color": "red",
    "size": "M"
  }
}
| 項目         | 内容        | 必須 | 備考      |
| ---------- | --------- | -- | ------- |
| productId  | 追加する商品のID | 必須 |         |
| quantity   | 数量        | 必須 | 1以上     |
| attributes | 商品の属性（任意） | 任意 | 色やサイズなど |
{
  "productId": 456,
  "productId": 123,
  "quantity": 2,
  "attributes": {
    "color": "red",
    "size": "M"
  },
  "message": "カートに商品を追加しました。"
}
```

**処理概要**

- ユーザー認証チェック
- リクエストボディのバリデーション
- productIdの存在チェック
- カート内に同じ商品（属性含む）があれば数量を加算、なければ新規追加
- 更新後のカート商品情報を返却

**備考**

- ログインユーザー専用API。

---

### ■ 9.32 カート商品更新API

#### エンドポイント

`PUT /api/cart/products/{productId}`

#### 機能概要

カート内の特定商品（productId）の数量や属性を更新する。

#### パスパラメータ

| パラメータ | 内容                     | 必須 |
| ---------- | ------------------------ | ---- |
| productId  | 更新対象のカート内商品ID | 必須 |

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                          |
| ------------- | ---- | ----------------------------- |
| Authorization | 必須 | Bearer トークン（ユーザー用） |

#### リクエストボディ（JSON）

```json
{
  "quantity": 3,
  "attributes": {
    "color": "blue",
    "size": "L"
  }
}
| 項目         | 内容           | 必須 | 備考      |
| ---------- | ------------ | -- | ------- |
| quantity   | 更新後の数量       | 必須 | 1以上     |
| attributes | 更新後の属性情報（任意） | 任意 | 色やサイズなど |
{
  "productId": 456,
  "productId": 123,
  "quantity": 3,
  "attributes": {
    "color": "blue",
    "size": "L"
  },
  "message": "カート商品を更新しました。"
}
```

| ステータスコード | 内容                                    |
| ---------------- | --------------------------------------- |
| 400 Bad Request  | 不正なパラメータ（例：quantityが0以下） |
| 401 Unauthorized | 未ログインまたは認証エラー              |
| 404 Not Found    | productIdが存在しない                   |

**処理概要**

- ユーザー認証チェック
- productIdの存在確認と所有者チェック
- リクエストボディのバリデーション
- カート商品情報を更新
- 更新後のカート商品情報を返却

**備考**

- ログインユーザー専用API。

---

### ■ 9.33 カート商品削除API

#### エンドポイント

`DELETE /api/cart/products/{productId}`

#### 機能概要

カート内の特定商品（productId）を削除する。

#### パスパラメータ

| パラメータ | 内容                     | 必須 |
| ---------- | ------------------------ | ---- |
| productId  | 削除対象のカート内商品ID | 必須 |

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                          |
| ------------- | ---- | ----------------------------- |
| Authorization | 必須 | Bearer トークン（ユーザー用） |

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "message": "カート商品を削除しました。"
}
```

| ステータスコード | 内容                       |
| ---------------- | -------------------------- |
| 401 Unauthorized | 未ログインまたは認証エラー |
| 404 Not Found    | productIdが存在しない      |

**処理概要**

- ユーザー認証チェック
- productIdの存在確認
- カート内商品削除処理
- 削除完了メッセージ返却

**備考**

- ログインユーザー専用API

---

### ■ 9.34 管理者ログインAPI

#### エンドポイント

`POST /api/admin/auth/login`

#### 機能概要

管理者がメールアドレスとパスワードでログインし、管理用トークンを取得する。

#### リクエストボディ（JSON）

```json
{
  "email": "admin@example.com",
  "password": "password123"
}
| 項目       | 内容          | 必須 |
| -------- | ----------- | -- |
| email    | 管理者のメールアドレス | 必須 |
| password | パスワード       | 必須 |
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "message": "管理者ログイン成功"
}
```

| ステータスコード | 内容                       |
| ---------------- | -------------------------- |
| 401 Unauthorized | 認証情報が間違っている場合 |
| 400 Bad Request  | リクエスト不正             |

**処理概要**

- 入力された認証情報のバリデーション
- 管理者アカウントの存在・パスワード検証
- 認証トークン発行
- トークンをレスポンスに返却

**備考**

- 管理者専用API。
- 発行トークンは管理者操作時の認証に利用。

---

### ■ 9.35 管理者ログアウトAPI

#### エンドポイント

`POST /api/admin/auth/logout`

#### 機能概要

管理者のセッションまたはトークンを無効化し、ログアウト処理を行う。

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                        |
| ------------- | ---- | --------------------------- |
| Authorization | 必須 | Bearer トークン（管理者用） |

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "message": "管理者ログアウト成功"
}
```

| ステータスコード | 内容                       |
| ---------------- | -------------------------- |
| 401 Unauthorized | トークンが無効または未認証 |

**処理概要**

- トークンの有効性チェック
- トークンの無効化処理
- ログアウト成功メッセージ返却

**備考**

- 管理者専用API。
- セッションやトークンの種類により無効化方法は異なる場合あり。

---

### ■ 9.36 商品登録API（管理者用）

#### エンドポイント

`POST /api/admin/products`

#### 機能概要

管理者が新しい商品を登録する。

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                        |
| ------------- | ---- | --------------------------- |
| Authorization | 必須 | Bearer トークン（管理者用） |
| Content-Type  | 必須 | application/json            |

#### リクエストボディ例

```json
{
  "name": "商品名",
  "description": "商品の説明",
  "price": 1000,
  "categoryId": 1,
  "attributes": {
    "color": "赤",
    "size": "M"
  }
}
{
  "productId": 123,
  "message": "商品を登録しました。"
}
```

| ステータスコード | 内容                         |
| ---------------- | ---------------------------- |
| 400 Bad Request  | 入力不正（必須項目不足など） |
| 401 Unauthorized | 認証エラー（管理者でない等） |

**処理概要**

- 管理者認証チェック
- リクエストデータバリデーション
- 商品情報のDB登録
- 登録成功レスポンス返却

**備考**

- 商品画像は別APIで追加する。

---

### ■ 9.37 商品編集API（管理者用）

#### エンドポイント

`PUT /api/admin/products/{productId}`

#### 機能概要

管理者が既存の商品情報を更新する。

#### パスパラメータ

| パラメータ名 | 必須 | 内容             |
| ------------ | ---- | ---------------- |
| productId    | 必須 | 更新対象の商品ID |

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                        |
| ------------- | ---- | --------------------------- |
| Authorization | 必須 | Bearer トークン（管理者用） |
| Content-Type  | 必須 | application/json            |

#### リクエストボディ例

```json
{
  "name": "更新後の商品名",
  "description": "更新後の説明",
  "price": 1500,
  "categoryId": 2,
  "attributes": {
    "color": "青",
    "size": "L"
  }
}
{
  "message": "商品情報を更新しました。"
}
```

| ステータスコード | 内容                  |
| ---------------- | --------------------- |
| 400 Bad Request  | 入力不正              |
| 401 Unauthorized | 認証エラー            |
| 404 Not Found    | productIdが存在しない |

**処理概要**

- 管理者認証チェック
- productId存在チェック
- リクエストデータバリデーション
- 商品情報更新処理
- 更新成功レスポンス返却

**備考**

- 商品画像は別APIで管理する。

---

### ■ 9.38 注文一覧取得API（管理者用）

#### エンドポイント

`GET /api/admin/orders`

#### 機能概要

管理者が全注文の一覧を取得する。

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                        |
| ------------- | ---- | --------------------------- |
| Authorization | 必須 | Bearer トークン（管理者用） |

```json
{
  "orders": [
    {
      "orderId": 123,
      "customerId": 456,
      "orderDate": "2025-07-01T12:34:56Z",
      "status": "pending",
      "totalAmount": 5000
    },
    {
      "orderId": 124,
      "customerId": 789,
      "orderDate": "2025-07-02T10:20:30Z",
      "status": "shipped",
      "totalAmount": 3000
    }
  ],
  "hasMore": true,
  "nextCursor": 124
}
```

| ステータスコード | 内容       |
| ---------------- | ---------- |
| 401 Unauthorized | 認証エラー |

**処理概要**

- 管理者認証チェック
- クエリパラメータのバリデーション（例：cursorやlimit）
- 注文データの取得・無限スクロール用カーソル処理
- レスポンス返却

---

### ■ 9.39 注文詳細取得API（管理者用）

#### エンドポイント

`GET /api/admin/orders/{orderId}`

#### 機能概要

管理者が特定の注文詳細を取得する。

#### パスパラメータ

| パラメータ名 | 必須 | 内容             |
| ------------ | ---- | ---------------- |
| orderId      | 必須 | 取得対象の注文ID |

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                        |
| ------------- | ---- | --------------------------- |
| Authorization | 必須 | Bearer トークン（管理者用） |

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "orderId": 123,
  "customerId": 456,
  "orderDate": "2025-07-01T12:34:56Z",
  "status": "pending",
  "totalAmount": 5000,
  "products": [
    {
      "productId": 789,
      "productName": "商品A",
      "quantity": 2,
      "unitPrice": 2000
    },
    {
      "productId": 101,
      "productName": "商品B",
      "quantity": 1,
      "unitPrice": 1000
    }
  ],
  "shipaddress": {
    "name": "山田 太郎",
    "postalCode": "123-4567",
    "addressLine1": "東京都新宿区西新宿1-1-1",
    "addressLine2": "マンション101"
  }
}
```

| ステータスコード | 内容                |
| ---------------- | ------------------- |
| 401 Unauthorized | 認証エラー          |
| 404 Not Found    | orderIdが存在しない |

**処理概要**

- 管理者認証チェック
- orderId存在チェック
- 注文詳細データ取得
- レスポンス返却

**備考**

- 注文の各商品の詳細を含む。

---

### ■ 9.40 カート商品追加API

#### エンドポイント

`POST /api/cart/products`

#### 機能概要

ログイン中のユーザーのカートに商品を追加する。

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                          |
| ------------- | ---- | ----------------------------- |
| Authorization | 必須 | Bearer トークン（ユーザー用） |

#### リクエストボディ（JSON）

| フィールド名 | 型     | 必須 | 内容                               |
| ------------ | ------ | ---- | ---------------------------------- |
| productId    | int    | 必須 | 追加する商品のID                   |
| quantity     | int    | 必須 | 追加する数量（1以上）              |
| options      | object | 任意 | 商品のオプション（例: 色、サイズ） |

#### 成功レスポンス（HTTP 201 Created）

```json
{
  "productId": 987,
  "productId": 123,
  "quantity": 2,
  "options": {
    "color": "red",
    "size": "M"
  },
  "message": "カートに商品を追加しました。"
}
```

| ステータスコード | 内容                                |
| ---------------- | ----------------------------------- |
| 400 Bad Request  | quantityが1未満など不正なパラメータ |
| 401 Unauthorized | 認証エラー                          |
| 404 Not Found    | productIdが存在しない               |

**処理概要**

- ユーザー認証チェック
- productIdの存在確認
- quantityのバリデーション
- カート内に同一商品・同一オプションがあれば数量を加算、なければ新規追加
- レスポンス返却

---

### ■ 9.41 カート商品更新API

#### エンドポイント

`PUT /api/cart/products/{productId}`

#### 機能概要

カート内の特定商品アイテムの数量や属性を更新する。

#### パスパラメータ

| パラメータ名 | 型  | 必須 | 内容                     |
| ------------ | --- | ---- | ------------------------ |
| productId    | int | 必須 | 更新対象のカート内商品ID |

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                          |
| ------------- | ---- | ----------------------------- |
| Authorization | 必須 | Bearer トークン（ユーザー用） |

#### リクエストボディ（JSON）

| フィールド名 | 型     | 必須 | 内容                         |
| ------------ | ------ | ---- | ---------------------------- |
| quantity     | int    | 必須 | 更新後の数量（1以上）        |
| options      | object | 任意 | 更新後の商品のオプション情報 |

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "productId": 987,
  "quantity": 3,
  "options": {
    "color": "blue",
    "size": "L"
  },
  "message": "カート内の商品を更新しました。"
}
```

| ステータスコード | 内容                                   |
| ---------------- | -------------------------------------- |
| 400 Bad Request  | quantityが不正、またはパラメータエラー |
| 401 Unauthorized | 認証エラー                             |
| 404 Not Found    | itemIdがカートに存在しない             |

**処理概要**

- ユーザー認証チェック
- productIdがユーザーのカート内に存在するか確認
- quantityのバリデーション
- カート商品の数量・オプション更新
- レスポンス返却

**備考**

- 数量を0にする場合は削除APIを利用すること。

---

### ■ 9.42 カート商品削除API

#### エンドポイント

`DELETE /api/cart/products/{productId}`

#### 機能概要

カート内の特定商品アイテムを削除する。

#### パスパラメータ

| パラメータ名 | 型  | 必須 | 内容                     |
| ------------ | --- | ---- | ------------------------ |
| productId    | int | 必須 | 削除対象のカート内商品ID |

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                          |
| ------------- | ---- | ----------------------------- |
| Authorization | 必須 | Bearer トークン（ユーザー用） |

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "message": "カート内の商品を削除しました。"
}
```

| ステータスコード | 内容                          |
| ---------------- | ----------------------------- |
| 401 Unauthorized | 認証エラー                    |
| 404 Not Found    | productIdがカートに存在しない |
| ステータスコード | 内容                          |
| ---------------- | ----------------              |
| 401 Unauthorized | 認証エラー                    |
| 404 Not Found    | productIdがカートに存在しない |

**処理概要**

- ユーザー認証チェック
- productIdがユーザーのカート内に存在するか確認
- カート商品削除処理実行
- レスポンス返却

**備考**

- 管理者用APIではなく、ユーザーのカート操作専用。

---

### ■ 9.43 管理者ログインAPI

#### エンドポイント

`POST /api/admin/auth/login`

#### 機能概要

管理者用のログイン処理。管理者IDとパスワードで認証を行い、認証トークンを発行する。

#### リクエストボディ

| パラメータ名 | 型     | 必須 | 内容       |
| ------------ | ------ | ---- | ---------- |
| adminId      | string | 必須 | 管理者ID   |
| password     | string | 必須 | パスワード |

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "expires_in": 3600
}
```

| ステータスコード | 内容     |
| ---------------- | -------- |
| 401 Unauthorized | 認証失敗 |

**処理概要**

- 管理者ID・パスワードの照合
- 認証成功時、JWT等の認証トークンを発行
- トークンと有効期限をレスポンスで返却

**備考**

- 認証トークンは以降の管理者用API呼び出し時にAuthorizationヘッダーで使用。

---

### ■ 9.44 管理者ログアウトAPI

#### エンドポイント

`POST /api/admin/auth/logout`

#### 機能概要

管理者のログアウト処理。発行済みの認証トークンを無効化する。

#### リクエストヘッダー

| ヘッダー名    | 必須 | 内容                        |
| ------------- | ---- | --------------------------- |
| Authorization | 必須 | Bearer トークン（管理者用） |

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "message": "管理者をログアウトしました。"
}
```

| ステータスコード | 内容       |
| ---------------- | ---------- |
| 401 Unauthorized | 認証エラー |

**処理概要**

- 認証トークンの有効性確認
- トークン無効化処理
- ログアウト完了レスポンス返却

**備考**

- トークン無効化はトークンのブラックリスト登録やセッション削除で対応。

---

### ■ 9.45 商品登録API（管理者用）

#### エンドポイント

`POST /api/admin/products`

#### 機能概要

新しい商品を管理者が登録する。

#### リクエストボディ

| パラメータ名 | 型      | 必須 | 内容                   |
| ------------ | ------- | ---- | ---------------------- |
| name         | string  | 必須 | 商品名                 |
| description  | string  | 任意 | 商品説明               |
| price        | decimal | 必須 | 価格（整数、単位は円） |
| categoryId   | int     | 必須 | カテゴリID             |

#### 成功レスポンス（HTTP 201 Created）

```json
{
  "productId": 123,
  "message": "商品を登録しました。"
}
```

| ステータスコード | 内容                     |
| ---------------- | ------------------------ |
| 400 Bad Request  | リクエストパラメータ不正 |
| 401 Unauthorized | 認証失敗                 |

**処理概要**

- 管理者認証チェック
- リクエストパラメータ検証
- 商品情報をDBに登録
- 登録成功レスポンスを返却

**備考**

- 商品画像は別APIで追加可能。

---

### ■ 9.46 商品編集API（管理者用）

#### エンドポイント

`PUT /api/admin/products/{productId}`

#### 機能概要

既存の商品情報を更新する（管理者専用）。

#### パスパラメータ

| パラメータ名 | 型  | 必須 | 内容             |
| ------------ | --- | ---- | ---------------- |
| productId    | int | 必須 | 更新対象の商品ID |

#### リクエストボディ

| パラメータ名 | 型      | 必須 | 内容                   |
| ------------ | ------- | ---- | ---------------------- |
| name         | string  | 任意 | 商品名                 |
| description  | string  | 任意 | 商品説明               |
| price        | decimal | 任意 | 価格（整数、単位は円） |
| categoryId   | int     | 任意 | カテゴリID             |

---

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "message": "商品情報を更新しました。"
}
```

| ステータスコード | 内容                          |
| ---------------- | ----------------------------- |
| 400 Bad Request  | リクエストパラメータ不正      |
| 401 Unauthorized | 認証失敗                      |
| 404 Not Found    | 指定したproductIdが存在しない |

**処理概要**

- 管理者認証チェック
- productIdの存在確認
- リクエストボディのバリデーション
- DBの更新処理
- 更新成功レスポンス返却

**備考**

- 部分更新可能。
- 商品画像更新は別APIで対応。

---

### ■ 9. 47 注文一覧取得API（管理者用）

#### エンドポイント

`GET /api/admin/orders`

#### 機能概要

全注文の一覧を取得する（管理者専用）。

#### クエリパラメータ（任意）

| パラメータ名 | 型     | 必須 | 内容                                                  |
| ------------ | ------ | ---- | ----------------------------------------------------- |
| status       | string | 任意 | 注文状態で絞り込み（例: pending, shipped, completed） |

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "orders": [
    {
      "orderId": 123,
      "customerId": 456,
      "orderDate": "2025-07-01T12:34:56Z",
      "status": "pending",
      "totalAmount": 12345
    },
    {
      "orderId": 124,
      "customerId": 457,
      "orderDate": "2025-07-02T08:10:11Z",
      "status": "shipped",
      "totalAmount": 67890
    }
  ],
}
```

| ステータスコード | 内容           |
| ---------------- | -------------- |
| 401 Unauthorized | 認証失敗       |
| 403 Forbidden    | 管理者権限なし |

**処理概要**

- 管理者認証チェック
- クエリパラメータのバリデーション
- DBから注文一覧取得
- 注文リストをレスポンス返却

---

### ■ 9.48 注文詳細取得API（管理者用）

#### エンドポイント

`GET /api/admin/orders/{orderId}`

#### 機能概要

指定した注文IDの詳細情報を取得する（管理者専用）。

#### パスパラメータ

| パラメータ名 | 型  | 必須 | 内容             |
| ------------ | --- | ---- | ---------------- |
| orderId      | int | 必須 | 取得対象の注文ID |

#### 成功レスポンス（HTTP 200 OK）

```json
{
  "orderId": 123,
  "customerId": 456,
  "orderDate": "2025-07-01T12:34:56Z",
  "status": "pending",
  "totalAmount": 12345,
  "shipaddress": {
    "postalCode": "123-4567",
    "address": "東京都新宿区1-2-3",
    "recipientName": "山田 太郎"
  },
  "products": [
    {
      "productId": 789,
      "productName": "商品A",
      "quantity": 2,
      "unitPrice": 5000,
      "subtotal": 10000
    },
    {
      "productId": 790,
      "productName": "商品B",
      "quantity": 1,
      "unitPrice": 2345,
      "subtotal": 2345
    }
  ],
  "paymentMethod": "代引き"
}
```

| ステータスコード | 内容                    |
| ---------------- | ----------------------- |
| 401 Unauthorized | 認証失敗                |
| 403 Forbidden    | 管理者権限なし          |
| 404 Not Found    | 指定orderIdが存在しない |

**処理概要**

- 管理者認証チェック
- orderIdの存在確認
- 注文詳細情報をDBから取得
- レスポンス返却

**備考**

- 管理者のみ利用可能。

## 10.インフラ・非機能要件詳細設計書

---

### 10.1. 開発環境・実行環境仕様

| 項目                   | 詳細                  |
| ---------------------- | --------------------- |
| OS                     | Ubuntu 22.04 LTS      |
| Javaバージョン         | OpenJDK 17            |
| フレームワーク         | Spring Boot 3.0       |
| Webサーバ              | Nginx 1.24            |
| アプリケーションサーバ | Spring Boot内蔵サーバ |
| DB                     | MySQL 8.0             |
| DB接続ドライバ         | MySQL Connector/J 8.x |
| メッセージキュー       | RabbitMQ 3.11         |
| キャッシュ             | Redis 7.0             |

---

### 10.2. セキュリティ設計

#### 10.2.1 認証・認可

- Spring Security を利用しセッション管理（Cookieベース）による認証を実装
- トークンはセッションIDとして管理、セッション有効期限は30分（基本設計書に合わせる）
- 管理者APIはロールベースのアクセス制御（RBAC）で制限
- HTTPS通信必須（証明書はLet’s Encryptを使用）
- パスワードはbcryptでハッシュ化保存

#### 10.2.2 入力値検証

- フロントエンド・サーバーサイド両方でバリデーション実施
- SQLインジェクション対策としてプリペアドステートメント利用
- クロスサイトスクリプティング（XSS）対策としてHTMLエスケープを徹底
- クロスサイトリクエストフォージェリ（CSRF）対策として、トークン方式を導入（特に管理画面で強化）

#### 10.2.3 ログ管理

- ログフォーマットはJSON形式で統一
- アクセスログ、エラーログ、監査ログを分離管理
- ログレベルはINFOを基本とし、必要に応じてDEBUG切り替え可能
- ログはファイル保存を基本とし、必要に応じてFluentd等のログ転送基盤を検討

---

### 10.3. 性能・可用性設計

#### 10.3.1 性能要件

- APIレスポンスタイムは**通常画面の画面遷移・表示で3秒以内**を目標
- 同時接続数はピーク時で**最大100ユーザー**を想定

#### 10.3.2 負荷対策

- DBに対してはクエリ最適化とインデックス設計を徹底
- Redisキャッシュを導入し、商品一覧やカテゴリ情報の読み取り負荷を軽減
- 初期構成は単一構成、将来的な水平スケーリングを検討

#### 10.3.3 可用性

- 主要コンポーネントは基本的に単一構成。将来的に冗長構成を検討
- アプリケーションサーバは単一台構成を想定（ロードバランシングは将来的検討）
- 障害検知はZabbixやNagiosで監視し、アラートをメール・Slackに通知

---

### 10.4. 監視・運用設計

#### 10.4.1 監視項目

| 項目                     | 監視内容          | アラート条件                      |
| ------------------------ | ----------------- | --------------------------------- |
| サーバCPU負荷            | CPU使用率         | 80%以上が5分以上継続              |
| メモリ使用率             | メモリ使用率      | 80%以上が5分以上継続              |
| ディスク容量             | 空き容量          | 10%未満                           |
| DB接続数                 | 現在の接続数      | 80%以上の閾値超過                 |
| アプリケーションエラー数 | 5xxエラーの発生数 | 5分間で10件以上                   |
| レスポンスタイム         | API平均応答時間   | 3秒超（通常画面の目標値に合わせ） |

#### 10.4.2 ログ監査

- 重要操作（会員情報更新、注文処理等）は監査ログに記録
- 監査ログは暗号化して保管、アクセス権限を限定

---

### 10.5. バックアップ・リストア

#### 10.5.1 バックアップ方針

- DBは毎日深夜にフルバックアップを自動実行
- 増分バックアップは週次・月次で実施（基本設計書の運用基準に準拠）
- バックアップデータは別リージョンの安全なストレージに保管

#### 10.5.2 リストア手順概要

- バックアップデータからのリストアは72時間以内を目標（基本設計書ベース）
- リストア手順書を整備し定期的にリストア演習を実施
