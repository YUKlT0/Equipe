## 4. クラス設計


4.1　主要パッケージ構成
ソースコードの整理と見通しを良くするため、以下のようなパッケージ構成を基本とします。ルートパッケージは`com.simplezakka`とします。

com.example.simplezakka
├── SimpleZakkaOnlineApplication.java  ← Spring Boot起動クラス (@SpringBootApplication)
│
├── controller                         ← プレゼンテーション層 (@RestController)
│   ├── ProductController.java         → ProductService.java
│   ├── CartController.java            → CartService.java
│   └── OrderController.java           → OrderService.java, CartService.java
│
├── service                            ← ビジネスロジック層 (@Service)
│   ├── ProductService.java            → ProductRepository.java
│   ├── CartService.java               → ProductRepository.java, HttpSession
│   └── OrderService.java              → OrderRepository.java, OrderDetailRepository.java, ProductRepository.java
│
├── repository                         ← 永続化層 (@Repository / Spring Data JPA)
│   ├── ProductRepository.java         → Product.java
│   ├── OrderRepository.java           → Order.java
│   └── OrderDetailRepository.java     → OrderDetail.java
│
├── entity                             ← ドメインモデル (@Entity / JPA)
│   ├── Product.java
│   ├── Order.java
│   └── OrderDetail.java
│
├── dto                                ← データ転送オブジェクト（API入出力）
│   ├── product
│   │   ├── ProductListItem.java       ← 商品一覧レスポンス用
│   │   └── ProductDetail.java         ← 商品詳細レスポンス用
│   ├── cart
│   │   ├── Cart.java                  ← カート全体 (セッション格納用)
│   │   ├── CartItem.java              ← カート内アイテム
│   │   ├── CartItemInfo.java          ← カート追加用（リクエストDTO）
│   │   └── CartItemQuantityDto.java   ← 数量変更用（リクエストDTO）
│   └── order
│       ├── OrderRequest.java          ← 注文確定API用
│       ├── CustomerInfo.java          ← 非会員用注文者情報
│       └── OrderResponse.java         ← 注文成功時のレスポンスDTO
│
├── exception
│   └── GlobalExceptionHandler.java    ← @ControllerAdvice による例外共通処理
│
└── config
    └── DataLoader.java                ← 初期データ投入用（CommandLineRunner）



4.2 クラス設計（これはボツ）
<div class=mermaid>
classDiagram

%% ==== Entity ====
class Product {

- String id
- String name
- String description
- BigDecimal price
- String categoryId
  }

class Category {

- String id
- String name
  }

class ProductImage {

- String id
- String productId
- String imageUrl
- int displayOrder
  }

class Customer {

- String id
- String name
- String email
- String hashedPassword
- String address
- boolean isMember
  }

class Order {

- String id
- String customerId
- LocalDateTime orderDate
- BigDecimal totalAmount
- String status
  }

class OrderDetail {

- String id
- String orderId
- String productId
- int quantity
- BigDecimal unitPrice
  }

%% ==== Repository ====
class ProductRepository
class CustomerRepository
class OrderRepository
class OrderDetailRepository

%% ==== Service ====
class ProductService {

+ List `<ProductListItemDto>` getAllProducts()
+ ProductDetailDto getProductDetail(String productId)
  }

class OrderService {

+ String createOrder(OrderRequestDto dto)
+ List `<OrderSummaryDto>` getCustomerOrders(String customerId)
  }

class CustomerService {

+ void register(CustomerRegistrationDto dto)
+ CustomerDto authenticate(String email, String password)
  }

%% ==== Controller ====
class ProductController {

+ getAllProducts(): List `<ProductListItemDto>`
+ getProductDetail(String id): ProductDetailDto
  }

class OrderController {

+ placeOrder(OrderRequestDto): String
+ getMyOrders(): List `<OrderSummaryDto>`
  }

class AuthController {

+ register()
+ login()
+ logout()
  }

%% ==== DTO ====
class ProductListItemDto {

- String id
- String name
- BigDecimal price
- String thumbnailUrl
  }

class ProductDetailDto {

- String id
- String name
- String description
- BigDecimal price
- List `<String>` imageUrls
  }

class OrderRequestDto {

- String customerId
- List `<OrderItemDto>` items
- String address
- String paymentMethod
  }

class OrderItemDto {

- String productId
- int quantity
  }

class OrderSummaryDto {

- String orderId
- LocalDateTime date
- BigDecimal total
- String status
  }

class CustomerRegistrationDto
class CustomerDto

%% ==== Relationships ====
Product --> Category : belongsTo
Product --> ProductImage : has*
Order --> OrderDetail : has*
OrderDetail --> Product : refers
Order --> Customer : belongsTo
ProductController --> ProductService
OrderController --> OrderService
AuthController --> CustomerService
ProductService --> ProductRepository
OrderService --> OrderRepository
OrderService --> OrderDetailRepository
CustomerService --> CustomerRepository

</div>
