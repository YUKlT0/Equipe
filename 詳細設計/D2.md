API一覧表
機能カテゴリ	機能	メソッド	エンドポイント	概要
1. 会員関連	会員登録	POST	/api/customers/register	新規会員の登録
 	ログイン	POST	/api/auth/login	メールアドレス＋パスワードでログイン
 	ログアウト	POST	/api/auth/logout	セッションまたはトークンの無効化
 	会員情報取得（マイページ）	GET	/api/customers/me	ログイン中の会員情報取得
 	会員情報更新	PUT	/api/customers/me	氏名・住所などの情報を更新
2. 商品関連	商品一覧取得	GET	/api/products	商品の一覧を取得
 	商品詳細取得	GET	/api/products/{productId}	商品の詳細を取得
 	商品画像追加	POST	/api/admin/products/{productId}/images	商品画像を追加
3. カテゴリ関連	カテゴリ一覧	GET	/api/categories	カテゴリリストを取得
 	カテゴリ新規登録	POST	/api/admin/categories	新規カテゴリの登録
 	カテゴリ更新	PUT	/api/admin/categories/{categoryId}	カテゴリ情報更新
 	カテゴリ削除	DELETE	/api/admin/categories/{categoryId}	カテゴリ削除
4. 注文関連（ユーザー側）	注文登録	POST	/api/orders	商品購入処理（注文確定）
5. カート関連（サーバー保持）	カート内容取得	GET	/api/cart	カートの中身を取得
 	カート商品追加	POST	/api/cart/items	カートに商品を追加
 	カート商品更新	PUT	/api/cart/items/{itemId}	カート内商品の数量や属性を更新
 	カート商品削除	DELETE	/api/cart/items/{itemId}	カート内の商品を削除
6. 管理者関連	管理者ログイン	POST	/api/admin/auth/login	管理者用ログイン
 	管理者ログアウト	POST	/api/admin/auth/logout	管理者用ログアウト
 	商品登録	POST	/api/admin/products	商品を新規登録
 	商品編集	PUT	/api/admin/products/{productId}	商品情報を更新
 	注文一覧取得	GET	/api/admin/orders	全注文の一覧を取得
 	注文詳細取得	GET	/api/admin/orders/{orderId}	注文の詳細を取得


<<<<<<< HEAD
■ API名称：会員登録API
=======
<div class = "mermaid">
>>>>>>> 396fbddaa0bac62dc20b322db341d9472e1500ad

■ エンドポイント
POST /api/customers/register

■ 機能概要
新規の会員情報を登録するAPI。
バリデーションを通過したユーザー情報をDBに保存し、会員アカウントを作成する。

■ リクエストパラメータ（JSON形式）
{
  "user_id":              string  // 必須、半角英数字8〜20文字、重複不可
  "user_name":            string  // 必須、全角ひらがな・カタカナ・漢字、50文字以内
  "user_email":           string  // 必須、メール形式、重複不可、最大100文字
  "user_password":        string  // 必須、半角英数記号、8〜20文字、英大小数字混在必須
  "user_password_conf":   string  // 必須、上記と一致していること（サーバーでは使用しない）
  "user_address":         string  // 必須、全角・半角、200文字以内
}

■ バリデーションルール
- user_id：8〜20文字、半角英数字、既存IDと重複不可
- user_name：必須、全角文字（漢字・ひらがな・カタカナ）および英数字可
- user_email：必須、メールアドレス形式、既存メールと重複不可
- user_password：8〜20文字、英大文字・小文字・数字・記号を含む
- user_password_conf：user_passwordと一致すること
- user_address：必須、200文字以内

■ 成功レスポンス（HTTP 201 Created）
{
  "message": "登録が完了しました。",
  "customer_id": "abc123def456"
}

■ 失敗レスポンス例（HTTP 400 Bad Request）
{
  "errors": {
    "user_id": "すでに使用されています。",
    "user_email": "メールアドレスの形式が正しくありません。",
    "user_password": "パスワード形式が正しくありません。"
  }
}

■ 備考
- パスワードはサーバー側でハッシュ化（例：bcrypt）して保存。
- user_password_conf はフロントエンド側で一致チェックのみに使用。
- 登録完了後、確認メール送信処理（別途設計）を想定。
  

■ API名称：ログインAPI

■ エンドポイント
POST /api/auth/login

■ 機能概要
ユーザーがメールアドレスとパスワードを使用してログインするAPI。
認証成功時にセッション開始またはトークンを返却する。

■ リクエストパラメータ（JSON形式）
{
  "user_email":    string  // 必須、登録済みメールアドレス
  "user_password": string  // 必須、登録済みユーザーの正しいパスワード
}

■ バリデーションルール
- user_email：必須、メールアドレス形式
- user_password：必須、8〜20文字、登録済みのハッシュと一致すること

■ 成功レスポンス（HTTP 200 OK）
{
  "message": "ログイン成功",
  "token": "xxxxx.yyyyy.zzzzz",         // トークン認証方式の場合（JWTなど）
  "customer": {
    "user_id": "user1234",
    "user_name": "山田太郎",
    "user_email": "yamada@example.com"
  }
}

■ 失敗レスポンス例（HTTP 401 Unauthorized）
{
  "message": "メールアドレスまたはパスワードが正しくありません。"
}


■ API名称：ログアウトAPI

■ エンドポイント
POST /api/auth/logout

■ 機能概要
現在のログインセッションまたは認証トークンを無効化し、ログアウト状態にする。

■ リクエストパラメータ
なし  
※ただし、認証トークンまたはセッションクッキーをヘッダーで送信する必要がある。

■ ヘッダー例（トークン認証の場合）
Authorization: Bearer <token>

■ 成功レスポンス（HTTP 200 OK）
{
  "message": "ログアウトしました。"
}

■ 失敗レスポンス例（HTTP 401 Unauthorized）
{
  "message": "認証されていません。"
}

■ 処理概要
- JWT方式の場合：クライアント側でトークン破棄（サーバー側に状態を持たない）
- セッション方式の場合：サーバー側でセッションを破棄（invalidate）
- トークンブラックリスト方式を採用する場合は、トークンを無効リストに保存する

■ 備考
- クライアントはログアウト後にトークンやセッションクッキーを削除する必要がある。
- フロントエンド側はこのAPIのレスポンスを受けてログイン状態を解除。


■ API名称：会員情報取得API（マイページ用）

■ エンドポイント
GET /api/customers/me

■ 機能概要
ログイン中の会員自身の情報を取得する。マイページ表示などに使用。

■ リクエストパラメータ
なし  
※ただし、認証情報（セッションまたはJWT）をヘッダーで送信すること。

■ ヘッダー例（JWTトークンを用いる場合）
Authorization: Bearer <token>

■ 成功レスポンス（HTTP 200 OK）
{
  "user_id": "abc12345",
  "user_name": "山田 太郎",
  "user_email": "taro@example.com",
  "user_address": "東京都港区南青山1-1-1",
  "member_since": "2024-06-01"
}

■ 失敗レスポンス例（HTTP 401 Unauthorized）
{
  "message": "認証されていません。"
}

■ 処理概要
- トークンまたはセッションから現在のユーザーを特定
- 該当するユーザーの情報（会員ID、氏名、メールアドレス、住所、登録日時など）を取得して返却

■ 備考
- 会員情報編集画面やマイページ初期表示時に利用
- パスワードなどの機密情報はレスポンスに含めない


■ API名称：会員情報更新API

■ エンドポイント
PUT /api/customers/me

■ 機能概要
ログイン中の会員が、自身の情報（氏名・住所など）を更新する。

■ リクエストパラメータ（JSON形式のBody）
{
  "user_name": "山田 太郎",
  "user_address": "東京都港区南青山1-1-1"
}

■ 必須項目
- user_name：氏名（文字列、最大100文字）
- user_address：住所（文字列、最大255文字）

■ ヘッダー例（JWTトークンを用いる場合）
Authorization: Bearer <token>
Content-Type: application/json

■ 成功レスポンス（HTTP 200 OK）
{
  "message": "会員情報を更新しました。"
}

■ バリデーションエラー（HTTP 400 Bad Request）
{
  "errors": {
    "user_name": "氏名は必須です。",
    "user_address": "住所は255文字以内で入力してください。"
  }
}

■ 認証エラー（HTTP 401 Unauthorized）
{
  "message": "認証されていません。"
}

■ 処理概要
- 認証済みのユーザーを識別
- 入力値のバリデーションを実施
- 会員テーブルの対象レコードを更新
- 成功メッセージを返却

■ 備考
- メールアドレスやパスワードの更新は別APIで対応（セキュリティ上の理由）
- 更新不可のフィールド（例：会員ID、登録日時など）は受け付けない


■ API名称：商品一覧取得API

■ エンドポイント
GET /api/products

■ 機能概要
商品の一覧を取得する。ページネーション対応あり。

■ リクエストパラメータ（クエリパラメータ）
- page: ページ番号（整数、デフォルト1）
- per_page: 1ページあたりの表示件数（整数、デフォルト10、最大100）
- category_id: カテゴリIDで絞り込み（任意）
- keyword: 商品名や説明のキーワード検索（任意）

例）/api/products?page=2&per_page=10&category_id=5&keyword=スマホ

■ 成功レスポンス（HTTP 200 OK）
{
  "page": 2,
  "per_page": 10,
  "total": 53,
  "products": [
    {
      "product_id": 101,
      "product_name": "スマートフォン X",
      "price": 59800,
      "thumbnail_url": "https://example.com/images/101-thumb.jpg",
      "category_id": 5,
      "stock": 25
    },
    {
      "product_id": 102,
      "product_name": "スマートフォン Y",
      "price": 49800,
      "thumbnail_url": "https://example.com/images/102-thumb.jpg",
      "category_id": 5,
      "stock": 10
    }
    // 以下略
  ]
}
<<<<<<< HEAD

■ 失敗レスポンス例（HTTP 400 Bad Request）
{
  "message": "pageは1以上の整数を指定してください。"
}

■ 処理概要
- クエリパラメータのバリデーション
- 指定された条件で商品テーブルからデータ取得
- ページング処理を行いレスポンス返却

■ 備考
- 商品の在庫数は最新値を返す
- 商品画像URLはサムネイル画像を想定
- 無限スクロール対応のため、ページングパラメータは必須に近い



■ API名称：商品画像追加API

■ エンドポイント
POST /api/admin/products/{productId}/images

■ 機能概要
指定した商品IDに対して、新しい商品画像を追加する。

■ パスパラメータ
- productId: 画像を追加する対象の商品ID（整数、必須）

■ リクエストボディ（multipart/form-data）
- image_file: アップロードする画像ファイル（jpg, png等、必須）

■ 成功レスポンス（HTTP 201 Created）
{
  "message": "画像が正常に追加されました。",
  "image_url": "https://example.com/images/101-new.jpg"
}

■ 失敗レスポンス例（HTTP 400 Bad Request）
{
  "message": "画像ファイルが不正です。"
}

（HTTP 404 Not Found）
{
  "message": "指定された商品が存在しません。"
}

■ 処理概要
- productIdの存在チェック
- アップロード画像のファイル形式チェック（jpg, pngのみ許可）
- 画像ファイルの保存（ファイル名自動生成推奨）
- 商品の画像リストに新規画像URLを追加

■ 備考
- 管理者権限が必要
- 複数回の画像追加をサポート


■ API名称：カテゴリ一覧取得API

■ エンドポイント
GET /api/categories

■ 機能概要
登録されているカテゴリの一覧を取得する。

■ リクエストパラメータ
なし

■ 成功レスポンス（HTTP 200 OK）
[
  {
    "category_id": 1,
    "category_name": "スマートフォン"
  },
  {
    "category_id": 2,
    "category_name": "パソコン"
  },
  {
    "category_id": 3,
    "category_name": "アクセサリー"
  }
]

■ 失敗レスポンス例
- 特に想定なし（システムエラーの場合は500等）

■ 処理概要
- カテゴリマスタから全カテゴリデータを取得し、一覧で返却する。

■ 備考
- 一般ユーザーも閲覧可能
- カテゴリ順序は登録順または指定の並び順に従う


■ API名称：カテゴリ新規登録API

■ エンドポイント
POST /api/admin/categories

■ 機能概要
新しいカテゴリを登録する（管理者専用機能）。

■ リクエストボディ（JSON）
{
  "category_name": "文字列（必須）"
}

■ バリデーション
- category_name：必須、50文字以内、重複不可

■ 成功レスポンス（HTTP 201 Created）
{
  "message": "カテゴリが登録されました。",
  "category_id": 123
}

■ 失敗レスポンス例（HTTP 400 Bad Request）
{
  "message": "カテゴリ名は必須です。"
}
{
  "message": "同じカテゴリ名が既に存在します。"
}

■ 処理概要
- 管理者認証チェック
- 入力値チェック（必須、文字数、重複確認）
- カテゴリテーブルへ新規登録
- 登録IDを返却

■ 備考
- 管理者のみ利用可能


■ API名称：カテゴリ情報更新API

■ エンドポイント
PUT /api/admin/categories/{categoryId}

■ 機能概要
指定したカテゴリの情報を更新する（管理者専用）。

■ パスパラメータ
- categoryId：更新対象のカテゴリID（必須）

■ リクエストボディ（JSON）
{
  "category_name": "文字列（必須）"
}

■ バリデーション
- category_name：必須、50文字以内、重複不可

■ 成功レスポンス（HTTP 200 OK）
{
  "message": "カテゴリ情報を更新しました。"
}

■ 失敗レスポンス例
- HTTP 400 Bad Request（バリデーションエラー）
- HTTP 404 Not Found（categoryIdが存在しない）
- HTTP 409 Conflict（重複カテゴリ名）

■ 処理概要
- 管理者認証チェック
- categoryIdの存在確認
- 入力値バリデーション
- 重複チェック
- カテゴリ情報の更新

■ 備考
- 管理者のみ利用可能


■ API名称：カテゴリ削除API

■ エンドポイント
DELETE /api/admin/categories/{categoryId}

■ 機能概要
指定したカテゴリを削除する（管理者専用）。

■ パスパラメータ
- categoryId：削除対象のカテゴリID（必須）

■ 成功レスポンス（HTTP 200 OK）
{
  "message": "カテゴリを削除しました。"
}

■ 失敗レスポンス例
- HTTP 404 Not Found（categoryIdが存在しない）
- HTTP 400 Bad Request（削除できない場合、例えば紐づく商品が存在する場合など）

■ 処理概要
- 管理者認証チェック
- categoryIdの存在確認
- 関連商品等の依存関係チェック（必要に応じて）
- 削除処理実行

■ 備考
- 管理者のみ利用可能


■ API名称：注文登録API（ユーザー側）

■ エンドポイント  
POST /api/orders

■ 機能概要  
カート内の商品をもとに注文を確定し、注文情報を登録する。  
注文確定後、在庫数を更新する。  

■ リクエストボディ（JSON形式）  
{
  "customer_id": "string",          // 会員ID（ログインユーザーの場合）
  "order_items": [                  // 注文商品の配列
    {
      "product_id": "string",      // 商品ID
      "quantity": 1                // 注文数量（1以上の整数）
    }
  ],
  "buyer_name": "string",           // 購入者氏名（必須）
  "buyer_address": "string",        // 購入者住所（必須）
  "buyer_email": "string",          // 購入者メールアドレス（必須、メール形式）
  "ship_name": "string|null",       // 配送先氏名（任意、空の場合は購入者氏名を使用）
  "ship_address": "string|null",    // 配送先住所（必須、空の場合は購入者住所を使用）
  "pay_method": "string"            // 決済方法（代引き、銀行振込など）（必須）
}

■ パスパラメータ  
なし

■ 成功レスポンス（HTTP 201 Created）  
{
  "order_id": "string",            // 発行された注文ID
  "message": "注文が正常に登録されました。"
}

■ 失敗レスポンス例  
- HTTP 400 Bad Request  
  - 不正な入力データ（数量が不正、必須項目欠如など）  
  - 在庫不足の場合  
- HTTP 401 Unauthorized（ログイン必須の場合の認証失敗）  
- HTTP 500 Internal Server Error（サーバー処理失敗）

■ 処理概要  
- ログイン認証（会員の場合）  
- 入力値のバリデーションチェック  
- 在庫の確認および確保  
- 注文情報のDB登録（ORDERテーブル、ORDER_DETAILテーブルなど）  
- 在庫数の更新  
- 注文完了通知メールの送信（必要に応じて）  

■ 備考  
- 非会員の注文も可能だが、customer_idは空またはnullとなる。  
- トランザクション管理必須（注文登録と在庫更新は一括処理）  


■ API名称：カート内容取得API

■ エンドポイント  
GET /api/cart

■ 機能概要  
ログインユーザーまたはセッションのカートに入っている商品情報を取得する。  

■ パスパラメータ  
なし

■ クエリパラメータ  
なし

■ 成功レスポンス（HTTP 200 OK）  
{
  "cart_items": [
    {
      "item_id": "string",           // カート内商品ID
      "product_id": "string",        // 商品ID
      "product_name": "string",      // 商品名
      "quantity": 1,                 // カート内数量
      "price": 1000,                 // 単価（税抜き）
      "image_url": "string"          // 商品画像URL（あれば）
    }
  ],
  "total_quantity": 3,               // 合計数量
  "total_price": 3000                // 合計金額（税抜き）
}

■ 失敗レスポンス例  
- HTTP 401 Unauthorized（未ログイン時、ログイン必須の場合）  
- HTTP 500 Internal Server Error（サーバーエラー）

■ 処理概要  
- ユーザー認証またはセッション識別  
- カート情報取得（DBまたはセッションストアから）  
- カート内商品詳細の取得と集計処理  
- レスポンス返却  

■ 備考  
- 非会員の場合はセッションIDを用いたカート情報取得となる。  
- 商品が存在しない・削除された場合はカートから自動削除されることが望ましい。  



=======
</div>
>>>>>>> 396fbddaa0bac62dc20b322db341d9472e1500ad
